<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureSqlServerv2k5 class="oracle.dbtools.crest.model.design.storage.sqlserver.v2k5.StoredProcedureSqlServerv2k5" name="[sp_GetProgramMOSCriteriaForContract]" directorySegmentName="seg_20" id="1024C5A8-1E6F-3E99-4120-2DDC7C9AB3E1">
<sourceDDLFile>Appian.sql</sourceDDLFile>
<createdBy>MichalBonino</createdBy>
<createdTime>2024-04-29 23:57:48 UTC</createdTime>
<ownerDesignName>MCRISSLegacyModel</ownerDesignName>
<body><![CDATA[@ContractID int 
 
AS 
 
DECLARE @ComponentCode AS VARCHAR(2) 
DECLARE @ContractBeginDate AS DATETIME 
 
SET @ComponentCode = (SELECT COMPONENT_CODE FROM CONTRACT WHERE CONTRACT_ID = @ContractID) 
SET @ContractBeginDate = (SELECT CONTRACT_BEGIN_DATE FROM CONTRACT WHERE CONTRACT_ID = @ContractID) 
 
IF @ComponentCode IN ('K4', 'K8', 'K9', 'B5') 
BEGIN 
 SELECT  0 AS PROGRAM_MOS, 
  NULL AS PROGRAM_TYPE, 
  MC.MOS, 
  MC.MOS_CRITERIA_ED_DATE, 
  MC.GENDER, 
  MC.TERM_OF_ENLISTMENT, 
  MC.CITIZENSHIP, 
  MC.DRIVER_LICENSE, 
  IsNull(MC.HIGHEST_WAIVER_LEVEL, '') AS HIGHEST_WAIVER_LEVEL, 
  MC.HEIGHT_MINIMUM, 
  MC.HEIGHT_MAXIMUM, 
  MC.EDUCATION_TIER, 
  MC.AGE_MINIMUM, 
  MC.AGE_MAXIMUM, 
  IsNull(MC.VISION_LEFT_UNCORRECTED, '') AS VISION_LEFT_UNCORRECTED, 
  IsNull(MC.VISION_RIGHT_UNCORRECTED, '') AS VISION_RIGHT_UNCORRECTED, 
  IsNull(MC.VISION_LEFT_CORRECTED, '') AS VISION_LEFT_CORRECTED, 
  IsNull(MC.VISION_RIGHT_CORRECTED, '') AS VISION_RIGHT_CORRECTED, 
  MC.AFQT, 
  MC.GT, 
  MC.EL, 
  MC.PAOI, 
  MC.APT, 
  MC.EDPT, 
  MC.MM, 
  MC.WPMT, 
  MC.DLAB, 
  MC.CL, 
  MC.MEOP, 
  IsNull(MC.COLOR_PERCEPTION, '') AS COLOR_PERCEPTION 
 FROM QSN Q INNER JOIN MOS_CRITERIA MC 
   ON ( Q.CONTRACT_ID = @ContractID AND 
    Q.MOS = MC.MOS AND 
    MC.MOS_CRITERIA_ED_DATE = (SELECT MAX(MOS_CRITERIA_ED_DATE) FROM MOS_CRITERIA MC1 WHERE MC1.MOS = MC.MOS AND DATEDIFF(DAY, MOS_CRITERIA_ED_DATE, @ContractBeginDate) >= 0)) 
END 
ELSE 
BEGIN 
 SELECT  1 AS PROGRAM_MOS, 
  P.PROGRAM_TYPE, 
  P.PROGRAM_CODE, 
  PC.PROGRAM_ID, 
  PC.PROGRAM_CRITERIA_ED_DATE, 
  PC.GENDER, 
  PC.TERM_OF_ENLISTMENT, 
  PC.CITIZENSHIP, 
  PC.DRIVER_LICENSE, 
  IsNull(PC.HIGHEST_WAIVER_LEVEL, '') AS HIGHEST_WAIVER_LEVEL, 
  PC.HEIGHT_MINIMUM, 
  PC.HEIGHT_MAXIMUM, 
  PC.EDUCATION_TIER, 
  PC.AGE_MINIMUM, 
  PC.AGE_MAXIMUM, 
  IsNull(PC.VISION_LEFT_UNCORRECTED, '') AS VISION_LEFT_UNCORRECTED, 
  IsNull(PC.VISION_RIGHT_UNCORRECTED, '') AS VISION_RIGHT_UNCORRECTED, 
  IsNull(PC.VISION_LEFT_CORRECTED, '') AS VISION_LEFT_CORRECTED, 
  IsNull(PC.VISION_RIGHT_CORRECTED, '') AS VISION_RIGHT_CORRECTED, 
  PC.AFQT, 
  PC.GT, 
  PC.EL, 
  PC.PAOI, 
  PC.APT, 
  PC.EDPT, 
  PC.MM, 
  PC.WPMT, 
  PC.DLAB, 
  PC.CL, 
  PC.MEOP, 
  IsNull(PC.COLOR_PERCEPTION, '') AS COLOR_PERCEPTION, 
  PC.BONUS_AMOUNT 
 FROM PROGRAM_AVAILABILITY PA INNER JOIN PROGRAM_CRITERIA PC 
   ON ( PA.CONTRACT_ID = @ContractID AND 
    PA.PROGRAM_ID = PC.PROGRAM_ID AND 
    PC.PROGRAM_CRITERIA_ED_DATE = (SELECT MAX(PROGRAM_CRITERIA_ED_DATE) FROM PROGRAM_CRITERIA PC1 WHERE PC1.PROGRAM_ID = PC.PROGRAM_ID AND DATEDIFF(DAY, PROGRAM_CRITERIA_ED_DATE, PA.PROGRAM_ASSIGNMENT_DATE) >= 0)) 
  INNER JOIN PROGRAM P ON PA.PROGRAM_ID = P.PROGRAM_ID 
END]]></body>
<schema>DD6CF638-A2EB-2E1B-FF13-422CA718DE2D</schema>
<database>EA42DEDC-DFC5-B775-3079-AD0E133F5E1D</database>
</StoredProcedureSqlServerv2k5>