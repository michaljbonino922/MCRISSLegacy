<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureSqlServerv2k5 class="oracle.dbtools.crest.model.design.storage.sqlserver.v2k5.StoredProcedureSqlServerv2k5" name="[sp_GetRSSAc.vityGradSenior]" directorySegmentName="seg_20" id="4A363462-6031-7841-5A47-0CCDD0AAB4B4">
<sourceDDLFile>create MCRISS script - MCRISS OTA.txt</sourceDDLFile>
<createdBy>MichalBonino</createdBy>
<createdTime>2024-04-29 19:28:41 UTC</createdTime>
<ownerDesignName>MCRISSLegacyModel</ownerDesignName>
<body><![CDATA[@OrgID int, 
 @Ac.vityDate date.me 
AS 
SET NOCOUNT ON 
 
-------------------------------------------- 
--- Get the Grad and Senior Contracts 
-------------------------------------------- 
CREATE TABLE #TEMP_CONTRACTS (ORG_ID int NOT NULL, GRAD_COUNT int NOT NULL, SENIOR_COUNT int NOT NULL) 
 
INSERT INTO 
 #TEMP_CONTRACTS 
SELECT 
 N.ORGANIZATION_OF_RECORD_ID, 
 COALESCE(SUM(CASE (N.EDUCATION_LEVEL + N.EDUCATION_CODE) 
  WHEN '11S' THEN 0 
  WHEN '11M' THEN 0 
  WHEN '11H' THEN 0 
  ELSE 1 
  END), 0), 
 COALESCE(SUM(CASE (N.EDUCATION_LEVEL + N.EDUCATION_CODE) 
  WHEN '11S' THEN 1 
  WHEN '11M' THEN 1 
  WHEN '11H' THEN 1 
  ELSE 0 
  END), 0) 
FROM 
 CONTRACT C INNER JOIN NWA N 
  ON (C.NWA_ID = N.NWA_ID AND 
     DATEDIFF(DAY, @Ac.vityDate, C.CONTRACT_BEGIN_DATE) = 0 AND 
     COALESCE(N.COMP_CHANGE_FLAG, 'N') != 'Y' AND 
     CONTRACT_ID IS NOT NULL AND 
     N.EDUCATION_LEVEL IS NOT NULL AND 
     N.EDUCATION_CODE IS NOT NULL) 
 INNER JOIN RECRUITING_ORGANIZATION RO 
  ON (RO.ORGANIZATION_ID = N.ORGANIZATION_OF_RECORD_ID AND RO.ISOPEN = 'Y' AND RO.ORGANIZATION_TYPE = 'RSS') 
 INNER JOIN ORGANIZATION_MAP OM 
  ON (OM.PARENT_ORGANIZATION_ID = @OrgID AND 
     OM.CHILD_ORGANIZATION_ID = RO.ORGANIZATION_ID) 
GROUP BY 
 N.ORGANIZATION_OF_RECORD_ID 
 
-------------------------------------------- 
--- Get the Grad and Senior Applica.ons (NWAs) 
-------------------------------------------- 
CREATE TABLE #TEMP_APPLICATIONS (ORG_ID int NOT NULL, GRAD_COUNT int NOT NULL, SENIOR_COUNT int NOT NULL) 
 
INSERT INTO 
 #TEMP_APPLICATIONS 
SELECT 
 N.ORGANIZATION_OF_RECORD_ID, 
 COALESCE(SUM(CASE (CE.EDUCATION_LEVEL + CE.EDUCATION_CODE) 
  WHEN '11S' THEN 0 
  WHEN '11M' THEN 0 
  WHEN '11H' THEN 0 
  ELSE 1 
  END), 0) AS GRAD_CONTRACT_COUNT, 
 COALESCE(SUM(CASE (CE.EDUCATION_LEVEL + CE.EDUCATION_CODE) 
  WHEN '11S' THEN 1 
  WHEN '11M' THEN 1 
  WHEN '11H' THEN 1 
  ELSE 0 
  END), 0) AS SENIOR_CONTRACT_COUNT 
FROM 
 NWA N INNER JOIN RECRUITING_ORGANIZATION RO 
  ON (RO.ORGANIZATION_ID = N.ORGANIZATION_OF_RECORD_ID AND 
     RO.ISOPEN = 'Y' AND 
     RO.ORGANIZATION_TYPE = 'RSS' AND 
     DATEDIFF(DAY, @Ac.vityDate, N.NWA_DECLARED_DATE) = 0 AND 
     COALESCE(N.COMP_CHANGE_FLAG, 'N') != 'Y') 
 INNER JOIN ORGANIZATION_MAP OM 
  ON (OM.PARENT_ORGANIZATION_ID = @OrgID AND 
     OM.CHILD_ORGANIZATION_ID = RO.ORGANIZATION_ID) 
 INNER JOIN CANDIDATE_EDUCATION CE ON 
  (N.MARINE_CANDIDATE_ID = CE.MARINE_CANDIDATE_ID AND 
  CE.EDUCATION_LEVEL IS NOT NULL AND 
  CE.EDUCATION_CODE IS NOT NULL) 
GROUP BY 
 N.ORGANIZATION_OF_RECORD_ID 
 
------------------------------------------------------------------- 
--- Get all Contract, Applica.on, Interview, and Appointment data 
------------------------------------------------------------------- 
SELECT 
 RO.SHORT_NAME, 
 RO.ORGANIZATION_ID, 
 COALESCE(ACT.ACTIVITY_DATE, @Ac.vityDate) AS ACTIVITY_DATE, 
 COALESCE(TC.GRAD_COUNT, 0) AS GRAD_CONTRACTS, 
 COALESCE(TC.SENIOR_COUNT, 0) AS SENIOR_CONTRACTS, 
 COALESCE(TA.GRAD_COUNT, 0) AS GRAD_APPLICATIONS, 
 COALESCE(TA.SENIOR_COUNT, 0) AS SENIOR_APPLICATIONS, 
 COALESCE(ACT.GRAD_INTERVIEWS, 0) AS GRAD_INTERVIEWS, 
 COALESCE(ACT.SENIOR_INTERVIEWS, 0) AS SENIOR_INTERVIEWS, 
 COALESCE(ACT.GRAD_APPOINTMENTS, 0) AS GRAD_APPOINTMENTS, 
 COALESCE(ACT.SENIOR_APPOINTMENTS, 0) AS SENIOR_APPOINTMENTS 
FROM 
 ORGANIZATION_MAP OM INNER JOIN RECRUITING_ORGANIZATION RO 
  ON (OM.PARENT_ORGANIZATION_ID = @OrgID AND OM.CHILD_ORGANIZATION_ID = RO.ORGANIZATION_ID AND RO.ISOPEN = 'Y' AND RO.ORGANIZATION_TYPE = 'RSS') 
 LEFT OUTER JOIN (SELECT * FROM RSS_ACTIVITY_GRAD_SENIOR WHERE DATEDIFF(DAY, @Ac.vityDate, ACTIVITY_DATE) = 0) ACT  
  ON RO.ORGANIZATION_ID = ACT.ORGANIZATION_ID 
 LEFT OUTER JOIN #TEMP_CONTRACTS TC 
  ON RO.ORGANIZATION_ID = TC.ORG_ID 
 LEFT OUTER JOIN #TEMP_APPLICATIONS TA 
  ON RO.ORGANIZATION_ID = TA.ORG_ID 
ORDER BY 
 RO.SHORT_NAME ASC 
 
 
DROP TABLE #TEMP_APPLICATIONS 
DROP TABLE #TEMP_CONTRACTS 
 
SET NOCOUNT OFF]]></body>
<schema>3925E19F-DC76-90A4-B892-D7A526C79632</schema>
<database>B007042D-D2E3-F83F-481F-CEB23B21CB30</database>
</StoredProcedureSqlServerv2k5>