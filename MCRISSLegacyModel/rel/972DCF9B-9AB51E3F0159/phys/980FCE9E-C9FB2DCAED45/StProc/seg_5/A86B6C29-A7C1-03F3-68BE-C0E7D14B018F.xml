<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureSqlServerv2k5 class="oracle.dbtools.crest.model.design.storage.sqlserver.v2k5.StoredProcedureSqlServerv2k5" name="[GetFYMission]" directorySegmentName="seg_5" id="A86B6C29-A7C1-03F3-68BE-C0E7D14B018F">
<sourceDDLFile>create MCRISS script - MCRISS OTA.txt</sourceDDLFile>
<createdBy>MichalBonino</createdBy>
<createdTime>2024-04-29 19:28:42 UTC</createdTime>
<ownerDesignName>MCRISSLegacyModel</ownerDesignName>
<body><![CDATA[@Organiza.onID     int,  
 @FiscalYear   int 
  
AS 
 SET NOCOUNT ON 
 SET ARITHABORT ON 
 SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED 
  
 SELECT * 
 INTO #LawTemp 
 From 
 ( 
  SELECT Grad_Year, Law1_Mission AS LAW 
  FROM MCRISS.[dbo].[OFFICER_SHIP_MISSION_PLAN] 
  WHERE organiza.on_id = @Organiza.onID and .scal_year = @FiscalYear and Grad_Year = @FiscalYear + 1 
   
  UNION 
   
  SELECT Grad_Year + 1, Law2_Mission AS LAW 
  FROM MCRISS.[dbo].[OFFICER_SHIP_MISSION_PLAN] 
  WHERE organiza.on_id = @Organiza.onID and .scal_year = @FiscalYear and Grad_Year = @FiscalYear + 1 
   
  UNION 
   
  SELECT Grad_Year + 2, Law3_Mission AS LAW 
  FROM MCRISS.[dbo].[OFFICER_SHIP_MISSION_PLAN] 
  WHERE organiza.on_id = @Organiza.onID and .scal_year = @FiscalYear and Grad_Year = @FiscalYear + 1 
 ) AS T 
  
 SELECT [OFFICER_SOURCE_CODE], 0 as OCC_CLASS_NUMBER, 
  CASE OMP.GRAD_YEAR 
   WHEN  @FiscalYear + 1  Then  'PLCCOMB'  
   WHEN @FiscalYear + 2  Then  'PLCSCR' 
   WHEN @FiscalYear + 3  Then  'PLCJR' 
  END  AS  TRAINING_TYPE_CODE, 
 [GROUND_MISSION] AS GROUND, 
 ISNULL([PLCR_GROUND_MISSION],0) AS PLCR_GROUND, 
 [NFO_MISSION] AS NFO, 
 [NAVAL_AIR_MISSION] AS AIR , 
 [OCCR_GROUND_MISSION] AS OCCR_GROUND,[BLACK_MISSION] AS AA,  
 [HISPANIC_MISSION] AS HISPANIC, [OTHER_MISSION] AS OTHER, 
 [FEMALE_MISSION] AS FEMALE , 
 lt.LAW 
 
 FROM  
  RECRUITING_ORGANIZATION RO  
  INNER JOIN OFFICER_SHIP_MISSION_PLAN OMP  
   ON RO.ORGANIZATION_ID = OMP.ORGANIZATION_ID 
  INNER JOIN #LawTemp  lt  
   ON omp.Grad_Year = lt.Grad_Year  
 WHERE  
  RO.ORGANIZATION_ID = @Organiza.onID  
  AND OMP.FISCAL_YEAR = @FiscalYear  
        AND [OFFICER_SOURCE_CODE] = 'PLC' 
   
  UNION 
   
  SELECT [OFFICER_SOURCE_CODE], [OCC_CLASS_NUMBER], 
   CASE 
    WHEN  [OCC_CLASS_NUMBER]  = (SELECT MIN (OC.CLASS_NUMBER) FROM OCS_CLASS OC WHERE OC.FISCAL_YEAR =  @FiscalYear and TRAINING_TYPE_CODE = 'OCC') THEN 'FALL' 
    WHEN  [OCC_CLASS_NUMBER]  = ( SELECT MAX (OC.CLASS_NUMBER) FROM OCS_CLASS OC WHERE OC.FISCAL_YEAR = @FiscalYear and TRAINING_TYPE_CODE = 'OCC') THEN 'SUMMER' 
    WHEN  [OCC_CLASS_NUMBER] > (SELECT MIN (OC.CLASS_NUMBER) FROM OCS_CLASS OC WHERE OC.FISCAL_YEAR =  @FiscalYear and TRAINING_TYPE_CODE = 'OCC')  
           AND  [OCC_CLASS_NUMBER]  < (SELECT MAX (OC.CLASS_NUMBER) FROM OCS_CLASS OC  
           WHERE OC.FISCAL_YEAR = @FiscalYear and TRAINING_TYPE_CODE = 'OCC') THEN 'WINTER' 
  END AS TRAINING_TYPE_CODE, 
 [GROUND_MISSION] AS GROUND, 
 ISNULL([PLCR_GROUND_MISSION],0) AS PLCR_GROUND, 
 [NFO_MISSION] AS NFO, 
 [NAVAL_AIR_MISSION] AS AIR , 
 [OCCR_GROUND_MISSION] AS OCCR_GROUND,[BLACK_MISSION] AS AA,  
 [HISPANIC_MISSION] AS HISPANIC, [OTHER_MISSION] AS OTHER, 
 [FEMALE_MISSION] AS FEMALE ,[LAW1_MISSION] + [LAW2_MISSION] +  
            [LAW3_MISSION] AS LAW 
  
 
  FROM  
 RECRUITING_ORGANIZATION RO  
 INNER JOIN OFFICER_SHIP_MISSION_PLAN OMP ON 
 RO.ORGANIZATION_ID = OMP.ORGANIZATION_ID  
    
   INNER JOIN OCS_CLASS OC ON OC.CLASS_NUMBER = OMP.OCC_CLASS_NUMBER 
        AND OC.FISCAL_YEAR = @FiscalYear    
         
  WHERE RO.ORGANIZATION_ID = @Organiza.onID AND  [OFFICER_SOURCE_CODE] = 'OCC' 
   
  DROP TABLE #LawTemp 
 
SET NOCOUNT OFF]]></body>
<schema>72379847-5555-B149-4E45-17F849103A51</schema>
<database>B007042D-D2E3-F83F-481F-CEB23B21CB30</database>
</StoredProcedureSqlServerv2k5>