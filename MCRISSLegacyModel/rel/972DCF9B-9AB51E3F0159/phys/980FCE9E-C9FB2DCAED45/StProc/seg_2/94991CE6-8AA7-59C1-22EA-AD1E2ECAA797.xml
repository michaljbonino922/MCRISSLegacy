<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureSqlServerv2k5 class="oracle.dbtools.crest.model.design.storage.sqlserver.v2k5.StoredProcedureSqlServerv2k5" name="[GetCommandRecruiters]" directorySegmentName="seg_2" id="94991CE6-8AA7-59C1-22EA-AD1E2ECAA797">
<sourceDDLFile>create ODSE script - MCRISS OTA.txt</sourceDDLFile>
<createdBy>MichalBonino</createdBy>
<createdTime>2024-04-29 23:41:48 UTC</createdTime>
<ownerDesignName>MCRISSLegacyModel</ownerDesignName>
<body><![CDATA[( 
 @OrgID int = 0 
) 
 
AS 
BEGIN 
 
 SET NOCOUNT ON 
 
 SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED  
  
DECLARE @CurrentDate DATETIME  
SET @CurrentDate = GETDATE()  
 
SELECT  
 NWA_ID 
 ,MARINE_CANDIDATE_ID 
 ,ORGANIZATION_OF_RECORD_ID 
 ,RECRUITER_OF_RECORD_ID 
 ,rowguid 
 ,ProvenPerformer 
 ,PTAD_POOL_MEMBER 
INTO #NWA 
FROM MCRISS.dbo.NWA 
WHERE ORGANIZATION_OF_RECORD_ID = @OrgID 
 
SELECT N.ORGANIZATION_OF_RECORD_ID AS [OrgID] 
,N.MARINE_CANDIDATE_ID AS [MARINE_CANDIDATE_ID] 
,S.SHIP_ID AS [CommandRecruiterId] 
,N.rowguid AS [NWARowGuid] 
,N.NWA_ID AS [NWAId] 
,c.COMPONENT_CODE 
,DATEADD(year,C.TERM_OF_ENLISTMENT,S.AFADBD) AS [EAS] 
,REPLICATE(' ',10) AS [CurrentRank] 
,COALESCE(RTRIM(P.LAST_NAME), SPACE(0))  + SPACE(1) +  
  COALESCE(RTRIM(P.FIRST_NAME), SPACE(0)) + SPACE(1) +  
  COALESCE(RTRIM(P.LEGAL_MIDDLE_NAME), SPACE(0)) AS Name 
,COALESCE(RTRIM(RP.RANK_CODE), SPACE(0)) + SPACE(1)  +  
  COALESCE(RTRIM(RCRTR.LAST_NAME), SPACE(0))  + SPACE(1) +  
  COALESCE(RTRIM(RCRTR.FIRST_NAME), SPACE(0)) + SPACE(1) +  
  COALESCE(RTRIM(RCRTR.LEGAL_MIDDLE_NAME), SPACE(0)) AS RecruiterName 
,N.ProvenPerformer 
INTO #TempMarine 
FROM MCRISS.dbo.PERSON P 
INNER JOIN #NWA n ON P.PERSON_ID = N.MARINE_CANDIDATE_ID 
        AND N.NWA_ID IN ( SELECT MAX(N2.NWA_ID) 
              FROM #NWA N2 
              WHERE N.MARINE_CANDIDATE_ID = N2.MARINE_CANDIDATE_ID) 
INNER JOIN MCRISS.dbo.CANDIDATE_STATUS CS ON N.NWA_ID = CS.NWA_ID 
           AND CS.CANDIDATE_STATUS_ID IN ( SELECT MAX(CS2.CANDIDATE_STATUS_ID) 
                   FROM MCRISS.dbo.CANDIDATE_STATUS CS2 
                   WHERE CS.NWA_ID = CS2.NWA_ID) 
INNER JOIN MCRISS.dbo.CONTRACT C ON n.NWA_ID = C.NWA_ID 
INNER JOIN MCRISS.dbo.SHIPPER S ON C.CONTRACT_ID = S.CONTRACT_ID  
LEFT OUTER JOIN MCRISS.dbo.RECRUITING_PERSON RP ON RP.RECRUITING_PERSON_ID = N.RECRUITER_OF_RECORD_ID 
LEFT OUTER JOIN MCRISS.dbo.PERSON RCRTR ON RCRTR.PERSON_ID = RP.RECRUITING_PERSON_ID 
WHERE (CS.STATUS_TYPE + CS.STATUS_CODE + CS.DISPOSITION_CODE = 'ECP') 
AND N.PTAD_POOL_MEMBER = 1 
 
UPDATE tm 
SET tm.CurrentRank = pg.RANK_CODE 
 ,tm.EAS = m.EXPIRATION_OF_ACTIVE_SERVICE 
FROM #TempMarine tm 
INNER JOIN MCRISS.dbo.MARINE m ON m.MARINE_ID = tm.MARINE_CANDIDATE_ID 
INNER JOIN MCRISS.dbo.PAY_GRADE PG ON M.PRESENT_GRADE_CODE = PG.PAY_GRADE_CODE 
 
SELECT 
 * 
INTO #Marine 
FROM #TempMarine 
WHERE @CurrentDate < EAS 
 AND NOT COMPONENT_CODE IN ('K4','B5','K9','K8') 
  
SELECT [OrgID] 
,[CommandRecruiterId] 
,[NWAId] 
,[NWARowGuid] 
,[EAS] 
,[CurrentRank] 
,[Name] 
,[RecruiterName] 
,[ProvenPerformer] 
FROM #Marine 
ORDER BY [Name] 
 
DROP TABLE #NWA 
DROP TABLE #TempMarine 
DROP TABLE #Marine 
 
END]]></body>
<schema>A5B5C85F-7BA3-158E-D5A2-943767AC9AE2</schema>
<database>7220F1F8-DA6B-58D6-61AE-B77688E1C655</database>
</StoredProcedureSqlServerv2k5>