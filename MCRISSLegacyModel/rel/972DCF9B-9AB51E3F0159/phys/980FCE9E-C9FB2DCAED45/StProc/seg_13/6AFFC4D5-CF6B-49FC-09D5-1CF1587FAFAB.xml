<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureSqlServerv2k5 class="oracle.dbtools.crest.model.design.storage.sqlserver.v2k5.StoredProcedureSqlServerv2k5" name="[O.cerNWABoardFindPerson]" directorySegmentName="seg_13" id="6AFFC4D5-CF6B-49FC-09D5-1CF1587FAFAB">
<sourceDDLFile>create MCRISS script - MCRISS OTA.txt</sourceDDLFile>
<createdBy>MichalBonino</createdBy>
<createdTime>2024-04-29 19:28:43 UTC</createdTime>
<ownerDesignName>MCRISSLegacyModel</ownerDesignName>
<body><![CDATA[( 
      @OrgID int, 
      @Ssn  CHAR(9) = null, 
      @LastName VARCHAR(50) = null,  
      @FirstName VARCHAR(50) = null 
 ) 
 
AS 
 
 
CREATE TABLE #NWA_VIEW  
 (PERSON_ID INT, NWA_ID INT, CONTRACT_ID INT, PERSON_NAME VARCHAR(62), SSN CHAR(9),ORGANIZATION_OF_RECORD_ID INT,CITY_CODE VARCHAR(4),COUNTY_CODE VARCHAR(3),STATE_CODE VARCHAR(2),STREET_ADDRESS VARCHAR(50), 
STREET_ADDRESS_2 VARCHAR(50),ZIPCODE VARCHAR(9),TELEPHONE_NUMBER VARCHAR(10), 
EMAIL_ADDRESS VARCHAR(50), 
RECRUITERNAME VARCHAR(62), 
 OSSNAME VARCHAR(45), 
 DATE_STARTED_WORKING DATETIME, DATE_DECLARED DATETIME, 
 PROGRAM VARCHAR(50), RACE CHAR(1), GENDER CHAR(1), RAPP_ISSUE_DATE DATETIME, RAPP_SUBMIT_DATE DATETIME, ASVAB_DATE DATETIME, EL_SCORE INT,AFQT_SCORE INT, 
 MEPS_MEDICAL_EXAM_DATE DATETIME, MEPS_MEDICAL_RESULT VARCHAR(4), ANNUAL_PHYSICAL_DATE DATETIME, ANNUAL_PHYSICAL_RESULT VARCHAR(4), FLIGHT_PHYSICAL_DATE DATETIME, FLIGHT_PHYSICAL_RESULT VARCHAR(4), 
 MAX_MEDICAL_EXAM_TYPE CHAR(1), MAX_MEDICAL_EXAM_DATE DATETIME, MAX_MEDICAL_RESULT VARCHAR(4),  
 MEDICAL_DOCS_SUBMIT_DATE DATETIME, CONSULT_DATE DATETIME, ASTB_DATE DATETIME, ASTB_SCORE INT, ASTB_SCORE_2 INT, ASTB_SCORE_3 INT, PFT_DATE DATETIME, PFT_SCORE INT,  
 TRANSCRIPT CHAR(1), ACF CHAR(1), EPSQ CHAR(1), BIRTH_VERIFICATION CHAR(1), POLICE CHAR(1), DD_FORM_368 CHAR(1), SRB CHAR(1), DD214 CHAR(1), DEAN CHAR(1),  
 PRF1 CHAR(1), PRF2 CHAR(1), EMPLOYER CHAR(1), I_AND_I CHAR(1), OTHER1 CHAR(1), OTHER2 CHAR(1), PRINTS CHAR(1), PHOTO CHAR(1), WAIVER_NOTES VARCHAR(50),  
 CONTRACT_BEGIN_DATE DATETIME, FINAL_ACTION VARCHAR(40), ComponentCode varchar(2)) 
 
INSERT INTO #NWA_VIEW  
 (  
 PERSON_ID,  
 NWA_ID,  
 CONTRACT_ID,  
 PERSON_NAME,  
 SSN,  
    ORGANIZATION_OF_RECORD_ID, 
    CITY_CODE , 
    COUNTY_CODE, 
    STATE_CODE , 
    STREET_ADDRESS , 
    STREET_ADDRESS_2 , 
    ZIPCODE , 
    TELEPHONE_NUMBER , 
    EMAIL_ADDRESS , 
    RECRUITERNAME, 
    OSSNAME, 
 DATE_STARTED_WORKING,  
 DATE_DECLARED,   
 ComponentCode, 
 PROGRAM,  
 RACE,  
 GENDER,  
 RAPP_ISSUE_DATE,  
 RAPP_SUBMIT_DATE,  
 WAIVER_NOTES,  
 CONTRACT_BEGIN_DATE,  
 FINAL_ACTION 
 ) 
SELECT  
 P.PERSON_ID,  
 N.NWA_ID,  
 C.CONTRACT_ID, 
 P.LAST_NAME + ', ' + P.FIRST_NAME + COALESCE(SPACE(1) + P.LEGAL_MIDDLE_NAME, SPACE(0)) AS PERSON_NAME, 
 P.SOCIAL_SECURITY_NUMBER,  
    n.ORGANIZATION_OF_RECORD_ID, 
    CA.CITY_CODE ,CA.COUNTY_CODE,CA.STATE_CODE , 
    CA.STREET_ADDRESS, 
    CA.STREET_ADDRESS_2, 
    CA.ZIPCODE, 
    CP.TELEPHONE_NUMBER, 
    N.EMAIL_ADDRESS, 
    COALESCE(RTRIM(RP.RANK_CODE), SPACE(0)) + SPACE(1)  +  
  COALESCE(RTRIM(RCRTR.LAST_NAME), SPACE(0))  + SPACE(1) +  
  COALESCE(RTRIM(RCRTR.FIRST_NAME), SPACE(0)) + SPACE(1) +  
  COALESCE(RTRIM(RCRTR.LEGAL_MIDDLE_NAME), SPACE(0)) AS RECRUITERNAME, 
    RO.NAME AS OSSNAME, 
 N.NWA_DATE_STARTED_WORKING,  
 N.NWA_DECLARED_DATE,  
 CC.COMPONENT_CODE,  
 CC.COMPONENT_DESCRIPTION,  
 MC.RACE_CODE,  
 MC.GENDER_CODE,   
 N.RAPP_ISSUE_DATE,  
 N.RAPP_SUBMIT_DATE,  
 N.NWA_LOG_NOTES,  
 C.CONTRACT_BEGIN_DATE,  
 CASE CS.STATUS_CODE 
  WHEN 'A' THEN SD.DISPOSITION_DESCRIPTION    
  ELSE SD.STATUS_DESCRIPTION 
 END AS FINAL_ACTION 
FROM NWA N WITH (NOLOCK) 
 INNER JOIN MARINE_CANDIDATE MC ON (N.MARINE_CANDIDATE_ID = MC.MARINE_CANDIDATE_ID) 
 INNER JOIN [USMC].[vwRecrui.ngOrgIDs] vw ON n.ORGANIZATION_OF_RECORD_ID = vw.root 
    INNER JOIN RECRUITING_ORGANIZATION RO ON n.ORGANIZATION_OF_RECORD_ID = RO.ORGANIZATION_ID 
 INNER JOIN PERSON P ON MC.MARINE_CANDIDATE_ID = P.PERSON_ID 
 INNER JOIN CANDIDATE_STATUS CS ON 
  (N.NWA_ID = CS.NWA_ID AND 
  CS.STATUS_TYPE = 'O' AND 
  CS.CANDIDATE_STATUS_ID = dbo.GetMaxStatusID(CS.NWA_ID)) 
 INNER JOIN STATUS_DISPOSITION SD ON  
  (CS.STATUS_TYPE = SD.STATUS_TYPE AND 
  CS.STATUS_CODE = SD.STATUS_CODE AND 
  CS.DISPOSITION_CODE = SD.DISPOSITION_CODE) 
 LEFT OUTER JOIN COMPONENT_CODE CC ON N.OFFICER_COMPONENT_CODE = CC.COMPONENT_CODE 
 LEFT OUTER JOIN OFFICER_CONTRACT C ON N.NWA_ID = C.NWA_ID 
 
    LEFT OUTER JOIN CANDIDATE_ADDRESS CA 
 ON  ((CA.MARINE_CANDIDATE_ID = N.MARINE_CANDIDATE_ID) AND (CA.ADDRESS_TYPE = 'C')) 
    LEFT OUTER JOIN CANDIDATE_TELEPHONE CP 
 ON ((CP.MARINE_CANDIDATE_ID = N.MARINE_CANDIDATE_ID) AND (CP.TELEPHONE_TYPE = 'C')) 
 LEFT OUTER JOIN RECRUITING_PERSON RP 
  ON RP.RECRUITING_PERSON_ID = N.RECRUITER_OF_RECORD_ID  
 LEFT OUTER JOIN PERSON RCRTR 
  ON RCRTR.PERSON_ID = RP.RECRUITING_PERSON_ID 
WHERE 
((vw.RS = @OrgID OR vw.RSS = @OrgID  OR vw.OSS = @OrgID OR vw.District = @OrgID OR vw.Region =    @OrgID OR vw.HQ = @OrgID) 
    AND 
 (@FirstName is null OR P.FIRST_NAME like @FirstName)  
 AND 
 (@LastName is null OR P.LAST_NAME like @LastName)  
 AND 
 (@SSN is null OR P.SOCIAL_SECURITY_NUMBER like @Ssn)) 
 
--- APPLICATION CHECKLIST DATA 
UPDATE  
 #NWA_VIEW 
SET 
 TRANSCRIPT   = AC.OFFICIAL_COLLEGE_TRANSCRIPTS, 
 ACF    = AC.ACFNAVMC10469, 
 EPSQ    = AC.COPY_OF_EPSQ, 
 BIRTH_VERIFICATION  = AC.BIRTH_VERIFICATION,  
 POLICE    = AC.MINOR_TRAFFIC_ARREST_FORM, 
 DD_FORM_368   = AC.DD_FORM_368, 
 SRB    = AC.SRB, 
 DD214    = AC.DD214, 
 DEAN    = AC.DEAN, 
 PRF1    = AC.PRF1, 
 PRF2    = AC.PRF2, 
 EMPLOYER   = AC.EMPLOYER, 
 I_AND_I   = AC.I_AND_I, 
 OTHER1    = AC.OTHER1, 
 OTHER2    = AC.OTHER2,  
 PRINTS    = AC.PRINTS, 
 PHOTO    = AC.PHOTO_PAGE 
FROM 
 #NWA_VIEW V INNER JOIN APPLICATION_CHECKLIST AC ON V.NWA_ID = AC.NWA_ID 
 
--- ASVAB DATA 
UPDATE  
 #NWA_VIEW 
SET 
 ASVAB_DATE = CA.ASVAB_DATE, 
 EL_SCORE = CA.EL_SCORE, 
 AFQT_SCORE = CA.AFQT_SCORE 
FROM 
 #NWA_VIEW V INNER JOIN CANDIDATE_ASVAB CA ON  
  (V.PERSON_ID = CA.MARINE_CANDIDATE_ID AND 
  CA.ASVAB_DATE = dbo.GetMaxASVABDate(CA.MARINE_CANDIDATE_ID))  
   
--- GET PROFESSED EXAM DATA ---   
;WITH C AS 
( 
 SELECT ROW_NUMBER() OVER ( 
   PARTITION BY MARINE_CANDIDATE_ID 
   ORDER BY MARINE_CANDIDATE_ID, EXAM_DATE DESC, UPDATE_DATE DESC ) AS rowNum 
  ,MARINE_CANDIDATE_ID 
  ,PROFESSED_EXAM_TYPE 
  ,EXAM_DATE 
  ,EXAM_SCORE 
  FROM ( 
   
  SELECT  
   MARINE_CANDIDATE_ID 
   ,PROFESSED_EXAM_TYPE 
   ,EXAM_DATE 
   ,EXAM_SCORE 
   ,UPDATE_DATE 
  FROM  
   MCRISS.dbo.CANDIDATE_PROFESSED_EXAM 
  WHERE  
   MARINE_CANDIDATE_ID IN (SELECT PERSON_ID FROM #NWA_VIEW ) 
  AND 
   PROFESSED_EXAM_TYPE <>'V'  
   
  UNION ALL 
    
  SELECT  
     ASVAB.MARINE_CANDIDATE_ID 
    ,PROFESSED_EXAM_TYPE = 'A' 
    ,ASVAB.ASVAB_DATE AS EXAM_DATE      
    ,ASVAB.AFQT_SCORE as EXAM_SCORE 
    ,ASVAB.UPDATE_DATE 
     FROM  
   MCRISS.dbo.CANDIDATE_ASVAB AS ASVAB 
  WHERE  
   MARINE_CANDIDATE_ID IN (SELECT PERSON_ID FROM #NWA_VIEW ) 
   ) MENTAL 
) 
SELECT * INTO #NonASTBExams FROM C WHERE rowNum = 1; 
 
--- Even though it is using ASVAB columns, 
--- but it is used for showing the latest Mental Test score and date as ECP 2300 requested 
UPDATE  
 #NWA_VIEW 
SET 
 ASVAB_DATE  = CPE.EXAM_DATE, 
 AFQT_SCORE  = CPE.EXAM_SCORE 
FROM 
 #NWA_VIEW N 
 INNER JOIN #NonASTBExams CPE ON N.PERSON_ID = CPE.MARINE_CANDIDATE_ID  
 
--- PFT DATA 
UPDATE  
 #NWA_VIEW 
SET 
 PFT_DATE = PFT.PFT_DATE, 
 PFT_SCORE = PFT.PFT_SCORE 
FROM 
 #NWA_VIEW V INNER JOIN PFT ON  
  (V.NWA_ID = PFT.NWA_ID AND 
  PFT.PFT_ID = dbo.GetMaxPFTID(V.NWA_ID)) 
 
--- CONSULTATION DATA 
UPDATE  
 #NWA_VIEW 
SET 
 CONSULT_DATE = CONS.MEDICAL_EXAM_DATE 
FROM 
 #NWA_VIEW V INNER JOIN CANDIDATE_MEDICAL_EXAM CONS ON 
  (V.PERSON_ID = CONS.MARINE_CANDIDATE_ID AND 
  CONS.MEDICAL_EXAM_TYPE = 'CONS' AND  
  CONS.MEDICAL_EXAM_DATE = dbo.GetMaxMedicalExamDate(CONS.MARINE_CANDIDATE_ID, CONS.MEDICAL_EXAM_TYPE)) 
 
--- MEPS MEDICAL DATA 
UPDATE  
 #NWA_VIEW 
SET 
 MEPS_MEDICAL_EXAM_DATE  = CME.MEDICAL_EXAM_DATE,  
 MEPS_MEDICAL_RESULT  = CASE CME.MEDICAL_DISPOSITION 
     WHEN 'Q' THEN 'QUAL' 
     WHEN 'D' THEN 'DQ' 
     ELSE SPACE(0) 
     END 
FROM 
 #NWA_VIEW V INNER JOIN CANDIDATE_MEDICAL_EXAM CME ON 
  (V.PERSON_ID = CME.MARINE_CANDIDATE_ID AND 
  CME.MEDICAL_EXAM_TYPE = 'FULL' AND  
  CME.MEDICAL_EXAM_DATE = dbo.GetMaxMedicalExamDate(CME.MARINE_CANDIDATE_ID, CME.MEDICAL_EXAM_TYPE)) 
 
--- ANNUAL PHYSICAL DATA 
UPDATE  
 #NWA_VIEW 
SET 
 ANNUAL_PHYSICAL_DATE  = AP.EXAM_DATE,  
 ANNUAL_PHYSICAL_RESULT  = CASE D.MEDICAL_DISPOSITION_CODE 
     WHEN 'Q' THEN 'QUAL' 
     WHEN 'DQ' THEN 'DQ' 
     ELSE SPACE(0) 
     END 
FROM 
 #NWA_VIEW V INNER JOIN ANNUAL_PHYSICAL AP ON 
  (V.PERSON_ID = AP.MARINE_CANDIDATE_ID AND 
  AP.EXAM_DATE = (SELECT MAX(AP1.EXAM_DATE) FROM ANNUAL_PHYSICAL AP1  
    WHERE AP1.MARINE_CANDIDATE_ID = AP.MARINE_CANDIDATE_ID)) 
 LEFT OUTER JOIN MEDICAL_DISPOSITION D ON AP.MEDICAL_DISPOSITION_ID = D.MEDICAL_DISPOSITION_ID 
 
--- FLIGHT PHYSICAL DATA 
UPDATE  
 #NWA_VIEW 
SET 
 FLIGHT_PHYSICAL_DATE   = FP.EXAM_DATE,  
 FLIGHT_PHYSICAL_RESULT = CASE D.MEDICAL_DISPOSITION_CODE 
     WHEN 'Q' THEN 'QUAL' 
     WHEN 'DQ' THEN 'DQ' 
     ELSE SPACE(0) 
     END 
FROM 
 #NWA_VIEW V INNER JOIN FLIGHT_PHYSICAL FP ON 
  (V.PERSON_ID = FP.MARINE_CANDIDATE_ID AND 
  FP.EXAM_DATE = (SELECT MAX(FP1.EXAM_DATE) FROM FLIGHT_PHYSICAL FP1  
    WHERE FP1.MARINE_CANDIDATE_ID = FP.MARINE_CANDIDATE_ID)) 
 LEFT OUTER JOIN MEDICAL_DISPOSITION D ON FP.MEDICAL_DISPOSITION_ID = D.MEDICAL_DISPOSITION_ID 
 
--- DEFINE THE MAX MEDICAL TYPE 
UPDATE  
 #NWA_VIEW 
SET 
 MAX_MEDICAL_EXAM_TYPE = CASE (SELECT MAX(EXAM_DATE) FROM  
     ((SELECT MEPS_MEDICAL_EXAM_DATE AS EXAM_DATE FROM #NWA_VIEW V1 WHERE V1.PERSON_ID = V.PERSON_ID) UNION 
     (SELECT ANNUAL_PHYSICAL_DATE FROM #NWA_VIEW V1 WHERE V1.PERSON_ID = V.PERSON_ID) UNION 
     (SELECT FLIGHT_PHYSICAL_DATE FROM #NWA_VIEW V1 WHERE V1.PERSON_ID = V.PERSON_ID)) AS MEDICAL_DATES) 
     WHEN MEPS_MEDICAL_EXAM_DATE THEN 'M' 
     WHEN ANNUAL_PHYSICAL_DATE THEN 'A' 
     WHEN FLIGHT_PHYSICAL_DATE  THEN 'F' 
     ELSE NULL 
     END 
FROM 
 #NWA_VIEW V  
 
--- SET THE MAX MEDICAL DATE AND RESULT 
UPDATE  
 #NWA_VIEW 
SET 
 MAX_MEDICAL_EXAM_DATE  = CASE MAX_MEDICAL_EXAM_TYPE  
     WHEN 'M' THEN MEPS_MEDICAL_EXAM_DATE 
     WHEN 'A' THEN ANNUAL_PHYSICAL_DATE 
     WHEN 'F' THEN FLIGHT_PHYSICAL_DATE 
     ELSE NULL 
     END,  
 MAX_MEDICAL_RESULT  = CASE MAX_MEDICAL_EXAM_TYPE  
     WHEN 'M' THEN MEPS_MEDICAL_RESULT 
     WHEN 'A' THEN ANNUAL_PHYSICAL_RESULT 
     WHEN 'F' THEN FLIGHT_PHYSICAL_RESULT 
     ELSE NULL 
     END  
FROM 
 #NWA_VIEW V  
 
 
--- ASTB DATA 
;WITH T AS 
( 
 SELECT ROW_NUMBER() OVER ( 
   PARTITION BY MARINE_CANDIDATE_ID 
   ORDER BY MARINE_CANDIDATE_ID, EXAM_DATE DESC, UPDATE_DATE DESC ) AS rowNum 
  ,MARINE_CANDIDATE_ID 
  ,PROFESSED_EXAM_TYPE 
  ,EXAM_DATE 
  ,EXAM_SCORE 
  ,EXAM_SCORE2 
  ,EXAM_SCORE3 
 FROM  
  MCRISS.dbo.CANDIDATE_PROFESSED_EXAM 
 WHERE  
  MARINE_CANDIDATE_ID IN (SELECT PERSON_ID FROM #NWA_VIEW ) 
  AND PROFESSED_EXAM_TYPE = 'V'  
) 
SELECT * INTO #AstbExams FROM T WHERE rowNum = 1; 
 
UPDATE  
 #NWA_VIEW 
SET 
 ASTB_DATE  = ASTB.EXAM_DATE, 
 ASTB_SCORE  = ASTB.EXAM_SCORE, 
 ASTB_SCORE_2 = ASTB.EXAM_SCORE2, 
 ASTB_SCORE_3 = ASTB.EXAM_SCORE3 
FROM 
 #NWA_VIEW V  
 INNER JOIN #ASTBExams ASTB ON V.PERSON_ID = ASTB.MARINE_CANDIDATE_ID 
 
 
--- RETRIEVE DATA 
SELECT 
    
 PERSON_ID, NWA_ID, CONTRACT_ID, PERSON_NAME, SSN,ORGANIZATION_OF_RECORD_ID, 
    CITY_CODE ,COUNTY_CODE,STATE_CODE , 
    STREET_ADDRESS, 
    STREET_ADDRESS_2, 
    ZIPCODE, 
    TELEPHONE_NUMBER, 
    EMAIL_ADDRESS, 
    RECRUITERNAME, 
    OSSNAME, 
 COALESCE(CONVERT(CHAR(6), DATE_STARTED_WORKING, 12), SPACE(0)) AS DATE_STARTED_WORKING, 
 COALESCE(CONVERT(CHAR(6), DATE_DECLARED, 12), SPACE(0)) AS DATE_DECLARED, 
 COALESCE(PROGRAM, SPACE(0)) AS PROGRAM, 
 COALESCE(RACE, SPACE(0)) AS RACE, 
 COALESCE(GENDER, SPACE(0)) AS GENDER, 
 COALESCE(CONVERT(CHAR(6), RAPP_ISSUE_DATE, 12), SPACE(0)) AS RAPP_ISSUE_DATE, 
 COALESCE(CONVERT(CHAR(6), RAPP_SUBMIT_DATE, 12), SPACE(0)) AS RAPP_SUBMIT_DATE, 
 COALESCE(CONVERT(CHAR(6), ASVAB_DATE, 12), SPACE(0)) AS ASVAB_DATE, 
 COALESCE(CONVERT(VARCHAR(4), EL_SCORE), SPACE(0)) AS EL_SCORE, 
 COALESCE(CONVERT(VARCHAR(4), AFQT_SCORE), SPACE(0)) AS AFQT_SCORE, 
 COALESCE(CONVERT(CHAR(6), MAX_MEDICAL_EXAM_DATE, 12), SPACE(0)) AS MEDICAL_EXAM_DATE, 
 COALESCE(MAX_MEDICAL_RESULT, SPACE(0)) AS MEDICAL_RESULT, 
 SPACE(0) AS MEDICAL_DOCS_SUBMIT_DATE, 
 COALESCE(CONVERT(CHAR(6), MEPS_MEDICAL_EXAM_DATE, 12), SPACE(0)) AS C, 
 COALESCE(CONVERT(CHAR(6), ASTB_DATE, 12), SPACE(0)) AS ASTB_DATE, 
 COALESCE(CONVERT(VARCHAR(4), ASTB_SCORE), SPACE(0)) AS ASTB_SCORE, 
 COALESCE(CONVERT(VARCHAR(4), ASTB_SCORE_2), SPACE(0)) AS ASTB_SCORE_2, 
 COALESCE(CONVERT(VARCHAR(4), ASTB_SCORE_3), SPACE(0)) AS ASTB_SCORE_3, 
 COALESCE(CONVERT(CHAR(6), PFT_DATE, 12), SPACE(0)) AS PFT_DATE, 
 COALESCE(CONVERT(VARCHAR(4), PFT_SCORE), SPACE(0)) AS PFT_SCORE, 
 COALESCE(NULLIF(TRANSCRIPT, 'N'), SPACE(0)) AS TRANSCRIPT, 
 COALESCE(NULLIF(ACF, 'N'), SPACE(0)) AS ACF, 
 COALESCE(NULLIF(EPSQ, 'N'), SPACE(0)) AS EPSQ, 
 COALESCE(NULLIF(BIRTH_VERIFICATION, 'N'), SPACE(0)) AS BIRTH_VERIFICATION,  
 COALESCE(NULLIF(POLICE, 'N'), SPACE(0)) AS POLICE, 
 COALESCE(NULLIF(DD_FORM_368, 'N'), SPACE(0)) AS DD_FORM_368, 
 COALESCE(NULLIF(SRB, 'N'), SPACE(0)) AS SRB, 
 COALESCE(NULLIF(DD214, 'N'), SPACE(0)) AS DD214, 
 COALESCE(NULLIF(DEAN, 'N'), SPACE(0)) AS DEAN, 
 COALESCE(NULLIF(PRF1, 'N'), SPACE(0)) AS PRF1, 
 COALESCE(NULLIF(PRF2, 'N'), SPACE(0)) AS PRF2, 
 COALESCE(NULLIF(EMPLOYER, 'N'), SPACE(0)) AS EMPLOYER, 
 COALESCE(NULLIF(I_AND_I, 'N'), SPACE(0)) AS I_AND_I, 
 COALESCE(NULLIF(OTHER1, 'N'), SPACE(0)) AS OTHER1, 
 COALESCE(NULLIF(OTHER2, 'N'), SPACE(0)) AS OTHER2,  
 COALESCE(NULLIF(PRINTS, 'N'), SPACE(0)) AS PRINTS, 
 COALESCE(NULLIF(PHOTO, 'N'), SPACE(0)) AS PHOTO, 
 COALESCE(WAIVER_NOTES, SPACE(0)) AS WAIVER_NOTES, 
 COALESCE(CONVERT(CHAR(6), CONTRACT_BEGIN_DATE, 12), SPACE(0)) AS CONTRACT_BEGIN_DATE, 
 FINAL_ACTION 
FROM 
 #NWA_VIEW  
 
--- CLEAN UP 
DROP TABLE #NWA_VIEW 
DROP TABLE #NonASTBExams 
DROP TABLE #ASTBExams]]></body>
<schema>72379847-5555-B149-4E45-17F849103A51</schema>
<database>B007042D-D2E3-F83F-481F-CEB23B21CB30</database>
</StoredProcedureSqlServerv2k5>