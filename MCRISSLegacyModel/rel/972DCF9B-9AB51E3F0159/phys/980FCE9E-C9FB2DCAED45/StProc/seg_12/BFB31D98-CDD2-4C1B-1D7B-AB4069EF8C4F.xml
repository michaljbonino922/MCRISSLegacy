<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureSqlServerv2k5 class="oracle.dbtools.crest.model.design.storage.sqlserver.v2k5.StoredProcedureSqlServerv2k5" name="[sp_ODSE_Insert_BridgeTable_Backup20190629]" directorySegmentName="seg_12" id="BFB31D98-CDD2-4C1B-1D7B-AB4069EF8C4F">
<sourceDDLFile>create ODSE script - MCRISS OTA.txt</sourceDDLFile>
<createdBy>MichalBonino</createdBy>
<createdTime>2024-04-29 23:42:37 UTC</createdTime>
<ownerDesignName>MCRISSLegacyModel</ownerDesignName>
<body><![CDATA[AS 
/******************************************************************************* 
** This Stored Procedure uses SYNONYMNs in order reference objects in the  
**  POS linked server. 
** 
** SYNONYM Legend:  
** 
**  SYNONYM  |  TABLE NAME 
** ODSE_CE  | CIVILIAN_EDUC_INFO_R147 
** ODSE_CS  | CUTTING_SCORE 
** ODSE_CSG | CUTTING_SCORE_GROUP 
** ODSE_DR  | DIARY_RESEARCH 
** ODSE_D   | DRILL 
** ODSE_EM  | ELECTRONIC_MAIL_R991 
** ODSE_EN  | ENLISTED 
** ODSE_IM  | INDIVIDUAL_MARINE 
** ODSE_MF  | MARINE_FAMILY 
** ODSE_MI  | MARINE_INFO 
** ODSE_NOK | MARINE_NEXT_OF_KIN 
** ODSE_MD  | MONITOR_DETAILS 
** ODSE_MA  | MOS_ADDITIONAL 
** ODSE_PC  | PAY_CONTROL 
** ODSE_PI  | PERSON_IDENTIFICATION_R159 
** ODSE_R   | RESERVE 
** ODSE_S   | SEPARATION 
** ODSE_ST  | SERVICE_TOUR 
** ODSE_TS  | TEST_SCORE 
** ODSE_WC  | WEIGHT_CONTROL_R113 
** 
 
Changed 10-19-2016: 
 
,MF.PARENT2_ADDRESS1 AS 'MOTHER_ADDRESS1'  --Change Made by Paul a.er ODSE changes in Marine_Family Table 
,MF.PARENT2_ADDRESS2 AS 'MOTHER_ADDRESS2'  --Change Made by Paul a.er ODSE changes in Marine_Family Table 
,MF.PARENT2_NAME AS 'MOTHER_Name'          --Change Made by Paul a.er ODSE changes in Marine_Family Table 
 
Change 6-27-2018  
Replaced the ODSE_MD sec.on to pull from the table in the local ODSE database 
a.er it's pre lodaded  every day. 
********************************************************************************/ 
 
 
/* * * * * * * * * * * * * * * * * * * * * * * * * * * * 
CREATE TEMP TABLE FOR MONITOR_DETAILS 
 * * * * * * * * * * * * * * * * * * * * * * * * * * * */ 
 Truncate table [ODSE].[dbo].[ODSE_MD] 
 insert into [ODSE].[dbo].[ODSE_MD] 
 Select * from [ODSE].[dbo].[ODSE_MD_Raw] 
 
 
SELECT DISTINCT  IMD.SSN 
    ,IMD.DRAW_CASE_SIGNAL_CODE 
INTO ##MONITOR_DETAILS 
FROM (SELECT SSN  
  FROM ODSE_AllMarineLeads  
  WHERE NEW_LEAD = 1) AS IMAR 
JOIN [ODSE].[dbo].[ODSE_MD] IMD ON IMAR.SSN = IMD.SSN 
WHERE IMD.CYCLE_DATE = (SELECT MAX(M2.CYCLE_DATE) AS MAXDATE 
      FROM [ODSE].[dbo].[ODSE_MD] M2 
      WHERE  M2.SSN = IMAR.SSN) 
 AND IMD.MONITOR_DETAILS_ID = ( SELECT MAX(M3.MONITOR_DETAILS_ID) AS MONITOR_DETAILS_ID 
         FROM [ODSE].[dbo].[ODSE_MD] M3 
         WHERE  M3.SSN = IMAR.SSN) 
 
PRINT '##MONITOR_DETAILS COMPLETE' 
 
 
/* * * * * * * * * * * * * * * * * * * * * * * * * * * * 
CREATE TEMP TABLE FOR MARINE_NEXT_OF_KIN 
 * * * * * * * * * * * * * * * * * * * * * * * * * * * */ 
 
SELECT  INK.SSN  
  ,INK.NOK_RELATIONSHIP 
  ,INK.NOK_TELEPHONE 
  ,MD.DRAW_CASE_SIGNAL_CODE 
INTO ##ODSE_NEXT_OF_KIN 
FROM (SELECT SSN  
  FROM ODSE_AllMarineLeads  
  WHERE NEW_LEAD = 1) AS IMAR 
JOIN ODSE_NOK INK ON IMAR.SSN = INK.SSN 
LEFT JOIN ##MONITOR_DETAILS MD ON IMAR.SSN = MD.SSN 
WHERE INK.MARINE_NEXT_OF_KIN_ID = 1  
 
PRINT '##ODSE_NEXT_OF_KIN COMPLETE' 
 
 
/* * * * * * * * * * * * * * * * * * * * * * * * * * * * 
CREATE TEMP TABLE FOR ELECTRONIC_MAIL_R991 
 * * * * * * * * * * * * * * * * * * * * * * * * * * * */ 
 
SELECT  IEM.SSN  
  ,IEM.ELECTRONIC_MAIL_ADDRESS_TEXT  
  ,MAX(IEM.REMARK_SEQUENCE_NUMBER_RMK_991) AS REMARK_SEQUENCE_NUMBER_RMK_991 
INTO ##ODSE_ELECTRONIC_MAIL 
FROM ( SELECT SSN  
  FROM ODSE_AllMarineLeads  
  WHERE NEW_LEAD = 1) AS IMAR 
JOIN ODSE_EM IEM ON IMAR.SSN = IEM.SSN 
GROUP BY  IEM.SSN 
   ,IEM.ELECTRONIC_MAIL_ADDRESS_TEXT 
 
PRINT '##ODSE_ELECTRONIC_MAIL COMPLETE' 
 
 
/* * * * * * * * * * * * * * * * * * * * * * * * * * * * 
CREATE TEMP TABLE FOR CIVILIAN_EDUC_INFO_R147 
 * * * * * * * * * * * * * * * * * * * * * * * * * * * */ 
 
 
SELECT  ICE.SSN 
  ,MAX(ICE.CIVILIAN_EDUC_LEVEL_CODE) AS CIVILIAN_EDUC_LEVEL_CODE 
INTO ##ODSE_CIVILIAN_EDUC 
FROM (SELECT SSN  
  FROM ODSE_AllMarineLeads  
  WHERE NEW_LEAD = 1) AS IMAR 
JOIN ODSE_CE ICE ON IMAR.SSN = ICE.SSN 
GROUP BY ICE.SSN 
 
PRINT '##ODSE_CIVILIAN_EDUC COMPLETE' 
 
 
/* * * * * * * * * * * * * * * * * * * * * * * * * * * * 
CREATE TEMP TABLE FOR MOS_ADDITIONAL 
 * * * * * * * * * * * * * * * * * * * * * * * * * * * */ 
 
 
SELECT  IMAR.SSN 
  ,ADD_FIRST.MOS_ADDITIONAL_REMARK_CODE AS ADDL_FIRST_MOS_CODE 
  ,ADD_SEC.MOS_ADDITIONAL_REMARK_CODE AS ADDL_SECOND_MOS_CODE 
  ,NULL AS ADDL_THIRD_MOS_CODE 
INTO ##ODSE_MOS_ADDITIONAL 
FROM (SELECT SSN  
  FROM ODSE_AllMarineLeads  
  WHERE NEW_LEAD = 1) AS IMAR 
LEFT JOIN ( SELECT SSN, MOS_ADDITIONAL_REMARK_CODE 
   FROM ODSE_MA MA 
   WHERE MA.REMARK_SEQUENCE_NUMBER_RMK_144 = '99999'  
    AND MA.MOS_ADDITIONAL_REMARK_CODE IS NOT NULL  
    AND MA.MOS_ADDITIONAL_REMARK_CODE <> '0000'  
    AND MA.MOS_PRIMARY_REMARK_CODE IS NOT NULL) AS ADD_FIRST ON IMAR.SSN = ADD_FIRST.SSN 
LEFT JOIN ( SELECT SSN, MOS_ADDITIONAL_REMARK_CODE   
   FROM ODSE_MA MA 
   WHERE MA.REMARK_SEQUENCE_NUMBER_RMK_144 = '99998'  
    AND MA.MOS_ADDITIONAL_REMARK_CODE IS NOT NULL  
    AND MA.MOS_ADDITIONAL_REMARK_CODE <> '0000'  
    AND MA.MOS_PRIMARY_REMARK_CODE IS NOT NULL) AS ADD_SEC ON IMAR.SSN = ADD_SEC.SSN 
 
PRINT '##ODSE_MOS_ADDITIONAL COMPLETE' 
 
 
/* * * * * * * * * * * * * * * * * * * * * * * * * * * * 
CREATE TEMP TABLE FOR PERSON_IDENTIFICATION_R159 
 * * * * * * * * * * * * * * * * * * * * * * * * * * * */ 
   If OBJECT_ID('tempdb..##ODSE_PI','U') IS NOT NULL 
  DROP TABLE ##ODSE_PI 
 
Create table ##ODSE_PI(SSN Nvarchar(15), REMARK_SEQUENCE_NUMBER_RMK_159 INT) --select * from ##ODSE_PI 
Insert into ##ODSE_PI 
Select SSN,REMARK_SEQUENCE_NUMBER_RMK_159 from ODSE_PI 
 
SELECT  IPID.SSN 
  --,IPID.PERSON_HEIGHT_QUANTITY 
  ,null as PERSON_HEIGHT_QUANTITY 
  --,IPID.PERSON_WEIGHT  
  ,null as PERSON_WEIGHT 
INTO  ##ODSE_PERSON_ID 
FROM ( SELECT SSN  
  FROM ODSE_AllMarineLeads  
  WHERE NEW_LEAD = 1) AS IMAR 
JOIN ##ODSE_PI IPID ON Convert(char(10),IMAR.SSN) = Convert(char(10),IPID.SSN) 
WHERE IPID.REMARK_SEQUENCE_NUMBER_RMK_159 = ( SELECT MAX(IPID2.REMARK_SEQUENCE_NUMBER_RMK_159)  
            FROM ##ODSE_PI IPID2 
            WHERE Convert(char(10),IPID2.SSN) = Convert(char(10),IPID.SSN)) 
GROUP BY IPID.SSN /*, IPID.PERSON_HEIGHT_QUANTITY, IPID.PERSON_WEIGHT*/ 
ORDER BY IPID.SSN 
 
PRINT '##ODSE_PERSON_ID COMPLETE' 
 
 
/* * * * * * * * * * * * * * * * * * * * * * * * * * * * 
CREATE TEMP TABLE FOR WEIGHT_CONTROL_R113 
 * * * * * * * * * * * * * * * * * * * * * * * * * * * */ 
    If OBJECT_ID('tempdb..##ODSE_WC','U') IS NOT NULL 
  DROP TABLE ##ODSE_WC 
 
Create table ##ODSE_WC(SSN Nvarchar(15), REMARK_SEQUENCE_NUMBER_RMK_113 INT,WEIGHT_CONTROL_STATUS_CODE Varchar(10)) 
 
Insert into ##ODSE_WC 
Select SSN,REMARK_SEQUENCE_NUMBER_RMK_113,WEIGHT_CONTROL_STATUS_CODE from ODSE_WC 
 
SELECT DISTINCT  IW.SSN  
    ,IW.WEIGHT_CONTROL_STATUS_CODE  
INTO ##WEIGHT_CONTROL 
FROM ( SELECT SSN  
  FROM ODSE_AllMarineLeads  
  WHERE NEW_LEAD = 1) AS IMAR 
JOIN ##ODSE_WC IW ON Convert(varchar(10),IMAR.SSN) = Convert(varchar(10),IW.SSN) 
WHERE REMARK_SEQUENCE_NUMBER_RMK_113 = (SELECT MAX(w2.REMARK_SEQUENCE_NUMBER_RMK_113)  
          FROM ##ODSE_WC w2 
          WHERE Convert(varchar(10),w2.SSN) = Convert(varchar(10),IW.SSN)) 
  
PRINT '##WEIGHT_CONTROL COMPLETE' 
 
 
SELECT  EN.SSN, EN.COMPOSITE_SCORE 
  ,EN.CONDUCT_AVERAGE_SERVICE 
  ,EN.PROFICIENCY_AVERAGE_SERVICE 
INTO ##ENLISTED 
FROM ( SELECT SSN  
  FROM ODSE_AllMarineLeads  
  WHERE NEW_LEAD = 1) AS IMAR 
JOIN ODSE_EN EN ON IMAR.SSN = EN.SSN 
WHERE EN.CYCLE_DATE = ( SELECT MAX(E2.CYCLE_DATE) AS MAXDATE 
      FROM ODSE_EN E2 
      WHERE  E2.SSN = IMAR.SSN) 
 
PRINT '##ENLISTED COMPLETE' 
 
 
PRINT 'BEGINING MAIN SELECT' 
 
SELECT IM.SSN 
  ,MA.ADDL_FIRST_MOS_CODE 
  ,MA.ADDL_SECOND_MOS_CODE 
  ,MA.ADDL_THIRD_MOS_CODE 
  ,IM.ADDRESS_VALIDATION_DATE 
  ,IM.ARMED_FORCES_ACT_DU_BASE_DATE 
  ,IM.ARMED_FORCES_ORIG_ENTRY_DATE 
  ,TS.ASVAB_COMP_GENERAL_TECH_QY 
  ,TS.ASVAB_COMP_MECH_MAINT_QY 
  ,TS.ASVAB_COMP_CLERICAL_QY 
  ,TS.ASVAB_COMP_ELECTRONICS_QY 
  ,IM.BILLET_MOS 
  ,IM.CITY_ADDRESS 
  ,C.CIVILIAN_EDUC_LEVEL_CODE 
  ,IM.COMPONENT_CODE 
  ,MI.DATE_ENLISTMENT_OR_ACCEPTANCE 
  ,R.DATE_INITIAL_ENTRY_RESERVE 
  ,IM.DATE_OF_BIRTH 
  ,MI.DATE_OF_LAST_PHYSICAL 
  ,TS.DEFENSE_LANG_APT_BATTERY_SCORE 
  ,PC.DEPENDENT_CERTIFICATION_CODE 
  ,S.DROP_DISCHARGE_UNIT_DATE 
  ,TS.ELECTRONIC_DP_TEST_SCORE 
  ,E.ELECTRONIC_MAIL_ADDRESS_TEXT 
  ,IM.ETHNIC_GROUP 
  ,IM.EXPIRATION_OBLIGATED_SERVICE 
  ,IM.EXPIRATION_OF_ACTIVE_SERVICE 
  ,IM.FIRST_NAME 
  ,ST.FORMER_MONITORED_COMMAND_CODE 
  ,ST.FORMER_REPORTING_UNIT_CODE 
  ,TS.GCT_TEST_TOTAL 
  ,PID.PERSON_HEIGHT_QUANTITY 
  ,MI.HIV_III_TESTED 
  ,IM.HOME_OF_RECORD_CITY_CODE 
  ,IM.HOME_OF_RECORD_COUNTY 
  ,IM.HOME_OF_RECORD_STATE_COUNTRY 
  ,IM.HOME_TELEPHONE_NUMBER 
  ,IM.LAST_NAME 
  ,DR.LAST_TOUCHED_RECORD_DATE 
  ,IM.MARITAL_STATUS_CODE 
  ,IM.MIDDLE_INITIAL 
    ,MF.PARENT2_ADDRESS1 AS 'MOTHER_ADDRESS1'  --Change Made by Paul a.er ODSE changes in Marine_Family Table 
    ,MF.PARENT2_ADDRESS2 AS 'MOTHER_ADDRESS2'  --Change Made by Paul a.er ODSE changes in Marine_Family Table 
    ,MF.PARENT2_NAME AS 'MOTHER_Name'          --Change Made by Paul a.er ODSE changes in Marine_Family Table 
  ,MNK.NOK_RELATIONSHIP 
  ,MNK.NOK_TELEPHONE 
  ,IM.NUMBER_OF_DEPENDENTS 
  ,IM.PAY_ENTRY_BASE_DATE 
  ,IM.PLANNED_REENL_EXT_RETIRE_FLAG 
  ,IM.PRESENT_GRADE_CODE 
  ,IM.PRESENT_MONITORED_COMMAND_CODE 
  ,IM.PRESENT_RANK_DATE 
  ,IM.PRESENT_REPORTING_UNIT_CODE 
  ,IM.PRESENT_UNIT_JOINED_DATE 
  ,IM.PRIMARY_MOS_CODE 
  ,IM.RACE 
  ,IM.RECORD_STATUS_CODE 
  ,S.REENLIST_RECOMMENDATION_CODE 
  ,MI.RESERVE_COMPONENT_CODE 
  ,MI.RESERVE_EXP_CURRENT_CONTRACT 
  ,MI.RESERVE_RECORD_STATUS_CODE 
  ,IM.RESERVE_REPORTING_UNIT_CODE 
  ,IM.RESERVE_MONITORED_COMMAND_CODE 
  ,R.RESERVE_UNIT_JOIN_DATE 
  --,R.CRCR_CERTIFICATION_DATE 
        -- Temporary .x because SQL is having prblems conver.ng R.CRCR_CERTIFICATION_DATE to valid date 
  ,null as CRCR_CERTIFICATION_DATE 
  ,IM.ROTATION_TOUR_DATE 
  ,S.SEPARATION_CODE 
  ,'0' as SERVICE_MEDICAL_REC_BOOK_FLAG 
  ,IM.SEX 
  ,IM.STATE_ABBREVIATION 
  ,IM.STREET_ADDRESS 
  ,D.TOTAL_SATISFACTORY_YEAR 
  ,D.TOTAL_CAREER_RETIREMENT_POINTS 
  ,R.TRAINING_CATEGORY_PAY_GROUP 
  ,PID.PERSON_WEIGHT 
  ,WC.WEIGHT_CONTROL_STATUS_CODE 
  ,IM.WORK_TELEPHONE_NUMBER 
  ,IM.ZIP_CODE 
  ,EN2.COMPOSITE_SCORE 
  ,EN2.CONDUCT_AVERAGE_SERVICE 
  ,EN2.PROFICIENCY_AVERAGE_SERVICE 
  ,MNK.DRAW_CASE_SIGNAL_CODE 
INTO ##ODSE_CHANGED_MARINES 
FROM (SELECT SSN  
  FROM ODSE_AllMarineLeads  
  WHERE NEW_LEAD = 1) AS IMAR 
JOIN ODSE_IM IM ON IMAR.SSN= IM.SSN 
JOIN ODSE_MI MI ON IMAR.SSN = MI.SSN 
JOIN ODSE_MF MF ON IMAR.SSN = MF.SSN 
JOIN ODSE_ST ST ON IMAR.SSN = ST.SSN 
JOIN ODSE_PC PC ON IMAR.SSN = PC.SSN 
JOIN ODSE_D D ON IMAR.SSN = D.SSN 
JOIN ##ODSE_PERSON_ID PID ON IMAR.SSN = PID.SSN 
JOIN ##ODSE_MOS_ADDITIONAL MA ON IMAR.SSN = MA.SSN 
JOIN ODSE_R R ON IMAR.SSN = R.SSN 
JOIN ODSE_DR DR ON IMAR.SSN = DR.SSN 
JOIN ODSE_S S ON IMAR.SSN = S.SSN 
JOIN ODSE_TS TS ON IMAR.SSN = TS.SSN 
JOIN ##ODSE_NEXT_OF_KIN MNK ON IMAR.SSN = MNK.SSN 
JOIN ##ODSE_CIVILIAN_EDUC C ON IMAR.SSN = C.SSN 
JOIN ##ODSE_ELECTRONIC_MAIL E ON IMAR.SSN = E.SSN 
JOIN ##WEIGHT_CONTROL WC ON IMAR.SSN = WC.SSN 
JOIN ##ENLISTED EN2 ON IMAR.SSN = EN2.SSN  
 
/* * * * * * * * * * * * * * * * * * * * * * * * * * * * 
 BEGIN INSERT FOR NEW SSN FOR MARINE LEADS 
* * * * * * * * * * * * * * * * * * * * * * * * * * * */ 
 
INSERT INTO dbo.ODSE_BridgeToPSR 
( 
  SSN 
 ,ADDL_FIRST_MOS_CODE 
 ,ADDL_SECOND_MOS_CODE 
 ,ADDL_THIRD_MOS_CODE 
 ,ALMRS_ADDRESS_VALIDATION_DATE 
 ,ALMRS_ARMED_FORCES_ACT_DU_BASE_DATE 
 ,ALMRS_ARMED_FORCES_ORIG_ENTRY_DATE 
 ,ASVAB_COMP_GENERAL_TECH 
 ,ASVAB_COMP_MECH_MAINT 
 ,ASVAB_COMP_CLERICAL 
 ,ASVAB_COMP_ELECTRONICS 
 ,BILLET_MOS_CODE 
 ,CITY_ADDRESS 
 ,ALMRS_CIVILIAN_EDUC_LEVEL_CODE 
 ,COMPONENT_CODE 
 ,ALMRS_DATE_ENLISTMENT_OR_ACCEPTANCE 
 ,ALMRS_DATE_INITIAL_ENTRY_RESERVE 
 ,DATE_OF_BIRTH 
 ,DATE_OF_LAST_PHYSICAL 
 ,ALMRS_DEFENSE_LANG_APT_BATTERY_SCORE 
 ,DEPENDENT_CERTIFICATION_CODE 
 ,DROP_DISCHARGE_UNIT_DATE 
 ,ELECTRONIC_DP_TEST_SCORE 
 ,ELECTRONIC_MAIL_ADDRESS_TEXT 
 ,ETHNIC_GROUP_CODE 
 ,EXPIRATION_OBLIGATED_SERVICE 
 ,EXPIRATION_OF_ACTIVE_SERVICE 
 ,FIRST_NAME 
 ,FORMER_MONITORED_COMMAND_CODE 
 ,FORMER_REPORTING_UNIT_CODE 
 ,ALMRS_GCT_TEST_TOTAL 
 ,ALMRS_HEIGHT 
 ,ALMRS_HIV_III_TESTED 
 ,HOME_OF_RECORD_CITY_CODE 
 ,HOME_OF_RECORD_COUNTY 
 ,HOME_OF_RECORD_STATE_COUNTRY 
 ,HOME_TELEPHONE_NUMBER 
 ,LAST_NAME 
 ,ALMRS_LAST_TOUCHED_RECORD_DATE 
 ,MARITAL_STATUS_CODE 
 ,MIDDLE_INITIAL 
 ,MOTHER_ADDRESS1 
 ,MOTHER_ADDRESS2 
 ,MOTHER_NAME 
 ,NOK_RELATIONSHIP1_CODE 
 ,NOK_TELEPHONE1 
 ,NUMBER_OF_DEPENDENTS 
 ,PAY_ENTRY_BASE_DATE 
 ,PLANNED_REENL_EXT_RETIRE_FLAG 
 ,PRESENT_GRADE_CODE 
 ,PRESENT_MONITORED_COMMAND_CODE 
 ,PRESENT_RANK_DATE 
 ,PRESENT_REPORTING_UNIT_CODE 
 ,PRESENT_UNIT_JOINED_DATE 
 ,PRIMARY_MOS_CODE 
 ,ALMRS_RACE_CODE 
 ,ALMRS_RECORD_STATUS_CODE 
 ,REENLIST_RECOMMENDATION_CODE 
 ,RESERVE_COMPONENT_CODE 
 ,RESERVE_EXP_CURRENT_CONTRACT 
 ,RESERVE_RECORD_STATUS_CODE 
 ,RESERVE_REPORTING_UNIT_CODE 
 ,RESERVE_MONITORED_COMMAND_CODE 
 ,RESERVE_UNIT_JOIN_DATE 
 ,CRCR_CERTIFICATION_DATE 
 ,ALMRS_ROTATION_TOUR_DATE 
 ,SEPARATION_CODE 
 ,SERVICE_MEDICAL_REC_BOOK_FLAG 
 ,SEX 
 ,STATE_ABBREVIATION 
 ,STREET_ADDRESS 
 ,ALMRS_TOTAL_SATISFACTORY_YEAR 
 ,TOTAL_CAREER_RETIREMENT_POINTS 
 ,ALMRS_TRAINING_CATEGORY_PAY_GROUP 
 ,ALMRS_WEIGHT 
 ,ALMRS_WEIGHT_CONTROL_STATUS_CODE 
 ,WORK_TELEPHONE_NUMBER 
 ,ZIP_CODE 
 ,COMPOSITE_SCORE 
 ,CONDUCT_AVERAGE_SERVICE 
 ,PROFICIENCY_AVERAGE_SERVICE 
 ,DRAW_CASE_SIGNAL_CODE 
 ,LAST_UPDATED_BY_ODSE 
 ,PSR_UPDATE_PENDING 
) 
SELECT DISTINCT * 
  ,getdate()  
  ,1 
FROM ##ODSE_CHANGED_MARINES 
WHERE SSN NOT IN ( SELECT SSN  
     FROM ODSE_BridgeToPSR) 
 
PRINT 'CHANGED MARINES INSERTED INTO BRIDGE' 
 
/* * * * * * * * * * * * * * * * * * * * * * * * * * * * 
 BEGIN INSERT FOR NEW SSN FOR MARINE RECRUITERS 
* * * * * * * * * * * * * * * * * * * * * * * * * * * */ 
 
INSERT INTO dbo.ODSE_BridgeToPSR 
( 
  SSN 
 ,BILLET_MOS_CODE 
 ,CURRENT_TOUR_BEGIN_DATE 
 ,DATE_OF_BIRTH 
 ,FIRST_NAME 
 ,LAST_NAME 
 ,MIDDLE_INITIAL 
 ,SEX 
 ,PRESENT_MONITORED_COMMAND_CODE 
 ,PRESENT_REPORTING_UNIT_CODE 
 ,PRIMARY_MOS_CODE 
 ,RESERVE_REPORTING_UNIT_CODE 
 ,RESERVE_MONITORED_COMMAND_CODE 
 ,PRESENT_GRADE_CODE 
 ,LAST_UPDATED_BY_ODSE 
 ,PSR_UPDATE_PENDING 
) 
SELECT  SSN 
  ,BILLET_MOS 
  ,CURRENT_TOUR_BEGIN_DATE 
  ,DATE_OF_BIRTH 
  ,FIRST_NAME 
  ,LAST_NAME 
  ,MIDDLE_INITIAL 
  ,SEX 
  ,PRESENT_MONITORED_COMMAND_CODE 
  ,PRESENT_REPORTING_UNIT_CODE 
  ,PRIMARY_MOS_CODE 
  ,RESERVE_REPORTING_UNIT_CODE 
  ,RESERVE_MONITORED_COMMAND_CODE 
  ,PRESENT_GRADE_CODE 
  ,getdate()  
  ,1 
FROM ODSE_IM 
WHERE SSN NOT IN (SELECT SSN  
      FROM ODSE_BridgeToPSR) 
AND RESERVE_REPORTING_UNIT_CODE = '88850' 
AND RESERVE_MONITORED_COMMAND_CODE = 'ARP' 
 
PRINT 'MARINE RECRUITERS INSERTED INTO BRIDGE' 
/* * * * * * * * * * * * * * * * * * * * * * * * * * * * 
TEMP TABLE CLEANUP 
* * * * * * * * * * * * * * * * * * * * * * * * * * * */ 
  
DROP TABLE ##ODSE_CHANGED_MARINES 
DROP TABLE ##ODSE_NEXT_OF_KIN 
DROP TABLE ##ODSE_ELECTRONIC_MAIL 
DROP TABLE ##ODSE_CIVILIAN_EDUC 
DROP TABLE ##ODSE_MOS_ADDITIONAL 
DROP TABLE ##ODSE_PERSON_ID 
DROP TABLE ##WEIGHT_CONTROL 
DROP TABLE ##MONITOR_DETAILS 
DROP TABLE ##ENLISTED 
If OBJECT_ID('tempdb..##ODSE_PI','U') IS NOT NULL 
  DROP TABLE ##ODSE_PI]]></body>
<schema>CEC76C37-9D45-8E15-510C-CBE87FFE10F5</schema>
<database>0070DB58-AADF-159B-2831-3CD8EEAC6A57</database>
</StoredProcedureSqlServerv2k5>