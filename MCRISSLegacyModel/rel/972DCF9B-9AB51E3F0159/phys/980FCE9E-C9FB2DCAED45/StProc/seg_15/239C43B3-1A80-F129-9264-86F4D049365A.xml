<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureSqlServerv2k5 class="oracle.dbtools.crest.model.design.storage.sqlserver.v2k5.StoredProcedureSqlServerv2k5" name="[sp_GetAc.vityAchieved]" directorySegmentName="seg_15" id="239C43B3-1A80-F129-9264-86F4D049365A">
<sourceDDLFile>Appian.sql</sourceDDLFile>
<createdBy>MichalBonino</createdBy>
<createdTime>2024-04-29 23:57:47 UTC</createdTime>
<ownerDesignName>MCRISSLegacyModel</ownerDesignName>
<body><![CDATA[@Organiza.onID  int, 
 @Ac.vityDate   date.me,  
 @Ac.vityEnddate  date.me 
AS 
 
SET NOCOUNT ON 
 
DECLARE @Organiza.onType as Varchar(3) 
 
SET @Organiza.onID = COALESCE(@Organiza.onID, 900) 
SET @Organiza.onType = (SELECT ORGANIZATION_TYPE FROM RECRUITING_ORGANIZATION WHERE ORGANIZATION_ID = @Organiza.onID) 
 
SELECT * INTO #SUBORGS FROM dbo.GetOrgHierarchy(@Organiza.onID) 
 
SELECT 
 SO.ORG_ID, 
 SO.LONG_NAME, 
 SUM(COALESCE(RA.TCS, 0)) AS TCS,  
 SUM(COALESCE(RA.TC_CONTACTS, 0)) AS TC_CONTACTS,  
 SUM(COALESCE(RA.TC_APPOINTMENTS, 0)) AS TC_APPOINTMENTS,  
 SUM(COALESCE(RA.TC_INTERVIEWS, 0)) AS TC_INTERVIEWS, 
 SUM(COALESCE(RA.OTS, 0)) AS OTS,  
 SUM(COALESCE(RA.OT_INTERVIEWS, 0)) AS OT_INTERVIEWS,  
 SUM(COALESCE(RA.ACS, 0)) AS ACS,  
 SUM(COALESCE(RA.AC_APPOINTMENTS, 0)) AS AC_APPOINTMENTS,  
 SUM(COALESCE(RA.AC_INTERVIEWS, 0)) AS AC_INTERVIEWS,  
 SUM(COALESCE(RA.HVS, 0)) AS HVS,  
 SUM(COALESCE(RA.HV_CONTACTS, 0)) AS HV_CONTACTS,  
 SUM(COALESCE(RA.HV_APPOINTMENTS, 0)) AS HV_APPOINTMENTS,  
 SUM(COALESCE(RA.HV_INTERVIEWS, 0)) AS HV_INTERVIEWS, 
 SO.SHORT_NAME, 
 SO.ORG_TYPE, 
 SO.REG_ID, 
 SO.DIST_ID, 
 SO.RS_ID, 
 SO.RSS_ID 
INTO 
 #RSS_DATA 
FROM 
 #SUBORGS SO 
 LEFT OUTER JOIN RSS_ACTIVITY RA ON  
  (SO.ORG_ID = RA.ORGANIZATION_ID AND 
  RA.ACTIVITY_DATE BETWEEN @Ac.vityDate AND @Ac.vityEndDate) 
WHERE 
 (DATEDIFF(MONTH, SO.EFFECTIVE_DATE, @Ac.vityDate) >= 0) AND ORG_TYPE = 'RSS' 
GROUP BY 
 SO.ORG_ID, SO.LONG_NAME, SO.SHORT_NAME, SO.ORG_TYPE, SO.REG_ID, SO.DIST_ID, SO.RS_ID, SO.RSS_ID 
ORDER BY 
 SO.REG_ID, SO.DIST_ID, SO.RS_ID, SO.RSS_ID, SO.SHORT_NAME 
 
SELECT 
 CASE @Organiza.onType 
  WHEN 'H' THEN REG_ID 
  WHEN 'R' THEN DIST_ID 
  WHEN 'D' THEN RS_ID 
  WHEN 'RS' THEN RSS_ID 
 END AS ORGANIZATION_ID, 
 SUM(RSS.TCS) AS TCS, 
 SUM(RSS.TC_CONTACTS) AS TC_CONTACTS,  
 SUM(RSS.TC_APPOINTMENTS) AS TC_APPOINTMENTS,  
 SUM(RSS.TC_INTERVIEWS) AS TC_INTERVIEWS, 
 SUM(RSS.OTS) AS OTS,  
 SUM(RSS.OT_INTERVIEWS) AS OT_INTERVIEWS,  
 SUM(RSS.ACS) AS ACS,  
 SUM(RSS.AC_APPOINTMENTS) AS AC_APPOINTMENTS,  
 SUM(RSS.AC_INTERVIEWS) AS AC_INTERVIEWS,  
 SUM(RSS.HVS) AS HVS,  
 SUM(RSS.HV_CONTACTS) AS HV_CONTACTS,  
 SUM(RSS.HV_APPOINTMENTS) AS HV_APPOINTMENTS,  
 SUM(RSS.HV_INTERVIEWS) AS HV_INTERVIEWS 
INTO 
 #RESULTS 
FROM 
 #RSS_DATA RSS 
WHERE 
 @Organiza.onID = CASE @Organiza.onType 
    WHEN 'H' THEN @Organiza.onID 
    WHEN 'R' THEN REG_ID 
    WHEN 'D' THEN DIST_ID 
    WHEN 'RS' THEN RS_ID 
     END 
GROUP BY 
 CASE @Organiza.onType 
  WHEN 'H' THEN REG_ID 
  WHEN 'R' THEN DIST_ID 
  WHEN 'D' THEN RS_ID 
  WHEN 'RS' THEN RSS_ID 
 END 
 
SELECT 
 R.ORGANIZATION_ID, 
 RO.NAME, 
 TCS, 
 TC_CONTACTS, 
 TC_APPOINTMENTS, 
 TC_INTERVIEWS, 
 OTS, 
 OT_INTERVIEWS, 
 ACS, 
 AC_APPOINTMENTS, 
 AC_INTERVIEWS, 
 HVS, 
 HV_CONTACTS, 
 HV_APPOINTMENTS, 
 HV_INTERVIEWS, 
 (SELECT COALESCE(SUM(RAGS.GRAD_INTERVIEWS) + SUM(RAGS.SENIOR_INTERVIEWS), 0) 
  FROM RSS_ACTIVITY_GRAD_SENIOR RAGS WHERE R.ORGANIZATION_ID = RAGS.ORGANIZATION_ID AND 
   DATEDIFF(DAY, @Ac.vityDate, RAGS.ACTIVITY_DATE) >= 0 AND 
   DATEDIFF(DAY, RAGS.ACTIVITY_DATE, @Ac.vityEndDate) >= 0) AS CAI_INTERVIEWS 
FROM 
 #RESULTS R INNER JOIN 
 RECRUITING_ORGANIZATION RO ON 
  (R.ORGANIZATION_ID = RO.ORGANIZATION_ID) 
ORDER BY 
 RO.NAME 
 
-- CLEAN UP 
DROP TABLE #RESULTS 
DROP TABLE #RSS_DATA 
DROP TABLE #SUBORGS 
 
SET NOCOUNT OFF]]></body>
<schema>DD6CF638-A2EB-2E1B-FF13-422CA718DE2D</schema>
<database>EA42DEDC-DFC5-B775-3079-AD0E133F5E1D</database>
</StoredProcedureSqlServerv2k5>