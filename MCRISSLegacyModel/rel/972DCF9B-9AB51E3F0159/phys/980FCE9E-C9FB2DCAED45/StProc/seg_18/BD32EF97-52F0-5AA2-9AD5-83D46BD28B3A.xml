<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureSqlServerv2k5 class="oracle.dbtools.crest.model.design.storage.sqlserver.v2k5.StoredProcedureSqlServerv2k5" name="[sp_GetMUDDeletedZips]" directorySegmentName="seg_18" id="BD32EF97-52F0-5AA2-9AD5-83D46BD28B3A">
<sourceDDLFile>create MCRISS script - MCRISS OTA.txt</sourceDDLFile>
<createdBy>MichalBonino</createdBy>
<createdTime>2024-04-29 19:28:41 UTC</createdTime>
<ownerDesignName>MCRISSLegacyModel</ownerDesignName>
<body><![CDATA[AS 
 
 
SET NOCOUNT ON 
 
--- SELECT WHICH ZIPCODES ARE NOT IN THE QUARTERLY UPDATE THEREFORE SHOULD BE DELETED 
DECLARE @RecordsToDelete int 
 
SET @RecordsToDelete = (SELECT COUNT(*) FROM MUD_FILE MF WHERE NOT EXISTS (SELECT 1 FROM MUD_STAGING MS WHERE MS.ZIP = MF.ZIP)) 
 
IF @RecordsToDelete > 0 
 BEGIN 
  
 --- STORE ZIPCODES TO BE ARCHIVED 
 INSERT INTO MUD_ARCHIVED_ZIPCODES(ZIP,FIPS,STATE,COUNTY,LAT,LONG,NOTIFY_FLAG,USER_LOGIN,UPDATE_DATE) 
 SELECT  
  MF.ZIP, 
  MF.FIPS, 
  MF.STATE, 
  MF.COUNTY, 
  MF.LAT, 
  MF.LONG, 
  0 AS NOTIFY_FLAG, 
  'SA' AS USER_LOGIN, 
  GETDATE() AS UPDATE_DATE 
 FROM  
  MUD_FILE MF WHERE NOT EXISTS (SELECT 1 FROM MUD_STAGING MS WHERE MS.ZIP = MF.ZIP) AND 
  NOT EXISTS (SELECT 1 FROM MUD_ARCHIVED_ZIPCODES MA WHERE MF.ZIP = MA.ZIP) 
 --- select * from mud_archived_zipcodes  
  
 
 END 
 --- RETURN DATA 
/* 
 SELECT  
  MF.ZIP, 
  MF.FIPS, 
  MF.STATE, 
  MF.COUNTY, 
  MF.LAT, 
  MF.LONG, 
  'SA' AS USER_LOGIN, 
  GETDATE() AS UPDATE_DATE 
 FROM MUD_FILE MF WHERE NOT EXISTS (SELECT 1 FROM MUD_STAGING MS WHERE MS.ZIP = MF.ZIP) 
 END 
 ELSE 
 BEGIN 
  PRINT 'NO DELETED ENTRIES EXISTS' 
 END 
*/ 
 
SET NOCOUNT OFF]]></body>
<schema>3925E19F-DC76-90A4-B892-D7A526C79632</schema>
<database>B007042D-D2E3-F83F-481F-CEB23B21CB30</database>
</StoredProcedureSqlServerv2k5>