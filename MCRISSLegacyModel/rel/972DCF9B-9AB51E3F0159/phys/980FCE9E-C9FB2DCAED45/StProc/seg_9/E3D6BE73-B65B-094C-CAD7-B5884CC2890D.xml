<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureSqlServerv2k5 class="oracle.dbtools.crest.model.design.storage.sqlserver.v2k5.StoredProcedureSqlServerv2k5" name="[GetRecrui.ngAc.vityAchieved]" directorySegmentName="seg_9" id="E3D6BE73-B65B-094C-CAD7-B5884CC2890D">
<sourceDDLFile>Appian.sql</sourceDDLFile>
<createdBy>MichalBonino</createdBy>
<createdTime>2024-04-29 23:57:49 UTC</createdTime>
<ownerDesignName>MCRISSLegacyModel</ownerDesignName>
<body><![CDATA[@Organiza.onID  int, 
 @Ac.vityDate   date.me,  
 @Ac.vityEnddate  date.me 
AS 
 
SET NOCOUNT ON 
 
IF (@Organiza.onID = 0) 
BEGIN 
 
 SELECT 
  NULL AS Recrui.ngOrgId, 
  NULL AS Recrui.ngOrgName, 
  NULL AS DateClosed, 
  NULL AS Ac.vityDate, 
  NULL AS IsEditable, 
  NULL AS TCS, 
  NULL AS TC_CONTACTS, 
  NULL AS TC_APPOINTMENTS, 
  NULL AS TC_INTERVIEWS, 
  NULL AS OTS, 
  NULL AS OT_INTERVIEWS, 
  NULL AS ACS, 
  NULL AS AC_APPOINTMENTS, 
  NULL AS AC_INTERVIEWS, 
  NULL AS HVS, 
  NULL AS HV_CONTACTS, 
  NULL AS HV_APPOINTMENTS, 
  NULL AS HV_INTERVIEWS, 
  NULL AS DCS, 
  NULL AS DC_CONTACTS, 
  NULL AS DC_APPOINTMENTS, 
  NULL AS DC_INTERVIEWS, 
  NULL AS CAI_INTERVIEWS 
 WHERE 1=2 
 
END 
ELSE 
BEGIN 
 
 DECLARE @Organiza.onType as Varchar(3) 
 
 SET @Organiza.onID = COALESCE(@Organiza.onID, 900) 
 SET @Organiza.onType = (SELECT ORGANIZATION_TYPE FROM [dbo].[RECRUITING_ORGANIZATION] WITH (NOLOCK) WHERE ORGANIZATION_ID = @Organiza.onID) 
 
 SELECT  
  RSS as ORG_ID, 
  org.Name AS LONG_NAME, 
  org.SHORT_NAME, 
  org.ORGANIZATION_TYPE as ORG_TYPE, 
  Region as REG_ID, 
  District as DIST_ID, 
  RS as RS_ID, 
  RSS as RSS_ID, 
  org.ISOPEN, 
  org.EFFECTIVE_DATE, 
  org.DateClosed 
 INTO #SUBORGS 
 FROM  
  [MCRISS].[USMC].[vwRecrui.ngOrgIDs] orgIds 
  INNER JOIN  [dbo].[RECRUITING_ORGANIZATION] org ON orgIds.RSS = org.ORGANIZATION_ID 
 WHERE 
  (CASE @Organiza.onType 
   WHEN 'H' THEN orgIds.HQ 
   WHEN 'R' THEN orgIds.Region 
   WHEN 'D' THEN orgIds.District 
   WHEN 'RS' THEN orgIds.RS 
   WHEN 'RSS' THEN orgIds.RSS 
  END = @Organiza.onID) 
  AND RSS IS NOT NULL 
 
 --SELECT * INTO #SUBORGS FROM [USMC].[GetOrgHierarchyIncludingClosed](@Organiza.onID) 
 
 SELECT 
  SO.ORG_ID, 
  SO.LONG_NAME, 
  SUM(COALESCE(RA.TCS, 0)) AS TCS,  
  SUM(COALESCE(RA.TC_CONTACTS, 0)) AS TC_CONTACTS,  
  SUM(COALESCE(RA.TC_APPOINTMENTS, 0)) AS TC_APPOINTMENTS,  
  SUM(COALESCE(RA.TC_INTERVIEWS, 0)) AS TC_INTERVIEWS, 
  SUM(COALESCE(RA.OTS, 0)) AS OTS,  
  SUM(COALESCE(RA.OT_INTERVIEWS, 0)) AS OT_INTERVIEWS,  
  SUM(COALESCE(RA.ACS, 0)) AS ACS,  
  SUM(COALESCE(RA.AC_APPOINTMENTS, 0)) AS AC_APPOINTMENTS,  
  SUM(COALESCE(RA.AC_INTERVIEWS, 0)) AS AC_INTERVIEWS,  
  SUM(COALESCE(RA.HVS, 0)) AS HVS,  
  SUM(COALESCE(RA.HV_CONTACTS, 0)) AS HV_CONTACTS,  
  SUM(COALESCE(RA.HV_APPOINTMENTS, 0)) AS HV_APPOINTMENTS,  
  SUM(COALESCE(RA.HV_INTERVIEWS, 0)) AS HV_INTERVIEWS, 
  SUM(COALESCE(RA.DCS, 0)) AS DCS,  
  SUM(COALESCE(RA.DC_CONTACTS, 0)) AS DC_CONTACTS,  
  SUM(COALESCE(RA.DC_APPOINTMENTS, 0)) AS DC_APPOINTMENTS,  
  SUM(COALESCE(RA.DC_INTERVIEWS, 0)) AS DC_INTERVIEWS, 
  SO.SHORT_NAME, 
  SO.ORG_TYPE, 
  SO.REG_ID, 
  SO.DIST_ID, 
  SO.RS_ID, 
  SO.RSS_ID 
 INTO 
  #RSS_DATA 
 FROM 
  #SUBORGS SO 
  LEFT OUTER JOIN [dbo].[RSS_ACTIVITY] RA ON  
    ( 
     SO.ORG_ID = RA.ORGANIZATION_ID 
     AND 
     RA.ACTIVITY_DATE BETWEEN @Ac.vityDate AND @Ac.vityEndDate 
    ) 
 
 WHERE 
  (SO.ISOPEN = 'Y'  
    OR  
    ( 
     SO.ISOPEN != 'Y'  
     AND  
     SO.DateClosed IS NOT NULL  
     AND  
     SO.DateClosed > @Ac.vityDate 
    ) 
  ) 
  AND  
  DATEDIFF(MONTH, SO.EFFECTIVE_DATE, @Ac.vityDate) >= 0  
  AND  
  ORG_TYPE = 'RSS' 
 GROUP BY 
   SO.ORG_ID 
  ,SO.LONG_NAME 
  ,SO.SHORT_NAME 
  ,SO.ORG_TYPE 
  ,SO.REG_ID 
  ,SO.DIST_ID 
  ,SO.RS_ID 
  ,SO.RSS_ID 
 ORDER BY 
   SO.REG_ID 
  ,SO.DIST_ID 
  ,SO.RS_ID 
  ,SO.RSS_ID 
  ,SO.SHORT_NAME 
 
 SELECT 
  CASE @Organiza.onType 
   WHEN 'H' THEN REG_ID 
   WHEN 'R' THEN DIST_ID 
   WHEN 'D' THEN RS_ID 
   WHEN 'RS' THEN RSS_ID 
  END AS ORGANIZATION_ID, 
  SUM(RSS.TCS) AS TCS, 
  SUM(RSS.TC_CONTACTS) AS TC_CONTACTS,  
  SUM(RSS.TC_APPOINTMENTS) AS TC_APPOINTMENTS,  
  SUM(RSS.TC_INTERVIEWS) AS TC_INTERVIEWS, 
  SUM(RSS.OTS) AS OTS,  
  SUM(RSS.OT_INTERVIEWS) AS OT_INTERVIEWS,  
  SUM(RSS.ACS) AS ACS,  
  SUM(RSS.AC_APPOINTMENTS) AS AC_APPOINTMENTS,  
  SUM(RSS.AC_INTERVIEWS) AS AC_INTERVIEWS,  
  SUM(RSS.HVS) AS HVS,  
  SUM(RSS.HV_CONTACTS) AS HV_CONTACTS,  
  SUM(RSS.HV_APPOINTMENTS) AS HV_APPOINTMENTS,  
  SUM(RSS.HV_INTERVIEWS) AS HV_INTERVIEWS, 
  SUM(RSS.DCS) AS DCS,  
  SUM(RSS.DC_CONTACTS) AS DC_CONTACTS,  
  SUM(RSS.DC_APPOINTMENTS) AS DC_APPOINTMENTS,  
  SUM(RSS.DC_INTERVIEWS) AS DC_INTERVIEWS 
 INTO 
  #RESULTS 
 FROM 
  #RSS_DATA RSS 
 WHERE 
  @Organiza.onID = CASE @Organiza.onType 
     WHEN 'H' THEN @Organiza.onID 
     WHEN 'R' THEN REG_ID 
     WHEN 'D' THEN DIST_ID 
     WHEN 'RS' THEN RS_ID 
      END 
 GROUP BY 
  CASE @Organiza.onType 
   WHEN 'H' THEN REG_ID 
   WHEN 'R' THEN DIST_ID 
   WHEN 'D' THEN RS_ID 
   WHEN 'RS' THEN RSS_ID 
  END 
 
 SELECT 
  R.ORGANIZATION_ID as Recrui.ngOrgId, 
  RO.NAME as Recrui.ngOrgName, 
  RO.DateClosed, 
  @Ac.vityDate as Ac.vityDate, 
  CASE  
   WHEN @Ac.vityDate = @Ac.vityEnddate THEN 1 
   ELSE 0 
  END AS IsEditable, 
  TCS, 
  TC_CONTACTS, 
  TC_APPOINTMENTS, 
  TC_INTERVIEWS, 
  OTS, 
  OT_INTERVIEWS, 
  ACS, 
  AC_APPOINTMENTS, 
  AC_INTERVIEWS, 
  HVS, 
  HV_CONTACTS, 
  HV_APPOINTMENTS, 
  HV_INTERVIEWS, 
  DCS, 
  DC_CONTACTS, 
  DC_APPOINTMENTS, 
  DC_INTERVIEWS, 
  (SELECT COALESCE(SUM(RAGS.GRAD_INTERVIEWS) + SUM(RAGS.SENIOR_INTERVIEWS), 0) 
   FROM [dbo].[RSS_ACTIVITY_GRAD_SENIOR] RAGS WITH (NOLOCK) WHERE R.ORGANIZATION_ID = RAGS.ORGANIZATION_ID AND 
    DATEDIFF(DAY, @Ac.vityDate, RAGS.ACTIVITY_DATE) >= 0 AND 
    DATEDIFF(DAY, RAGS.ACTIVITY_DATE, @Ac.vityEndDate) >= 0) AS CAI_INTERVIEWS 
 FROM 
  #RESULTS R INNER JOIN 
  [dbo].[RECRUITING_ORGANIZATION] RO ON 
   (R.ORGANIZATION_ID = RO.ORGANIZATION_ID) 
 ORDER BY 
  RO.NAME 
 
 -- CLEAN UP 
 DROP TABLE #RESULTS 
 DROP TABLE #RSS_DATA 
 DROP TABLE #SUBORGS 
END 
 
SET NOCOUNT OFF]]></body>
<schema>E9C4E37D-78A2-31F9-D580-7C2848ACFCB7</schema>
<database>EA42DEDC-DFC5-B775-3079-AD0E133F5E1D</database>
</StoredProcedureSqlServerv2k5>