<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureSqlServerv2k5 class="oracle.dbtools.crest.model.design.storage.sqlserver.v2k5.StoredProcedureSqlServerv2k5" name="[sp_GetNWAHistory]" directorySegmentName="seg_19" id="45B2CBA3-4109-237D-5BF9-D28018FDAB33">
<sourceDDLFile>Appian.sql</sourceDDLFile>
<createdBy>MichalBonino</createdBy>
<createdTime>2024-04-29 23:57:48 UTC</createdTime>
<ownerDesignName>MCRISSLegacyModel</ownerDesignName>
<body><![CDATA[@SSN as char(9) 
AS 
 
SELECT 
 P.PERSON_ID,  
 P.LAST_NAME, P.FIRST_NAME, P.LEGAL_MIDDLE_NAME AS MIDDLE_NAME, 
 COALESCE(P.SUFFIX_CD, SPACE(0)) AS SUFFIX, 
 P.SOCIAL_SECURITY_NUMBER,  
 CONVERT(CHAR(11), MC.DATE_OF_BIRTH, 106) AS DATE_OF_BIRTH,  
 COALESCE(MC.GENDER_CODE, SPACE(0)) GENDER_CODE, 
 (SELECT RO.SHORT_NAME FROM RECRUITING_ORGANIZATION RO WHERE RO.ORGANIZATION_ID = N.ORGANIZATION_OF_RECORD_ID) AS [RSS/OSS], 
 COALESCE(CPE.PROFESSED_EXAM_TYPE, SPACE(0)) AS TEST_TYPE,  
 COALESCE(CONVERT(CHAR(11), CPE.EXAM_DATE, 106), SPACE(0))  AS TEST_DATE,  
 COALESCE(CPE.EXAM_SCORE, SPACE(0)) AS EXAM_SCORE, 
 COALESCE(N.PARENTAL_CONSENT, SPACE(0)) AS PARENTAL_CONSENT, 
 COALESCE(MC.RACE_CODE, SPACE(0)) AS RACE_CODE, 
 COALESCE(MC.ETHNIC_CODE, SPACE(0)) AS ETHNIC_CODE, 
 COALESCE(MC.MARITAL_STATUS_CODE, SPACE(0)) AS MARITAL_STATUS_CODE, 
 COALESCE(MC.RELIGION_CODE, SPACE(0)) AS RELIGION_CODE, 
 COALESCE(MC.COUNTRY_OF_ORIGIN, SPACE(0)) AS COUNTRY_OF_ORIGIN, 
 COALESCE(MC.CITIZENSHIP, SPACE(0)) AS CITIZENSHIP, 
 COALESCE(MC.DRIVER_LICENSE_NUM, SPACE(0)) AS DRIVER_LICENSE_NUM, 
 COALESCE(MC.DRIVER_LICENSE_STATE, SPACE(0)) AS DRIVER_LICENSE_STATE, 
 COALESCE(CONVERT(CHAR(11), MC.DRIVER_LICENSE_EXP, 106), SPACE(0)) AS DRIVER_LICENSE_EXP, 
 N.ORGANIZATION_OF_RECORD_ID, N.RECRUITER_OF_RECORD_ID,  
 (SELECT RP.RANK_CODE FROM RECRUITING_PERSON RP  
  WHERE RP.RECRUITING_PERSON_ID = N.RECRUITER_OF_RECORD_ID) + SPACE(1) +  
 (SELECT RTRIM(P2.LAST_NAME) + SPACE(1) + RTRIM(P2.FIRST_NAME) + SPACE(1) +  
  COALESCE(RTRIM(P2.LEGAL_MIDDLE_NAME), SPACE(0)) FROM PERSON P2 WHERE 
   P2.PERSON_ID = N.RECRUITER_OF_RECORD_ID) AS RECRUITER_OF_RECORD, 
 N.COMP_CHANGE_FLAG,  
 CASE  
  WHEN CS.STATUS_TYPE = 'E' AND N.COMP_CHANGE_FLAG = 'Y' THEN COALESCE(CONVERT(CHAR(11), C.DISCHARGE_DATE, 106), SPACE(0)) 
  ELSE SPACE(0)  
 END AS DISCHARGE_DATE, 
 N.NWA_DATE_STARTED_WORKING AS INITIAL_CONTACT, 
 CASE  
  WHEN N.NWA_ID IS NOT NULL THEN 'Y'  
  ELSE 'N'  
 END AS NWA_DATA_EXISTS, 
 --- MEPCOM RACE AND ETHNIC DATA 
 COALESCE(MC.MEPCOM_RACE_CODE, SPACE(0)) AS MEPCOM_RACE_CATEGORY_CODE, 
 COALESCE(MC.MEPCOM_ETHNIC_CODE, SPACE(0)) AS MEPCOM_ETHNIC_CATEGORY_CODE, 
 COALESCE(ARN.ARN, SPACE(0)) AS ARN,  
 COALESCE(ME.ETHNIC_CATEGORY_DESC, SPACE(0)) AS MEPCOM_ETHNIC_CATEGORY_DESCRIPTION,  
 COALESCE(E.ETHNIC_ABBREVEATION, SPACE(0)) AS ETHNIC_DESCRIPTION, 
 COALESCE(MR.RACE_CATEGORY_DESC, SPACE(0)) AS MEPCOM_RACE_CATEGORY_DESCRIPTION, 
 COALESCE(R.RACE_DESC, SPACE(0)) AS RACE_DESCRIPTION, 
 COALESCE(RS_DUAL.SOURCE_DESCRIPTION, SPACE(0)) AS SOURCE_DUAL_DESCRIPTION 
FROM   
 PERSON P INNER JOIN NWA N ON  
  (P.PERSON_ID = N.MARINE_CANDIDATE_ID AND 
  P.SOCIAL_SECURITY_NUMBER = @SSN) 
 INNER JOIN MARINE_CANDIDATE MC ON N.MARINE_CANDIDATE_ID = MC.MARINE_CANDIDATE_ID 
 INNER JOIN CANDIDATE_STATUS CS ON  
  (N.NWA_ID = CS.NWA_ID AND 
  CS.CANDIDATE_STATUS_ID = dbo.GetMaxStatusID(CS.NWA_ID)) 
 LEFT OUTER JOIN MEPCOM_ETHNIC_CATEGORY ME ON MC.MEPCOM_ETHNIC_CODE = ME.ETHNIC_CATEGORY_CODE 
 LEFT OUTER JOIN ETHNIC E ON MC.ETHNIC_CODE = E.ETHNIC_CODE 
 LEFT OUTER JOIN MEPCOM_RACE_CATEGORY MR ON MC.MEPCOM_RACE_CODE = MR.RACE_CATEGORY_CODE 
 LEFT OUTER JOIN RACE R ON MC.RACE_CODE = R.RACE_CODE 
 LEFT OUTER JOIN CANDIDATE_PROFESSED_EXAM CPE ON MC.MARINE_CANDIDATE_ID = CPE.MARINE_CANDIDATE_ID 
 LEFT OUTER JOIN CANDIDATE_EDUCATION CE ON MC.MARINE_CANDIDATE_ID = CE.MARINE_CANDIDATE_ID 
 LEFT OUTER JOIN CONTRACT C ON N.NWA_ID = C.NWA_ID 
 LEFT OUTER JOIN ALIEN_REGISTRATION ARN ON MC.MARINE_CANDIDATE_ID = ARN.MARINE_CANDIDATE_ID 
 LEFT OUTER JOIN RECRUITING_SOURCE RS_DUAL ON N.SOURCE_CODE_DUAL = RS_DUAL.SOURCE_CODE]]></body>
<schema>DD6CF638-A2EB-2E1B-FF13-422CA718DE2D</schema>
<database>EA42DEDC-DFC5-B775-3079-AD0E133F5E1D</database>
</StoredProcedureSqlServerv2k5>