<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureSqlServerv2k5 class="oracle.dbtools.crest.model.design.storage.sqlserver.v2k5.StoredProcedureSqlServerv2k5" name="[sp_GetOSONa.onalTicketList]" directorySegmentName="seg_19" id="27242F8F-035E-EA75-73D0-7E0033FBEC87">
<sourceDDLFile>Appian.sql</sourceDDLFile>
<createdBy>MichalBonino</createdBy>
<createdTime>2024-04-29 23:57:48 UTC</createdTime>
<ownerDesignName>MCRISSLegacyModel</ownerDesignName>
<body><![CDATA[AS 
 
DECLARE @O.cerFY INT 
 
SET @O.cerFY = dbo.GetFYO.cers(GETDATE()) 
 
CREATE TABLE #OSO_NATIONAL_TICKET_LIST (RECRUITER_ID INT NULL, ORG_ID INT NULL, RECRUITER_NAME VARCHAR(100) NULL, OSS VARCHAR(50) NULL, NUMBER_OF_CONTRACTS INT NULL) 
 
SET NOCOUNT ON 
 
INSERT INTO #OSO_NATIONAL_TICKET_LIST (RECRUITER_ID, ORG_ID, RECRUITER_NAME, OSS) 
SELECT  
 RP.RECRUITING_PERSON_ID, RP.ORGANIZATION_ID,  
 LTRIM(RTRIM(RP.RANK_CODE)) +  
 CASE  
  WHEN LEN(RP.RANK_CODE) > 0 THEN SPACE(1) 
  ELSE SPACE(0)  
 END +  
 LTRIM(RTRIM(P.LAST_NAME)) + ', ' + LTRIM(RTRIM(P.FIRST_NAME)) +  
  COALESCE(SPACE(1) + LTRIM(RTRIM(P.LEGAL_MIDDLE_NAME)), SPACE(0)) AS RECRUITER_NAME, 
 LTRIM(RTRIM(OSS.NAME)) + ', ' + LTRIM(RTRIM(OSS.STATE_CODE))  AS OSS 
FROM 
 RECRUITING_PERSON RP INNER JOIN PERSON P ON  
  (RP.RECRUITING_PERSON_ID = P.PERSON_ID AND 
   RP.TOUR_END_DATE IS NULL AND  
  RP.RECRUITING_ROLE_ID = 'O') 
 INNER JOIN RECRUITING_ORGANIZATION OSS ON  
  (RP.ORGANIZATION_ID = OSS.ORGANIZATION_ID AND  
  OSS.ORGANIZATION_TYPE = 'OSS' AND  
  OSS.ISOPEN = 'Y') 
 
--- COUNT THE NUMBER OF CONTRACTS FOR EACH OSO 
UPDATE  
 #OSO_NATIONAL_TICKET_LIST 
SET 
 NUMBER_OF_CONTRACTS = (SELECT COUNT(C.CONTRACT_ID) FROM OFFICER_CONTRACT C INNER JOIN NWA N ON  
    (C.NWA_ID = N.NWA_ID AND  
    N.RECRUITER_OF_RECORD_ID = L.RECRUITER_ID AND  
    N.ORGANIZATION_OF_RECORD_ID = L.ORG_ID) 
    INNER JOIN OCS O ON  
    (N.NWA_ID = O.NWA_ID AND  
    O.OCS_ID = MCRISS.dbo.GetMaxOCSID(N.NWA_ID, null)) 
    INNER JOIN OCS_CLASS OC ON 
     (O.OCS_CLASS_ID = OC.CLASS_ID AND  
     OC.FISCAL_YEAR = @O.cerFY AND 
     OC.TRAINING_TYPE_CODE != 'PLCSR') 
    INNER JOIN CANDIDATE_STATUS CS ON 
     (N.NWA_ID = CS.NWA_ID AND  
     CS.CANDIDATE_STATUS_ID = MCRISS.dbo.GetMaxStatusID(N.NWA_ID) AND  
     EXISTS (SELECT 1 FROM CANDIDATE_STATUS CS1 WHERE CS1.NWA_ID = CS.NWA_ID AND 
      CS1.STATUS_TYPE = 'O' AND  
      CS1.STATUS_CODE = 'B' AND  
      CS1.DISPOSITION_CODE = 'R'))) 
FROM  
 #OSO_NATIONAL_TICKET_LIST L 
  
--- RETURN THE DATA 
SELECT  
 RECRUITER_NAME, OSS, NUMBER_OF_CONTRACTS  
FROM  
 #OSO_NATIONAL_TICKET_LIST  
ORDER BY  
 NUMBER_OF_CONTRACTS DESC 
 
--- CLEAN UP  
DROP TABLE #OSO_NATIONAL_TICKET_LIST 
SET NOCOUNT OFF]]></body>
<schema>DD6CF638-A2EB-2E1B-FF13-422CA718DE2D</schema>
<database>EA42DEDC-DFC5-B775-3079-AD0E133F5E1D</database>
</StoredProcedureSqlServerv2k5>