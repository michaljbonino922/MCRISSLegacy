<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureSqlServerv2k5 class="oracle.dbtools.crest.model.design.storage.sqlserver.v2k5.StoredProcedureSqlServerv2k5" name="[sp_UpdateGeoLoca.onUS]" directorySegmentName="seg_24" id="F7324661-7F30-910C-4A69-45FED4F4F8A4">
<sourceDDLFile>create MCRISS script - MCRISS OTA.txt</sourceDDLFile>
<createdBy>MichalBonino</createdBy>
<createdTime>2024-04-29 19:28:42 UTC</createdTime>
<ownerDesignName>MCRISSLegacyModel</ownerDesignName>
<body><![CDATA[AS 
 
 
--INSERT INTO GEO_LOCATION TABLE US_LOCATIONS WHICH EXIST IN THE ODSE 
--LK_USA_LOCATIONS TABLE, BUT DO NOT EXIST IN MCRISS' GEO_LOCATION TABLE 
INSERT INTO GEO_LOCATION 
( 
CITY_CODE, 
COUNTY_CODE, 
STATE_CODE, 
STATE_TEXT, 
COUNTY_TEXT, 
CITY_TEXT, 
USER_LOGIN, 
UPDATE_DATE, 
ROWGUID, 
COUNTRY_DESCRIPTION 
) 
SELECT 
ODSE_US.CITY_LOCATION_CD, 
ODSE_US.COUNTY_LOCATION_CD, 
ODSE_US.STATE_LOCATION_CD, 
ODSE_US.STATE_DESCRIPTION, 
ODSE_US.COUNTY_DESCRIPTION, 
ODSE_US.CITY_DESCRIPTION, 
'ODSE_IMPORT', 
GETDATE(), 
NEWID(), 
'UNITED STATES' 
FROM GEO_LOCATION GEO 
RIGHT OUTER JOIN OPENQUERY(POS,'SELECT * FROM ODSE.LK_USA_LOCATIONS_SI_04') ODSE_US   
ON ((GEO.CITY_CODE=ODSE_US.CITY_LOCATION_CD) 
AND (GEO.COUNTY_CODE=ODSE_US.COUNTY_LOCATION_CD) 
AND (GEO.STATE_CODE=ODSE_US.STATE_LOCATION_CD)) 
WHERE STATE_CODE IS NULL 
ORDER BY CITY_CODE,COUNTY_CODE ASC 
 
 
 
--Select rows from mcriss geo_loca.on that 
--exist in ODSE US table BUT WHOSE DATA IS DIFFERENT 
 
UPDATE GEO_LOCATION 
SET  STATE_TEXT=ODSE_US.STATE_DESCRIPTION, 
  COUNTY_TEXT=ODSE_US.COUNTY_DESCRIPTION, 
  CITY_TEXT=ODSE_US.CITY_DESCRIPTION, 
  USER_LOGIN='ODSE_IMPORT', 
  UPDATE_DATE=GETDATE() 
FROM   GEO_LOCATION GEO 
JOIN  OPENQUERY(POS,'SELECT * FROM ODSE.LK_USA_LOCATIONS_SI_04') ODSE_US   
ON  ((GEO.CITY_CODE=ODSE_US.CITY_LOCATION_CD) 
AND  (GEO.COUNTY_CODE=ODSE_US.COUNTY_LOCATION_CD) 
AND  (GEO.STATE_CODE=ODSE_US.STATE_LOCATION_CD)) 
WHERE GEO.STATE_TEXT<>ODSE_US.STATE_DESCRIPTION 
OR  GEO.COUNTY_TEXT<>ODSE_US.COUNTY_DESCRIPTION 
OR  GEO.CITY_TEXT<>ODSE_US.CITY_DESCRIPTION]]></body>
<schema>3925E19F-DC76-90A4-B892-D7A526C79632</schema>
<database>B007042D-D2E3-F83F-481F-CEB23B21CB30</database>
</StoredProcedureSqlServerv2k5>