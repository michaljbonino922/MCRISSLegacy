<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureSqlServerv2k5 class="oracle.dbtools.crest.model.design.storage.sqlserver.v2k5.StoredProcedureSqlServerv2k5" name="[GetAreaCanvassingMatrixMissionData]" directorySegmentName="seg_3" id="804BE3E1-E73D-3628-F849-1A12146B9B04">
<sourceDDLFile>Appian.sql</sourceDDLFile>
<createdBy>MichalBonino</createdBy>
<createdTime>2024-04-29 23:57:48 UTC</createdTime>
<ownerDesignName>MCRISSLegacy</ownerDesignName>
<body><![CDATA[@ORG_ID int, 
 @MISSION_FISCAL_YEAR int, 
 @SY_MONTH int = 7 
AS 
 
BEGIN 
 
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED 
 
-- Get the withdrawn NWAs so the withdrawn contracts can be excluded 
CREATE TABLE #Withdrawals(NWA_ID int) 
Insert into #Withdrawals 
Exec [MCRISS].[USMC].[GetWithdrawnNWAs]; 
 
 
Declare @SelectedDate date.me 
  
IF @SY_MONTH > 6 
BEGIN 
 set @SelectedDate = CAST(CAST( (@MISSION_FISCAL_YEAR-1) AS char(4)) + '-' + CAST( @SY_MONTH AS char(2)) + '-1' AS Date.me) 
END 
ELSE 
BEGIN 
 set @SelectedDate = CAST(CAST( (@MISSION_FISCAL_YEAR) AS char(4)) + '-' + CAST( @SY_MONTH AS char(2)) + '-1' AS Date.me) 
END 
 
Declare @MISSION_FISCAL_YEAR_PLUS1 int 
Declare @MISSION_FISCAL_YEAR_PLUS2 int 
Declare @MISSION_FISCAL_YEAR_PLUS3 int 
Declare @OCC_FIRST_CLASS_NUMBER int 
Declare @OCC_SECOND_CLASS_NUMBER int 
Declare @OCC_THIRD_CLASS_NUMBER int 
 
Declare @OCC_FIRST_CLASS_SEASON VARCHAR(10) 
Declare @OCC_SECOND_CLASS_SEASON VARCHAR(10) 
Declare @OCC_THIRD_CLASS_SEASON VARCHAR(10) 
 
set @MISSION_FISCAL_YEAR_PLUS1 = @MISSION_FISCAL_YEAR + 1; 
set @MISSION_FISCAL_YEAR_PLUS2 = @MISSION_FISCAL_YEAR + 2; 
set @MISSION_FISCAL_YEAR_PLUS3 = @MISSION_FISCAL_YEAR + 3; 
 
set @OCC_FIRST_CLASS_NUMBER = ( 
 select min(CLASS_NUMBER) from dbo.OCS_CLASS  
 where FISCAL_YEAR = @MISSION_FISCAL_YEAR and  
    TRAINING_TYPE_CODE = 'OCC') 
 
-- a.er ge.ng what is possibly the .rst class, walk the dates to verify it is truely the .rst class 
Declare @FallDate date.me 
set @FallDate = CAST(CAST( (@MISSION_FISCAL_YEAR-1) AS char(4)) + '-' + CAST( 7 AS char(2)) + '-31' AS Date.me) 
Declare @WinterDate date.me 
set @WinterDate = CAST(CAST( (@MISSION_FISCAL_YEAR-1) AS char(4)) + '-' + CAST( 11 AS char(2)) + '-30' AS Date.me) 
Declare @SummerDate date.me 
set @SummerDate = CAST(CAST( (@MISSION_FISCAL_YEAR) AS char(4)) + '-' + CAST( 3 AS char(2)) + '-31' AS Date.me) 
Declare @OCC_FIRST_CLASS_DATE date.me 
set @OCC_FIRST_CLASS_DATE = (select BoardDate from dbo.OCS_CLASS where CLASS_NUMBER = @OCC_FIRST_CLASS_NUMBER) 
Declare @OCC_FIRST_CLASS_DATE_plus1 date.me 
set @OCC_FIRST_CLASS_DATE_plus1 = (select BoardDate from dbo.OCS_CLASS where CLASS_NUMBER = (@OCC_FIRST_CLASS_NUMBER+1)) 
Declare @OCC_FIRST_CLASS_DATE_plus2 date.me 
set @OCC_FIRST_CLASS_DATE_plus2 = (select BoardDate from dbo.OCS_CLASS where CLASS_NUMBER = (@OCC_FIRST_CLASS_NUMBER+2)) 
 
IF @OCC_FIRST_CLASS_DATE IS NULL 
BEGIN 
 IF @SelectedDate <= @FallDate 
 BEGIN 
  set @OCC_FIRST_CLASS_SEASON = 'FALL' 
  set @OCC_SECOND_CLASS_SEASON = 'WINTER' 
  set @OCC_THIRD_CLASS_SEASON = 'SUMMER' 
 END 
 ELSE IF @SelectedDate <= @WinterDate 
 BEGIN 
  set @OCC_FIRST_CLASS_SEASON = 'WINTER' 
  set @OCC_SECOND_CLASS_SEASON = 'SUMMER' 
  set @OCC_THIRD_CLASS_SEASON = 'FALL' 
  set @OCC_FIRST_CLASS_NUMBER = @OCC_FIRST_CLASS_NUMBER + 1; 
 END 
 ELSE IF @SelectedDate <= @SummerDate 
 BEGIN 
  set @OCC_FIRST_CLASS_SEASON = 'SUMMER' 
  set @OCC_SECOND_CLASS_SEASON = 'FALL' 
  set @OCC_THIRD_CLASS_SEASON = 'WINTER' 
  set @OCC_FIRST_CLASS_NUMBER = @OCC_FIRST_CLASS_NUMBER + 2; 
 END 
 ELSE 
 BEGIN 
  set @OCC_FIRST_CLASS_SEASON = 'FALL' 
  set @OCC_SECOND_CLASS_SEASON = 'WINTER' 
  set @OCC_THIRD_CLASS_SEASON = 'SUMMER' 
  set @OCC_FIRST_CLASS_NUMBER = @OCC_FIRST_CLASS_NUMBER + 3; 
 END 
END 
ELSE 
BEGIN 
 IF @SelectedDate <= @OCC_FIRST_CLASS_DATE 
 BEGIN 
  set @OCC_FIRST_CLASS_SEASON = 'FALL' 
  set @OCC_SECOND_CLASS_SEASON = 'WINTER' 
  set @OCC_THIRD_CLASS_SEASON = 'SUMMER' 
 END 
 ELSE IF @SelectedDate <= @OCC_FIRST_CLASS_DATE_plus1 
 BEGIN 
  set @OCC_FIRST_CLASS_SEASON = 'WINTER' 
  set @OCC_SECOND_CLASS_SEASON = 'SUMMER' 
  set @OCC_THIRD_CLASS_SEASON = 'FALL' 
  set @OCC_FIRST_CLASS_NUMBER = @OCC_FIRST_CLASS_NUMBER + 1; 
 END 
 ELSE IF @SelectedDate <= @OCC_FIRST_CLASS_DATE_plus2 
 BEGIN 
  set @OCC_FIRST_CLASS_SEASON = 'SUMMER' 
  set @OCC_SECOND_CLASS_SEASON = 'FALL' 
  set @OCC_THIRD_CLASS_SEASON = 'WINTER' 
  set @OCC_FIRST_CLASS_NUMBER = @OCC_FIRST_CLASS_NUMBER + 2; 
 END 
 ELSE 
 BEGIN 
  set @OCC_FIRST_CLASS_SEASON = 'FALL' 
  set @OCC_SECOND_CLASS_SEASON = 'WINTER' 
  set @OCC_THIRD_CLASS_SEASON = 'SUMMER' 
  set @OCC_FIRST_CLASS_NUMBER = @OCC_FIRST_CLASS_NUMBER + 3; 
 END 
END 
 
set @OCC_SECOND_CLASS_NUMBER = @OCC_FIRST_CLASS_NUMBER + 1; 
set @OCC_THIRD_CLASS_NUMBER = @OCC_FIRST_CLASS_NUMBER + 2; 
 
 
-- Contracts made excluding OFFICER_COMPONENT_CODE '1E'(reservist) 
SELECT  
 CASE 
  WHEN N.OFFICER_COMPONENT_CODE IN ('0A', '0B', '0C', '0E') THEN 'PLC' 
  WHEN N.OFFICER_COMPONENT_CODE IN ('1A', '1B', '1C', '1H') THEN 'OCC' 
 END OFFICER_SOURCE_CODE,  
 CASE WHEN N.OFFICER_COMPONENT_CODE IN ('1A', '1B', '1C', '1H') THEN  
   CASE 
    WHEN  [CLASS_NUMBER] = @OCC_FIRST_CLASS_NUMBER THEN @OCC_FIRST_CLASS_SEASON 
    WHEN  [CLASS_NUMBER] = @OCC_SECOND_CLASS_NUMBER THEN @OCC_SECOND_CLASS_SEASON 
    WHEN  [CLASS_NUMBER] = @OCC_THIRD_CLASS_NUMBER THEN @OCC_THIRD_CLASS_SEASON 
   END 
  ELSE  
      CASE 
    WHEN n.SHIP_MISSION = @MISSION_FISCAL_YEAR + 1 AND oc.TRAINING_TYPE_CODE ='PLCCOMB'  THEN 'PLCCOMB' 
    WHEN n.SHIP_MISSION = @MISSION_FISCAL_YEAR + 2 AND  
         ( (oc.TRAINING_TYPE_CODE IN ('PLCJR', 'PLCSR')) OR 
        (oc.TRAINING_TYPE_CODE = 'PLCCOMB' AND N.OFFICER_COMPONENT_CODE = '0E') 
      )  THEN 'PLCSCR' 
    WHEN n.SHIP_MISSION = @MISSION_FISCAL_YEAR + 3 AND  
      ( (oc.TRAINING_TYPE_CODE IN ('PLCJR', 'PLCSR')) OR 
        (oc.TRAINING_TYPE_CODE = 'PLCCOMB' AND N.OFFICER_COMPONENT_CODE = '0E') 
      ) THEN 'PLCJR' 
   END       
 END AS TRAINING_TYPE_CODE, 
 CASE N.OFFICER_COMPONENT_CODE 
  WHEN  '0A' THEN 'NFO' 
  WHEN  '0B' THEN 'G' 
  WHEN  '0C' THEN 'A' 
  WHEN  '0E' THEN 'L' 
  WHEN  '1A' THEN 'L' 
  WHEN  '1B' THEN 'G' 
  WHEN  '1C' THEN 'A' 
  WHEN  '1H' THEN 'NFO'   
 END AS COMPONENT_CODE,  
 OC.CLASS_NUMBER AS CLASS_NUMBER, 
 CASE 
  WHEN (MC.RACE_CODE + MC.ETHNIC_CODE) IS NULL THEN NULL 
  WHEN (MC.RACE_CODE + MC.ETHNIC_CODE) IN 
    ('AA', 
     'C1','C2','C3','C4','C5','C6','C7','C9','CA','CB','CD','CE','CF','CG','CH','CJ', 
     'CK','CL','CP','CQ','CS','CT','CV','CW','CZ', 
     'EA','FA') THEN 'AA' 
  WHEN (MC.RACE_CODE + MC.ETHNIC_CODE) IN 
    ('EP','EZ','FP','FZ') THEN 'W' 
  WHEN (MC.RACE_CODE + MC.ETHNIC_CODE) IN 
    ('A4','A6','A9','AB','AS','BB','DB','E1','E4','E6','E9','EB','ES','F1','F4','F6', 
     'F9','FB','FS') THEN 'H' 
  ELSE 'O' 
 END AS DIVERSITY_CODE, 
 MC.GENDER_CODE AS GENDER_CODE 
INTO #CONTRACTS_MADE 
FROM NWA N    
 INNER JOIN OFFICER_CONTRACT OFC ON OFC.NWA_ID = N.NWA_ID 
 INNER JOIN OCS O ON O.NWA_ID = N.NWA_ID 
 INNER JOIN OCS_CLASS OC ON OC.CLASS_ID = O.OCS_CLASS_ID  
 INNER JOIN MARINE_CANDIDATE MC ON N.MARINE_CANDIDATE_ID = MC.MARINE_CANDIDATE_ID 
WHERE    
 ORGANIZATION_OF_RECORD_ID =  @ORG_ID  
 AND N.OFFICER_COMPONENT_CODE IS NOT NULL AND N.OFFICER_COMPONENT_CODE IN ('0A', '0B', '0C', '0E', '1A', '1B', '1C', '1H')   
 AND Mission_Year_Work_For = @MISSION_FISCAL_YEAR 
 AND OFC.contract_begin_Date =  
         (SELECT MIN(contract_begin_Date) 
       FROM MCRISS.dbo.OFFICER_CONTRACT OC 
       INNER JOIN NWA N ON N.NWA_ID =  OC.NWA_ID      
       INNER JOIN MARINE_CANDIDATE M ON  M.MARINE_CANDIDATE_ID = N.MARINE_CANDIDATE_ID 
       WHERE M.MARINE_CANDIDATE_ID = MC.MARINE_CANDIDATE_ID) 
 AND N.NWA_ID not in (SELECT NWA_ID FROM #Withdrawals) 
 
-- Contracts for reservist 
INSERT INTO #CONTRACTS_MADE 
SELECT    
 'OCC' AS OFFICER_SOURCE_CODE,   
 CASE 
  WHEN  [CLASS_NUMBER] = @OCC_FIRST_CLASS_NUMBER THEN @OCC_FIRST_CLASS_SEASON 
  WHEN  [CLASS_NUMBER] = @OCC_SECOND_CLASS_NUMBER THEN @OCC_SECOND_CLASS_SEASON 
  WHEN  [CLASS_NUMBER] = @OCC_THIRD_CLASS_NUMBER THEN @OCC_THIRD_CLASS_SEASON 
 END AS TRAINING_TYPE_CODE,  
   'OCR' AS COMPONENT_CODE,  
 OC.CLASS_NUMBER AS CLASS_NUMBER, 
 CASE 
  WHEN (MC.RACE_CODE + MC.ETHNIC_CODE) IS NULL THEN NULL 
  WHEN (MC.RACE_CODE + MC.ETHNIC_CODE) IN 
    ('AA', 
     'C1','C2','C3','C4','C5','C6','C7','C9','CA','CB','CD','CE','CF','CG','CH','CJ', 
     'CK','CL','CP','CQ','CS','CT','CV','CW','CZ', 
     'EA','FA') THEN 'AA' 
  WHEN (MC.RACE_CODE + MC.ETHNIC_CODE) IN 
    ('EP','EZ','FP','FZ') THEN 'W' 
  WHEN (MC.RACE_CODE + MC.ETHNIC_CODE) IN 
    ('A4','A6','A9','AB','AS','BB','DB','E1','E4','E6','E9','EB','ES','F1','F4','F6', 
     'F9','FB','FS') THEN 'H' 
  ELSE 'O' 
 END AS DIVERSITY_CODE, 
 MC.GENDER_CODE AS GENDER_CODE 
FROM NWA N    
 INNER JOIN OFFICER_CONTRACT OFC ON OFC.NWA_ID = N.NWA_ID 
 INNER JOIN OCS O ON O.NWA_ID = N.NWA_ID 
 INNER JOIN OCS_CLASS OC ON OC.CLASS_ID = O.OCS_CLASS_ID  
 INNER JOIN MARINE_CANDIDATE MC ON N.MARINE_CANDIDATE_ID = MC.MARINE_CANDIDATE_ID 
WHERE    
 ORGANIZATION_OF_RECORD_ID =  @ORG_ID  
 AND N.OFFICER_COMPONENT_CODE IS NOT NULL AND N.OFFICER_COMPONENT_CODE IN ('1E')   
 AND Mission_Year_Work_For = @MISSION_FISCAL_YEAR 
 AND OFC.contract_begin_Date =  
         (SELECT MIN(contract_begin_Date) 
       FROM MCRISS.dbo.OFFICER_CONTRACT OC 
       INNER JOIN NWA N ON N.NWA_ID =  OC.NWA_ID      
       INNER JOIN MARINE_CANDIDATE M ON  M.MARINE_CANDIDATE_ID = N.MARINE_CANDIDATE_ID 
       WHERE M.MARINE_CANDIDATE_ID = MC.MARINE_CANDIDATE_ID 
       AND N.OFFICER_COMPONENT_CODE = '1E') 
 AND N.NWA_ID not in (SELECT NWA_ID FROM #Withdrawals) 
 
 
-- ORGID 
select dis.nct ORGANIZATION_ID 
into #ORGID 
from dbo.OFFICER_SHIP_MISSION_PLAN 
where ORGANIZATION_ID = @ORG_ID 
 
-- PLC1 
select isnull(GROUND_MISSION, 0) as PLC1_GROUND, 
  isnull(NFO_MISSION, 0) as PLC1_NFO, 
  isnull(NAVAL_AIR_MISSION, 0) as PLC1_AIR, 
  isnull(LAW1_MISSION, 0) as PLC1_LAW1, 
  isnull(LAW2_MISSION, 0) as PLC1_LAW2, 
  isnull(LAW3_MISSION, 0) as PLC1_LAW3, 
        isnull(BLACK_MISSION, 0) as PLC1_BLACK, 
        isnull(HISPANIC_MISSION, 0) as PLC1_HISPANIC, 
        isnull(OTHER_MISSION, 0) as PLC1_OTHER, 
        isnull(FEMALE_MISSION, 0) as PLC1_FEMALE, 
        ORGANIZATION_ID, 
        (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCCOMB' 
   and COMPONENT_CODE = 'G') AS PLC1_GROUND_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCCOMB' 
   and COMPONENT_CODE = 'NFO') AS PLC1_NFO_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCCOMB' 
   and COMPONENT_CODE = 'A') AS PLC1_AIR_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCCOMB' 
   and COMPONENT_CODE = 'L') AS PLC1_LAW_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCCOMB' 
   and DIVERSITY_CODE = 'AA' and GENDER_CODE <> 'F') AS PLC1_BLACK_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCCOMB' 
   and DIVERSITY_CODE = 'H' and GENDER_CODE <> 'F') AS PLC1_HISPANIC_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCCOMB' 
   and DIVERSITY_CODE = 'O' and GENDER_CODE <> 'F') AS PLC1_OTHER_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCCOMB' 
   and GENDER_CODE = 'F') AS PLC1_FEMALE_CON 
into #PLC1 
from dbo.OFFICER_SHIP_MISSION_PLAN 
where ORGANIZATION_ID = @ORG_ID and FISCAL_YEAR = @MISSION_FISCAL_YEAR and GRAD_YEAR = @MISSION_FISCAL_YEAR_PLUS1 
 
-- PLC2 
select isnull(GROUND_MISSION, 0) as PLC2_GROUND, 
  isnull(NFO_MISSION, 0) as PLC2_NFO, 
  isnull(NAVAL_AIR_MISSION, 0) as PLC2_AIR, 
        isnull(BLACK_MISSION, 0) as PLC2_BLACK, 
        isnull(HISPANIC_MISSION, 0) as PLC2_HISPANIC, 
        isnull(OTHER_MISSION, 0) as PLC2_OTHER, 
        isnull(FEMALE_MISSION, 0) as PLC2_FEMALE, 
        ORGANIZATION_ID, 
        (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCSCR' 
   and COMPONENT_CODE = 'G') AS PLC2_GROUND_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCSCR' 
   and COMPONENT_CODE = 'NFO') AS PLC2_NFO_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCSCR' 
   and COMPONENT_CODE = 'A') AS PLC2_AIR_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCSCR' 
   and COMPONENT_CODE = 'L') AS PLC2_LAW_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCSCR' 
   and DIVERSITY_CODE = 'AA' and GENDER_CODE <> 'F') AS PLC2_BLACK_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCSCR' 
   and DIVERSITY_CODE = 'H' and GENDER_CODE <> 'F') AS PLC2_HISPANIC_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCSCR' 
   and DIVERSITY_CODE = 'O' and GENDER_CODE <> 'F') AS PLC2_OTHER_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCSCR' 
   and GENDER_CODE = 'F') AS PLC2_FEMALE_CON 
into #PLC2 
from dbo.OFFICER_SHIP_MISSION_PLAN 
where ORGANIZATION_ID = @ORG_ID and FISCAL_YEAR = @MISSION_FISCAL_YEAR and GRAD_YEAR = @MISSION_FISCAL_YEAR_PLUS2 
 
-- PLC3 
select isnull(GROUND_MISSION, 0) as PLC3_GROUND, 
  isnull(NFO_MISSION, 0) as PLC3_NFO, 
  isnull(NAVAL_AIR_MISSION, 0) as PLC3_AIR, 
        isnull(BLACK_MISSION, 0) as PLC3_BLACK, 
        isnull(HISPANIC_MISSION, 0) as PLC3_HISPANIC, 
        isnull(OTHER_MISSION, 0) as PLC3_OTHER, 
        isnull(FEMALE_MISSION, 0) as PLC3_FEMALE, 
        ORGANIZATION_ID, 
        (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCJR' 
   and COMPONENT_CODE = 'G') AS PLC3_GROUND_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCJR' 
   and COMPONENT_CODE = 'NFO') AS PLC3_NFO_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCJR' 
   and COMPONENT_CODE = 'A') AS PLC3_AIR_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCJR' 
   and COMPONENT_CODE = 'L') AS PLC3_LAW_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCJR' 
   and DIVERSITY_CODE = 'AA' and GENDER_CODE <> 'F') AS PLC3_BLACK_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCJR' 
   and DIVERSITY_CODE = 'H' and GENDER_CODE <> 'F') AS PLC3_HISPANIC_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCJR' 
   and DIVERSITY_CODE = 'O' and GENDER_CODE <> 'F') AS PLC3_OTHER_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'PLC' and TRAINING_TYPE_CODE = 'PLCJR' 
   and GENDER_CODE = 'F') AS PLC3_FEMALE_CON 
into #PLC3 
from dbo.OFFICER_SHIP_MISSION_PLAN 
where ORGANIZATION_ID = @ORG_ID and FISCAL_YEAR = @MISSION_FISCAL_YEAR and GRAD_YEAR = @MISSION_FISCAL_YEAR_PLUS3 
 
-- OCC1 
select isnull(GROUND_MISSION, 0) as OCC1_GROUND, 
  isnull(NFO_MISSION, 0) as OCC1_NFO, 
  isnull(NAVAL_AIR_MISSION, 0) as OCC1_AIR, 
  isnull(LAW1_MISSION, 0) as OCC1_LAW, 
        isnull(BLACK_MISSION, 0) as OCC1_BLACK, 
        isnull(HISPANIC_MISSION, 0) as OCC1_HISPANIC, 
        isnull(OTHER_MISSION, 0) as OCC1_OTHER, 
        isnull(FEMALE_MISSION, 0) as OCC1_FEMALE, 
        isnull(OCCR_GROUND_MISSION, 0) as OCCR1_GROUND, 
        isnull(OCC_CLASS_NUMBER, 0) as OCC_CLASS1, 
        ORGANIZATION_ID, 
        (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'FALL' 
   and COMPONENT_CODE = 'OCR') AS OCCR1_GROUND_CON, 
        (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'FALL' 
   and COMPONENT_CODE = 'G') AS OCC1_GROUND_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'FALL' 
   and COMPONENT_CODE = 'NFO') AS OCC1_NFO_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'FALL' 
   and COMPONENT_CODE = 'A') AS OCC1_AIR_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'FALL' 
   and COMPONENT_CODE = 'L') AS OCC1_LAW_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'FALL' 
   and DIVERSITY_CODE = 'AA' and GENDER_CODE <> 'F') AS OCC1_BLACK_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'FALL' 
   and DIVERSITY_CODE = 'H' and GENDER_CODE <> 'F') AS OCC1_HISPANIC_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'FALL' 
   and DIVERSITY_CODE = 'O' and GENDER_CODE <> 'F') AS OCC1_OTHER_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'FALL' 
   and GENDER_CODE = 'F') AS OCC1_FEMALE_CON 
into #OCC1 
from dbo.OFFICER_SHIP_MISSION_PLAN 
where ORGANIZATION_ID = @ORG_ID and OCC_CLASS_NUMBER = @OCC_FIRST_CLASS_NUMBER 
 
-- OCC2 
select isnull(GROUND_MISSION, 0) as OCC2_GROUND, 
  isnull(NFO_MISSION, 0) as OCC2_NFO, 
  isnull(NAVAL_AIR_MISSION, 0) as OCC2_AIR, 
  isnull(LAW1_MISSION, 0) as OCC2_LAW, 
        isnull(BLACK_MISSION, 0) as OCC2_BLACK, 
        isnull(HISPANIC_MISSION, 0) as OCC2_HISPANIC, 
        isnull(OTHER_MISSION, 0) as OCC2_OTHER, 
        isnull(FEMALE_MISSION, 0) as OCC2_FEMALE, 
        isnull(OCCR_GROUND_MISSION, 0) as OCCR2_GROUND, 
        isnull(OCC_CLASS_NUMBER, 0) as OCC_CLASS2, 
        ORGANIZATION_ID, 
        (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'WINTER' 
   and COMPONENT_CODE = 'OCR') AS OCCR2_GROUND_CON, 
        (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'WINTER' 
   and COMPONENT_CODE = 'G') AS OCC2_GROUND_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'WINTER' 
   and COMPONENT_CODE = 'NFO') AS OCC2_NFO_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'WINTER' 
   and COMPONENT_CODE = 'A') AS OCC2_AIR_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'WINTER' 
   and COMPONENT_CODE = 'L') AS OCC2_LAW_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'WINTER' 
   and DIVERSITY_CODE = 'AA' and GENDER_CODE <> 'F') AS OCC2_BLACK_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'WINTER' 
   and DIVERSITY_CODE = 'H' and GENDER_CODE <> 'F') AS OCC2_HISPANIC_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'WINTER' 
   and DIVERSITY_CODE = 'O' and GENDER_CODE <> 'F') AS OCC2_OTHER_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'WINTER' 
   and GENDER_CODE = 'F') AS OCC2_FEMALE_CON 
into #OCC2 
from dbo.OFFICER_SHIP_MISSION_PLAN 
where ORGANIZATION_ID = @ORG_ID and OCC_CLASS_NUMBER = @OCC_SECOND_CLASS_NUMBER 
 
-- OCC3 
select isnull(GROUND_MISSION, 0) as OCC3_GROUND, 
  isnull(NFO_MISSION, 0) as OCC3_NFO, 
  isnull(NAVAL_AIR_MISSION, 0) as OCC3_AIR, 
  isnull(LAW1_MISSION, 0) as OCC3_LAW, 
        isnull(BLACK_MISSION, 0) as OCC3_BLACK, 
        isnull(HISPANIC_MISSION, 0) as OCC3_HISPANIC, 
        isnull(OTHER_MISSION, 0) as OCC3_OTHER, 
        isnull(FEMALE_MISSION, 0) as OCC3_FEMALE, 
        isnull(OCCR_GROUND_MISSION, 0) as OCCR3_GROUND, 
        isnull(OCC_CLASS_NUMBER, 0) as OCC_CLASS3, 
        ORGANIZATION_ID, 
        (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'SUMMER' 
   and COMPONENT_CODE = 'OCR') AS OCCR3_GROUND_CON, 
        (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'SUMMER' 
   and COMPONENT_CODE = 'G') AS OCC3_GROUND_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'SUMMER' 
   and COMPONENT_CODE = 'NFO') AS OCC3_NFO_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'SUMMER' 
   and COMPONENT_CODE = 'A') AS OCC3_AIR_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'SUMMER' 
   and COMPONENT_CODE = 'L') AS OCC3_LAW_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'SUMMER' 
   and DIVERSITY_CODE = 'AA' and GENDER_CODE <> 'F') AS OCC3_BLACK_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'SUMMER' 
   and DIVERSITY_CODE = 'H' and GENDER_CODE <> 'F') AS OCC3_HISPANIC_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'SUMMER' 
   and DIVERSITY_CODE = 'O' and GENDER_CODE <> 'F') AS OCC3_OTHER_CON, 
  (select count(*) from #CONTRACTS_MADE 
   where OFFICER_SOURCE_CODE = 'OCC' and TRAINING_TYPE_CODE = 'SUMMER' 
   and GENDER_CODE = 'F') AS OCC3_FEMALE_CON 
into #OCC3 
from dbo.OFFICER_SHIP_MISSION_PLAN 
where ORGANIZATION_ID = @ORG_ID and OCC_CLASS_NUMBER = @OCC_THIRD_CLASS_NUMBER 
 
 
------ Finally, combine and .aten all the data 
 
select  isnull(#PLC1.PLC1_GROUND, 0) as PLC1_GROUND, 
  isnull(#PLC1.PLC1_NFO, 0) as PLC1_NFO, 
  isnull(#PLC1.PLC1_AIR, 0) as PLC1_AIR, 
  isnull(#PLC1.PLC1_LAW1, 0) as PLC1_LAW1, 
  isnull(#PLC1.PLC1_BLACK, 0) as PLC1_BLACK, 
  isnull(#PLC1.PLC1_HISPANIC, 0) as PLC1_HISPANIC, 
  isnull(#PLC1.PLC1_OTHER, 0) as PLC1_OTHER, 
  isnull(#PLC1.PLC1_FEMALE, 0) as PLC1_FEMALE, 
   
  CASE WHEN isnull(#PLC1.PLC1_GROUND, 0) - isnull(#PLC1.PLC1_GROUND_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC1.PLC1_GROUND, 0) - isnull(#PLC1.PLC1_GROUND_CON, 0) END 
   AS PLC1_GROUND_REM, 
  CASE WHEN isnull(#PLC1.PLC1_NFO, 0) - isnull(#PLC1.PLC1_NFO_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC1.PLC1_NFO, 0) - isnull(#PLC1.PLC1_NFO_CON, 0) END 
   AS PLC1_NFO_REM, 
  CASE WHEN isnull(#PLC1.PLC1_AIR, 0) - isnull(#PLC1.PLC1_AIR_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC1.PLC1_AIR, 0) - isnull(#PLC1.PLC1_AIR_CON, 0) END 
   AS PLC1_AIR_REM, 
  CASE WHEN isnull(#PLC1.PLC1_LAW1, 0) - isnull(#PLC1.PLC1_LAW_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC1.PLC1_LAW1, 0) - isnull(#PLC1.PLC1_LAW_CON, 0) END 
   AS PLC1_LAW_REM, 
  CASE WHEN isnull(#PLC1.PLC1_BLACK, 0) - isnull(#PLC1.PLC1_BLACK_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC1.PLC1_BLACK, 0) - isnull(#PLC1.PLC1_BLACK_CON, 0) END 
   AS PLC1_BLACK_REM, 
  CASE WHEN isnull(#PLC1.PLC1_HISPANIC, 0) - isnull(#PLC1.PLC1_HISPANIC_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC1.PLC1_HISPANIC, 0) - isnull(#PLC1.PLC1_HISPANIC_CON, 0) END 
   AS PLC1_HISPANIC_REM, 
  CASE WHEN isnull(#PLC1.PLC1_OTHER, 0) - isnull(#PLC1.PLC1_OTHER_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC1.PLC1_OTHER, 0) - isnull(#PLC1.PLC1_OTHER_CON, 0) END 
   AS PLC1_OTHER_REM, 
  CASE WHEN isnull(#PLC1.PLC1_FEMALE, 0) - isnull(#PLC1.PLC1_FEMALE_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC1.PLC1_FEMALE, 0) - isnull(#PLC1.PLC1_FEMALE_CON, 0) END 
   AS PLC1_FEMALE_REM, 
   
  isnull(#PLC2.PLC2_GROUND, 0) as PLC2_GROUND, 
  isnull(#PLC2.PLC2_NFO, 0) as PLC2_NFO, 
  isnull(#PLC2.PLC2_AIR, 0) as PLC2_AIR, 
  isnull(#PLC1.PLC1_LAW2, 0) as PLC1_LAW2, 
  isnull(#PLC2.PLC2_BLACK, 0) as PLC2_BLACK, 
  isnull(#PLC2.PLC2_HISPANIC, 0) as PLC2_HISPANIC, 
  isnull(#PLC2.PLC2_OTHER, 0) as PLC2_OTHER, 
  isnull(#PLC2.PLC2_FEMALE, 0) as PLC2_FEMALE, 
   
  CASE WHEN isnull(#PLC2.PLC2_GROUND, 0) - isnull(#PLC2.PLC2_GROUND_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC2.PLC2_GROUND, 0) - isnull(#PLC2.PLC2_GROUND_CON, 0) END 
   AS PLC2_GROUND_REM, 
  CASE WHEN isnull(#PLC2.PLC2_NFO, 0) - isnull(#PLC2.PLC2_NFO_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC2.PLC2_NFO, 0) - isnull(#PLC2.PLC2_NFO_CON, 0) END 
   AS PLC2_NFO_REM, 
  CASE WHEN isnull(#PLC2.PLC2_AIR, 0) - isnull(#PLC2.PLC2_AIR_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC2.PLC2_AIR, 0) - isnull(#PLC2.PLC2_AIR_CON, 0) END 
   AS PLC2_AIR_REM, 
  CASE WHEN isnull(#PLC1.PLC1_LAW2, 0) - isnull(#PLC2.PLC2_LAW_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC1.PLC1_LAW2, 0) - isnull(#PLC2.PLC2_LAW_CON, 0) END 
   AS PLC2_LAW_REM, 
  CASE WHEN isnull(#PLC2.PLC2_BLACK, 0) - isnull(#PLC2.PLC2_BLACK_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC2.PLC2_BLACK, 0) - isnull(#PLC2.PLC2_BLACK_CON, 0) END 
   AS PLC2_BLACK_REM, 
  CASE WHEN isnull(#PLC2.PLC2_HISPANIC, 0) - isnull(#PLC2.PLC2_HISPANIC_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC2.PLC2_HISPANIC, 0) - isnull(#PLC2.PLC2_HISPANIC_CON, 0) END 
   AS PLC2_HISPANIC_REM, 
  CASE WHEN isnull(#PLC2.PLC2_OTHER, 0) - isnull(#PLC2.PLC2_OTHER_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC2.PLC2_OTHER, 0) - isnull(#PLC2.PLC2_OTHER_CON, 0) END 
   AS PLC2_OTHER_REM, 
  CASE WHEN isnull(#PLC2.PLC2_FEMALE, 0) - isnull(#PLC2.PLC2_FEMALE_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC2.PLC2_FEMALE, 0) - isnull(#PLC2.PLC2_FEMALE_CON, 0) END 
   AS PLC2_FEMALE_REM, 
 
  isnull(#PLC3.PLC3_GROUND, 0) as PLC3_GROUND, 
  isnull(#PLC3.PLC3_NFO, 0) as PLC3_NFO, 
  isnull(#PLC3.PLC3_AIR, 0) as PLC3_AIR, 
  isnull(#PLC1.PLC1_LAW3, 0) as PLC1_LAW3, 
  isnull(#PLC3.PLC3_BLACK, 0) as PLC3_BLACK, 
  isnull(#PLC3.PLC3_HISPANIC, 0) as PLC3_HISPANIC, 
  isnull(#PLC3.PLC3_OTHER, 0) as PLC3_OTHER, 
  isnull(#PLC3.PLC3_FEMALE, 0) as PLC3_FEMALE, 
   
  CASE WHEN isnull(#PLC3.PLC3_GROUND, 0) - isnull(#PLC3.PLC3_GROUND_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC3.PLC3_GROUND, 0) - isnull(#PLC3.PLC3_GROUND_CON, 0) END 
   AS PLC3_GROUND_REM, 
  CASE WHEN isnull(#PLC3.PLC3_NFO, 0) - isnull(#PLC3.PLC3_NFO_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC3.PLC3_NFO, 0) - isnull(#PLC3.PLC3_NFO_CON, 0) END 
   AS PLC3_NFO_REM, 
  CASE WHEN isnull(#PLC3.PLC3_AIR, 0) - isnull(#PLC3.PLC3_AIR_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC3.PLC3_AIR, 0) - isnull(#PLC3.PLC3_AIR_CON, 0) END 
   AS PLC3_AIR_REM, 
  CASE WHEN isnull(#PLC1.PLC1_LAW3, 0) - isnull(#PLC3.PLC3_LAW_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC1.PLC1_LAW3, 0) - isnull(#PLC3.PLC3_LAW_CON, 0) END 
   AS PLC3_LAW_REM, 
  CASE WHEN isnull(#PLC3.PLC3_BLACK, 0) - isnull(#PLC3.PLC3_BLACK_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC3.PLC3_BLACK, 0) - isnull(#PLC3.PLC3_BLACK_CON, 0) END 
   AS PLC3_BLACK_REM, 
  CASE WHEN isnull(#PLC3.PLC3_HISPANIC, 0) - isnull(#PLC3.PLC3_HISPANIC_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC3.PLC3_HISPANIC, 0) - isnull(#PLC3.PLC3_HISPANIC_CON, 0) END 
   AS PLC3_HISPANIC_REM, 
  CASE WHEN isnull(#PLC3.PLC3_OTHER, 0) - isnull(#PLC3.PLC3_OTHER_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC3.PLC3_OTHER, 0) - isnull(#PLC3.PLC3_OTHER_CON, 0) END 
   AS PLC3_OTHER_REM, 
  CASE WHEN isnull(#PLC3.PLC3_FEMALE, 0) - isnull(#PLC3.PLC3_FEMALE_CON, 0) < 0 THEN 0 
   ELSE isnull(#PLC3.PLC3_FEMALE, 0) - isnull(#PLC3.PLC3_FEMALE_CON, 0) END 
   AS PLC3_FEMALE_REM, 
 
  isnull(#OCC1.OCC1_GROUND, 0) as OCC1_GROUND, 
  isnull(#OCC1.OCC1_NFO, 0) as OCC1_NFO, 
  isnull(#OCC1.OCC1_AIR, 0) as OCC1_AIR, 
  isnull(#OCC1.OCC1_LAW, 0) as OCC1_LAW, 
  isnull(#OCC1.OCC1_BLACK, 0) as OCC1_BLACK, 
  isnull(#OCC1.OCC1_HISPANIC, 0) as OCC1_HISPANIC, 
  isnull(#OCC1.OCC1_OTHER, 0) as OCC1_OTHER, 
  isnull(#OCC1.OCC1_FEMALE, 0) as OCC1_FEMALE, 
  isnull(#OCC1.OCCR1_GROUND, 0) as OCCR1_GROUND, 
  isnull(@OCC_FIRST_CLASS_NUMBER, 0) as OCC_CLASS1, 
   
  CASE WHEN isnull(#OCC1.OCCR1_GROUND, 0) - isnull(#OCC1.OCCR1_GROUND_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC1.OCCR1_GROUND, 0) - isnull(#OCC1.OCCR1_GROUND_CON, 0) END 
   AS OCCR1_GROUND_REM, 
  CASE WHEN isnull(#OCC1.OCC1_GROUND, 0) - isnull(#OCC1.OCC1_GROUND_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC1.OCC1_GROUND, 0) - isnull(#OCC1.OCC1_GROUND_CON, 0) END 
   AS OCC1_GROUND_REM, 
  CASE WHEN isnull(#OCC1.OCC1_NFO, 0) - isnull(#OCC1.OCC1_NFO_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC1.OCC1_NFO, 0) - isnull(#OCC1.OCC1_NFO_CON, 0) END 
   AS OCC1_NFO_REM, 
  CASE WHEN isnull(#OCC1.OCC1_AIR, 0) - isnull(#OCC1.OCC1_AIR_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC1.OCC1_AIR, 0) - isnull(#OCC1.OCC1_AIR_CON, 0) END 
   AS OCC1_AIR_REM, 
  CASE WHEN isnull(#OCC1.OCC1_LAW, 0) - isnull(#OCC1.OCC1_LAW_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC1.OCC1_LAW, 0) - isnull(#OCC1.OCC1_LAW_CON, 0) END 
   AS OCC1_LAW_REM, 
  CASE WHEN isnull(#OCC1.OCC1_BLACK, 0) - isnull(#OCC1.OCC1_BLACK_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC1.OCC1_BLACK, 0) - isnull(#OCC1.OCC1_BLACK_CON, 0) END 
   AS OCC1_BLACK_REM, 
  CASE WHEN isnull(#OCC1.OCC1_HISPANIC, 0) - isnull(#OCC1.OCC1_HISPANIC_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC1.OCC1_HISPANIC, 0) - isnull(#OCC1.OCC1_HISPANIC_CON, 0) END 
   AS OCC1_HISPANIC_REM, 
  CASE WHEN isnull(#OCC1.OCC1_OTHER, 0) - isnull(#OCC1.OCC1_OTHER_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC1.OCC1_OTHER, 0) - isnull(#OCC1.OCC1_OTHER_CON, 0) END 
   AS OCC1_OTHER_REM, 
  CASE WHEN isnull(#OCC1.OCC1_FEMALE, 0) - isnull(#OCC1.OCC1_FEMALE_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC1.OCC1_FEMALE, 0) - isnull(#OCC1.OCC1_FEMALE_CON, 0) END 
   AS OCC1_FEMALE_REM, 
   
  isnull(#OCC2.OCC2_GROUND, 0) as OCC2_GROUND, 
  isnull(#OCC2.OCC2_NFO, 0) as OCC2_NFO, 
  isnull(#OCC2.OCC2_AIR, 0) as OCC2_AIR, 
  isnull(#OCC2.OCC2_LAW, 0) as OCC2_LAW, 
  isnull(#OCC2.OCC2_BLACK, 0) as OCC2_BLACK, 
  isnull(#OCC2.OCC2_HISPANIC, 0) as OCC2_HISPANIC, 
  isnull(#OCC2.OCC2_OTHER, 0) as OCC2_OTHER, 
  isnull(#OCC2.OCC2_FEMALE, 0) as OCC2_FEMALE, 
  isnull(#OCC2.OCCR2_GROUND, 0) as OCCR2_GROUND, 
  isnull(@OCC_SECOND_CLASS_NUMBER, 0) as OCC_CLASS2, 
   
  CASE WHEN isnull(#OCC2.OCCR2_GROUND, 0) - isnull(#OCC2.OCCR2_GROUND_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC2.OCCR2_GROUND, 0) - isnull(#OCC2.OCCR2_GROUND_CON, 0) END 
   AS OCCR2_GROUND_REM, 
  CASE WHEN isnull(#OCC2.OCC2_GROUND, 0) - isnull(#OCC2.OCC2_GROUND_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC2.OCC2_GROUND, 0) - isnull(#OCC2.OCC2_GROUND_CON, 0) END 
   AS OCC2_GROUND_REM, 
  CASE WHEN isnull(#OCC2.OCC2_NFO, 0) - isnull(#OCC2.OCC2_NFO_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC2.OCC2_NFO, 0) - isnull(#OCC2.OCC2_NFO_CON, 0) END 
   AS OCC2_NFO_REM, 
  CASE WHEN isnull(#OCC2.OCC2_AIR, 0) - isnull(#OCC2.OCC2_AIR_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC2.OCC2_AIR, 0) - isnull(#OCC2.OCC2_AIR_CON, 0) END 
   AS OCC2_AIR_REM, 
  CASE WHEN isnull(#OCC2.OCC2_LAW, 0) - isnull(#OCC2.OCC2_LAW_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC2.OCC2_LAW, 0) - isnull(#OCC2.OCC2_LAW_CON, 0) END 
   AS OCC2_LAW_REM, 
  CASE WHEN isnull(#OCC2.OCC2_BLACK, 0) - isnull(#OCC2.OCC2_BLACK_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC2.OCC2_BLACK, 0) - isnull(#OCC2.OCC2_BLACK_CON, 0) END 
   AS OCC2_BLACK_REM, 
  CASE WHEN isnull(#OCC2.OCC2_HISPANIC, 0) - isnull(#OCC2.OCC2_HISPANIC_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC2.OCC2_HISPANIC, 0) - isnull(#OCC2.OCC2_HISPANIC_CON, 0) END 
   AS OCC2_HISPANIC_REM, 
  CASE WHEN isnull(#OCC2.OCC2_OTHER, 0) - isnull(#OCC2.OCC2_OTHER_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC2.OCC2_OTHER, 0) - isnull(#OCC2.OCC2_OTHER_CON, 0) END 
   AS OCC2_OTHER_REM, 
  CASE WHEN isnull(#OCC2.OCC2_FEMALE, 0) - isnull(#OCC2.OCC2_FEMALE_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC2.OCC2_FEMALE, 0) - isnull(#OCC2.OCC2_FEMALE_CON, 0) END 
   AS OCC2_FEMALE_REM, 
 
  isnull(#OCC3.OCC3_GROUND, 0) as OCC3_GROUND, 
  isnull(#OCC3.OCC3_NFO, 0) as OCC3_NFO, 
  isnull(#OCC3.OCC3_AIR, 0) as OCC3_AIR, 
  isnull(#OCC3.OCC3_LAW, 0) as OCC3_LAW, 
  isnull(#OCC3.OCC3_BLACK, 0) as OCC3_BLACK, 
  isnull(#OCC3.OCC3_HISPANIC, 0) as OCC3_HISPANIC, 
  isnull(#OCC3.OCC3_OTHER, 0) as OCC3_OTHER, 
  isnull(#OCC3.OCC3_FEMALE, 0) as OCC3_FEMALE, 
  isnull(#OCC3.OCCR3_GROUND, 0) as OCCR3_GROUND, 
  isnull(@OCC_THIRD_CLASS_NUMBER, 0) as OCC_CLASS3, 
   
  CASE WHEN isnull(#OCC3.OCCR3_GROUND, 0) - isnull(#OCC3.OCCR3_GROUND_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC3.OCCR3_GROUND, 0) - isnull(#OCC3.OCCR3_GROUND_CON, 0) END 
   AS OCCR3_GROUND_REM, 
  CASE WHEN isnull(#OCC3.OCC3_GROUND, 0) - isnull(#OCC3.OCC3_GROUND_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC3.OCC3_GROUND, 0) - isnull(#OCC3.OCC3_GROUND_CON, 0) END 
   AS OCC3_GROUND_REM, 
  CASE WHEN isnull(#OCC3.OCC3_NFO, 0) - isnull(#OCC3.OCC3_NFO_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC3.OCC3_NFO, 0) - isnull(#OCC3.OCC3_NFO_CON, 0) END 
   AS OCC3_NFO_REM, 
  CASE WHEN isnull(#OCC3.OCC3_AIR, 0) - isnull(#OCC3.OCC3_AIR_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC3.OCC3_AIR, 0) - isnull(#OCC3.OCC3_AIR_CON, 0) END 
   AS OCC3_AIR_REM, 
  CASE WHEN isnull(#OCC3.OCC3_LAW, 0) - isnull(#OCC3.OCC3_LAW_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC3.OCC3_LAW, 0) - isnull(#OCC3.OCC3_LAW_CON, 0) END 
   AS OCC3_LAW_REM, 
  CASE WHEN isnull(#OCC3.OCC3_BLACK, 0) - isnull(#OCC3.OCC3_BLACK_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC3.OCC3_BLACK, 0) - isnull(#OCC3.OCC3_BLACK_CON, 0) END 
   AS OCC3_BLACK_REM, 
  CASE WHEN isnull(#OCC3.OCC3_HISPANIC, 0) - isnull(#OCC3.OCC3_HISPANIC_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC3.OCC3_HISPANIC, 0) - isnull(#OCC3.OCC3_HISPANIC_CON, 0) END 
   AS OCC3_HISPANIC_REM, 
  CASE WHEN isnull(#OCC3.OCC3_OTHER, 0) - isnull(#OCC3.OCC3_OTHER_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC3.OCC3_OTHER, 0) - isnull(#OCC3.OCC3_OTHER_CON, 0) END 
   AS OCC3_OTHER_REM, 
  CASE WHEN isnull(#OCC3.OCC3_FEMALE, 0) - isnull(#OCC3.OCC3_FEMALE_CON, 0) < 0 THEN 0 
   ELSE isnull(#OCC3.OCC3_FEMALE, 0) - isnull(#OCC3.OCC3_FEMALE_CON, 0) END 
   AS OCC3_FEMALE_REM 
from  
#ORGID 
LEFT OUTER JOIN #PLC1 on #ORGID.ORGANIZATION_ID = #PLC1.ORGANIZATION_ID 
LEFT OUTER JOIN #PLC2 on #ORGID.ORGANIZATION_ID = #PLC2.ORGANIZATION_ID 
LEFT OUTER JOIN #PLC3 on #ORGID.ORGANIZATION_ID = #PLC3.ORGANIZATION_ID 
LEFT OUTER JOIN #OCC1 on #ORGID.ORGANIZATION_ID = #OCC1.ORGANIZATION_ID 
LEFT OUTER JOIN #OCC2 on #ORGID.ORGANIZATION_ID = #OCC2.ORGANIZATION_ID 
LEFT OUTER JOIN #OCC3 on #ORGID.ORGANIZATION_ID = #OCC3.ORGANIZATION_ID 
 
drop table #CONTRACTS_MADE 
drop table #ORGID 
drop table #PLC1 
drop table #PLC2 
drop table #PLC3 
drop table #OCC1 
drop table #OCC2 
drop table #OCC3 
drop table #Withdrawals 
 
END]]></body>
<schema>E9C4E37D-78A2-31F9-D580-7C2848ACFCB7</schema>
<database>EA42DEDC-DFC5-B775-3079-AD0E133F5E1D</database>
</StoredProcedureSqlServerv2k5>