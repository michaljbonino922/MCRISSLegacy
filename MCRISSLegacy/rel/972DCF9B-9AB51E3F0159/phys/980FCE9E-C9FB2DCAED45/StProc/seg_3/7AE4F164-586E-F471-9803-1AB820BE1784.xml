<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureSqlServerv2k5 class="oracle.dbtools.crest.model.design.storage.sqlserver.v2k5.StoredProcedureSqlServerv2k5" name="[GetMonthlyAc.vityReportNWARow]" directorySegmentName="seg_3" id="7AE4F164-586E-F471-9803-1AB820BE1784">
<sourceDDLFile>create ODSE script - MCRISS OTA.txt</sourceDDLFile>
<createdBy>MichalBonino</createdBy>
<createdTime>2024-04-29 23:41:48 UTC</createdTime>
<ownerDesignName>MCRISSLegacy</ownerDesignName>
<body><![CDATA[@StartDate date.me, 
 @EndDate date.me, 
 @ORG_ID int, 
 @MISSION_FISCAL_YEAR int 
AS 
BEGIN 
 
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED 
 
Declare @MISSION_FY1_START_DATE date.me 
Declare @MISSION_FY1_END_DATE date.me 
Declare @MISSION_FY2_START_DATE date.me 
Declare @MISSION_FY2_END_DATE date.me 
Declare @MISSION_FY3_START_DATE date.me 
Declare @MISSION_FY3_END_DATE date.me 
Declare @PLC_NFO varchar(2) 
Declare @PLC_GROUND varchar(2) 
Declare @PLC_NA varchar(2) 
Declare @PLC_LAW varchar(2) 
Declare @OCC_NFO varchar(2) 
Declare @OCC_GROUND varchar(2) 
Declare @OCC_NA varchar(2) 
Declare @OCCR_GROUND varchar(2) 
Declare @OCC_LAW varchar(2) 
 
Declare @MISSION_FISCAL_YEAR_PLUS1 int 
Declare @MISSION_FISCAL_YEAR_PLUS2 int 
Declare @MISSION_FISCAL_YEAR_PLUS3 int 
 
Declare @OCC_FIRST_CLASS_NUMBER int 
Declare @OCC_SECOND_CLASS_NUMBER int 
Declare @OCC_THIRD_CLASS_NUMBER int 
 
set @MISSION_FISCAL_YEAR_PLUS1 = @MISSION_FISCAL_YEAR + 1; 
set @MISSION_FISCAL_YEAR_PLUS2 = @MISSION_FISCAL_YEAR + 2; 
set @MISSION_FISCAL_YEAR_PLUS3 = @MISSION_FISCAL_YEAR + 3; 
 
set @PLC_NFO = '0A'; 
set @PLC_GROUND = '0B'; 
set @PLC_NA = '0C'; 
set @PLC_LAW = '0E'; 
set @OCC_LAW = '1A'; 
set @OCC_GROUND = '1B'; 
set @OCC_NA = '1C'; 
set @OCCR_GROUND = '1E'; 
set @OCC_NFO = '1H'; 
 
DECLARE @RACE_CODE char(1) 
 DECLARE @ETHNIC_CODE varchar(2) 
 DECLARE @GENDER_CODE char(1) 
 DECLARE @Count int 
  
 SET @RACE_CODE = 'E' 
 SET @ETHNIC_CODE = 'P' 
 SET @GENDER_CODE = 'M' 
 
CREATE TABLE #RESULTS 
 ( 
    PLC1_NFO_ALL INT default 0, 
       PLC1_NFO_NON_WHITE_MALE INT default 0, 
    PLC1_GROUND_ALL INT default 0, 
       PLC1_GROUND_NON_WHITE_MALE INT default 0, 
    PLC1_AIR_ALL INT default 0, 
       PLC1_AIR_NON_WHITE_MALE INT default 0, 
    PLC1_LAW_ALL INT default 0, 
       PLC1_LAW_NON_WHITE_MALE INT default 0, 
    PLC2_NFO_ALL INT default 0, 
    PLC2_NFO_NON_WHITE_MALE INT default 0, 
    PLC2_GROUND_ALL INT default 0, 
       PLC2_GROUND_NON_WHITE_MALE INT default 0, 
    PLC2_AIR_ALL INT default 0, 
       PLC2_AIR_NON_WHITE_MALE INT default 0, 
    PLC2_LAW_ALL INT default 0, 
       PLC2_LAW_NON_WHITE_MALE INT default 0, 
       PLC3_NFO_ALL INT default 0, 
    PLC3_NFO_NON_WHITE_MALE INT default 0, 
    PLC3_GROUND_ALL INT default 0, 
       PLC3_GROUND_NON_WHITE_MALE INT default 0, 
    PLC3_AIR_ALL INT default 0, 
       PLC3_AIR_NON_WHITE_MALE INT default 0, 
    PLC3_LAW_ALL INT default 0, 
       PLC3_LAW_NON_WHITE_MALE INT default 0, 
    OCC1_NFO_ALL INT default 0, 
    OCC1_NFO_NON_WHITE_MALE INT default 0, 
       OCCR1_GROUND_ALL INT default 0, 
       OCCR1_GROUND_NON_WHITE_MALE INT default 0, 
    OCC1_GROUND_ALL INT default 0, 
       OCC1_GROUND_NON_WHITE_MALE INT default 0, 
    OCC1_AIR_ALL INT default 0, 
       OCC1_AIR_NON_WHITE_MALE INT default 0, 
    OCC1_LAW_ALL INT default 0, 
       OCC1_LAW_NON_WHITE_MALE INT default 0, 
    OCC2_NFO_ALL INT default 0, 
    OCC2_NFO_NON_WHITE_MALE INT default 0, 
       OCCR2_GROUND_ALL INT default 0, 
       OCCR2_GROUND_NON_WHITE_MALE INT default 0, 
    OCC2_GROUND_ALL INT default 0, 
       OCC2_GROUND_NON_WHITE_MALE INT default 0, 
    OCC2_AIR_ALL INT default 0, 
       OCC2_AIR_NON_WHITE_MALE INT default 0, 
    OCC2_LAW_ALL INT default 0, 
       OCC2_LAW_NON_WHITE_MALE INT default 0, 
       OCC3_NFO_ALL INT default 0, 
    OCC3_NFO_NON_WHITE_MALE INT default 0, 
       OCCR3_GROUND_ALL INT default 0, 
       OCCR3_GROUND_NON_WHITE_MALE INT default 0, 
    OCC3_GROUND_ALL INT default 0, 
       OCC3_GROUND_NON_WHITE_MALE INT default 0, 
    OCC3_AIR_ALL INT default 0, 
       OCC3_AIR_NON_WHITE_MALE INT default 0, 
    OCC3_LAW_ALL INT default 0, 
       OCC3_LAW_NON_WHITE_MALE  INT default 0 
 ) 
 
 
select @OCC_FIRST_CLASS_NUMBER = ( 
 select min(CLASS_NUMBER) from MCRISS.dbo.OCS_CLASS  
 where FISCAL_YEAR = @MISSION_FISCAL_YEAR and  
    TRAINING_TYPE_CODE = 'OCC'); 
     
select  @OCC_SECOND_CLASS_NUMBER = @OCC_FIRST_CLASS_NUMBER +1; 
select @OCC_THIRD_CLASS_NUMBER = @OCC_FIRST_CLASS_NUMBER +2; 
 
select * into #Nwa from MCRISS.dbo.NWA NWA where 
ORGANIZATION_OF_RECORD_ID = @ORG_ID and NWA_DATE_STARTED_WORKING between @StartDate and @EndDate 
 
--select oc.* into #OC 
--from MCRISS.dbo.OFFICER_CONTRACT oc 
--inner join #Nwa n on n.NWA_ID = oc.NWA_ID 
--where CONTRACT_BEGIN_DATE between @StartDate and @EndDate 
 
--select SHIP_MISSION,* from #OC oc inner join #Nwa n on n.NWA_ID = oc.NWA_ID 
 
select mc.* into #MC 
from MCRISS.dbo.MARINE_CANDIDATE mc 
inner join #NWA n on n.MARINE_CANDIDATE_ID = mc.MARINE_CANDIDATE_ID 
 
select ocs.* into  #OCS from  
MCRISS.dbo.OCS ocs  inner join #NWA n on n.NWA_ID = ocs.NWA_ID  
 
--select * from #OCS 
 
select dis.nct occ.* into #OCC from  
MCRISS.dbo.OCS_CLASS occ  
inner join #OCS ocs on occ.CLASS_ID = ocs.OCS_CLASS_ID 
 
--select * from #OCC --where TRAINING_TYPE_CODE = '0B' 
 
INSERT INTO #RESULTS 
-- Select PLC 1 
 SELECT  ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE=@PLC_NFO and OCC.TRAINING_TYPE_CODE = 'PLCCOMB' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS1) THEN 1 ELSE 0 END),0) AS PLC1_NFO_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE=@PLC_NFO and OCC.TRAINING_TYPE_CODE = 'PLCCOMB' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS1 and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS PLC1_NFO_NON_WHITE_MALE, 
      ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @PLC_GROUND and OCC.TRAINING_TYPE_CODE = 'PLCCOMB' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS1) THEN 1 ELSE 0 END),0) AS PLC1_GROUND_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @PLC_GROUND and OCC.TRAINING_TYPE_CODE = 'PLCCOMB' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS1 and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS  PLC1_GROUND_NON_WHITE_MALE, 
   ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @PLC_NA and OCC.TRAINING_TYPE_CODE = 'PLCCOMB' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS1) THEN 1 ELSE 0 END),0) AS PLC1_AIR_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @PLC_NA and OCC.TRAINING_TYPE_CODE = 'PLCCOMB' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS1 and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS PLC1_AIR_NON_WHITE_MALE, 
 ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @PLC_LAW and OCC.TRAINING_TYPE_CODE = 'PLCCOMB' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS1) THEN 1 ELSE 0 END),0) AS PLC1_LAW_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @PLC_LAW and OCC.TRAINING_TYPE_CODE = 'PLCCOMB' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS1 and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS PLC1_LAW_NON_WHITE_MALE, 
--SELECT  PLC 2 
ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE=@PLC_NFO and OCC.TRAINING_TYPE_CODE = 'PLCJR' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS2) THEN 1 ELSE 0 END),0) AS PLC2_NFO_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE=@PLC_NFO and OCC.TRAINING_TYPE_CODE = 'PLCJR' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS2 and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS PLC2_NFO_NON_WHITE_MALE, 
      ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @PLC_GROUND and OCC.TRAINING_TYPE_CODE = 'PLCJR' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS2) THEN 1 ELSE 0 END),0) AS PLC2_GROUND_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @PLC_GROUND and OCC.TRAINING_TYPE_CODE = 'PLCJR' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS2 and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS  PLC2_GROUND_NON_WHITE_MALE, 
   ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @PLC_NA and OCC.TRAINING_TYPE_CODE = 'PLCJR' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS2) THEN 1 ELSE 0 END),0) AS PLC2_AIR_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @PLC_NA and OCC.TRAINING_TYPE_CODE = 'PLCJR' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS2 and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS PLC2_AIR_NON_WHITE_MALE, 
 ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @PLC_LAW and OCC.TRAINING_TYPE_CODE = 'PLCJR' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS2) THEN 1 ELSE 0 END),0) AS PLC2_LAW_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @PLC_LAW and OCC.TRAINING_TYPE_CODE = 'PLCJR' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS2 and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS PLC2_LAW_NON_WHITE_MALE, 
--SELECT PLC 3 
ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE=@PLC_NFO and OCC.TRAINING_TYPE_CODE = 'PLCJR' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS3) THEN 1 ELSE 0 END),0) AS PLC3_NFO_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE=@PLC_NFO and OCC.TRAINING_TYPE_CODE = 'PLCJR' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS3 and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS PLC3_NFO_NON_WHITE_MALE, 
      ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @PLC_GROUND and OCC.TRAINING_TYPE_CODE = 'PLCJR' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS3) THEN 1 ELSE 0 END),0) AS PLC3_GROUND_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @PLC_GROUND and OCC.TRAINING_TYPE_CODE = 'PLCJR' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS3 and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS  PLC3_GROUND_NON_WHITE_MALE, 
   ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @PLC_NA and OCC.TRAINING_TYPE_CODE = 'PLCJR' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS3) THEN 1 ELSE 0 END),0) AS PLC3_AIR_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @PLC_NA and OCC.TRAINING_TYPE_CODE = 'PLCJR' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS3 and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS PLC3_AIR_NON_WHITE_MALE, 
 ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @PLC_LAW and OCC.TRAINING_TYPE_CODE = 'PLCJR' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS3) THEN 1 ELSE 0 END),0) AS PLC3_LAW_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @PLC_LAW and OCC.TRAINING_TYPE_CODE = 'PLCJR' 
    and n.SHIP_MISSION = @MISSION_FISCAL_YEAR_PLUS3 and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS PLC3_LAW_NON_WHITE_MALE, 
--Select OCC year 1 
 ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE=@OCC_NFO and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_FIRST_CLASS_NUMBER ) THEN 1 ELSE 0 END),0) AS OCC1_NFO_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE=@OCC_NFO and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_FIRST_CLASS_NUMBER  and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS OCC1_NFO_NON_WHITE_MALE, 
   ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCCR_GROUND and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_FIRST_CLASS_NUMBER) THEN 1 ELSE 0 END),0) AS OCCR1_GROUND_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCCR_GROUND and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_FIRST_CLASS_NUMBER and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS  OCCR1_GROUND_NON_WHITE_MALE,     
  ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCC_GROUND and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_FIRST_CLASS_NUMBER) THEN 1 ELSE 0 END),0) AS OCC1_GROUND_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCC_GROUND and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_FIRST_CLASS_NUMBER and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS  OCC1_GROUND_NON_WHITE_MALE, 
   ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCC_NA and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_FIRST_CLASS_NUMBER) THEN 1 ELSE 0 END),0) AS OCC1_AIR_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCC_NA and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_FIRST_CLASS_NUMBER and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS OCC1_AIR_NON_WHITE_MALE, 
 ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCC_LAW and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_FIRST_CLASS_NUMBER) THEN 1 ELSE 0 END),0) AS OCC1_LAW_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCC_LAW and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_FIRST_CLASS_NUMBER and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS OCC1_LAW_NON_WHITE_MALE, 
--SELECT OCC year 2  
 ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE=@OCC_NFO and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_SECOND_CLASS_NUMBER ) THEN 1 ELSE 0 END),0) AS OCC2_NFO_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE=@OCC_NFO and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_SECOND_CLASS_NUMBER  and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS OCC2_NFO_NON_WHITE_MALE, 
   ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCCR_GROUND and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_SECOND_CLASS_NUMBER) THEN 1 ELSE 0 END),0) AS OCCR1_GROUND_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCCR_GROUND and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_SECOND_CLASS_NUMBER and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS  OCCR1_GROUND_NON_WHITE_MALE,     
  ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCC_GROUND and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_SECOND_CLASS_NUMBER) THEN 1 ELSE 0 END),0) AS OCC2_GROUND_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCC_GROUND and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_SECOND_CLASS_NUMBER and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS  OCC2_GROUND_NON_WHITE_MALE, 
   ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCC_NA and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_SECOND_CLASS_NUMBER) THEN 1 ELSE 0 END),0) AS OCC2_AIR_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCC_NA and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_SECOND_CLASS_NUMBER and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS OCC2_AIR_NON_WHITE_MALE, 
 ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCC_LAW and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_SECOND_CLASS_NUMBER) THEN 1 ELSE 0 END),0) AS OCC2_LAW_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCC_LAW and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_SECOND_CLASS_NUMBER and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS OCC2_LAW_NON_WHITE_MALE, 
--SELECT OCC year 3 
 
 ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE=@OCC_NFO and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_THIRD_CLASS_NUMBER ) THEN 1 ELSE 0 END),0) AS OCC3_NFO_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE=@OCC_NFO and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_THIRD_CLASS_NUMBER  and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS OCC3_NFO_NON_WHITE_MALE, 
   ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCCR_GROUND and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_SECOND_CLASS_NUMBER) THEN 1 ELSE 0 END),0) AS OCCR1_GROUND_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCCR_GROUND and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_THIRD_CLASS_NUMBER and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS  OCCR1_GROUND_NON_WHITE_MALE,     
  ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCC_GROUND and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_SECOND_CLASS_NUMBER) THEN 1 ELSE 0 END),0) AS OCC3_GROUND_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCC_GROUND and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_THIRD_CLASS_NUMBER and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS  OCC3_GROUND_NON_WHITE_MALE, 
   ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCC_NA and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_THIRD_CLASS_NUMBER) THEN 1 ELSE 0 END),0) AS OCC3_AIR_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCC_NA and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_THIRD_CLASS_NUMBER and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS OCC3_AIR_NON_WHITE_MALE, 
 ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCC_LAW and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_SECOND_CLASS_NUMBER) THEN 1 ELSE 0 END),0) AS OCC3_LAW_ALL, 
     ISNULL(SUM(CASE WHEN (n.OFFICER_COMPONENT_CODE= @OCC_LAW and OCC.TRAINING_TYPE_CODE = 'OCC' 
    and OCC.CLASS_NUMBER = @OCC_THIRD_CLASS_NUMBER and  not 
 (MC.RACE_CODE = @RACE_CODE and MC.ETHNIC_CODE = @ETHNIC_CODE and MC.GENDER_CODE = @GENDER_CODE)) THEN 1 ELSE 0 END),0) AS OCC3_LAW_NON_WHITE_MALE 
 
 
      from #NWA  n 
    join MCRISS.dbo.MARINE_CANDIDATE MC on n.MARINE_CANDIDATE_ID = MC.MARINE_CANDIDATE_ID 
    join MCRISS.dbo.OCS OCS on n.NWA_ID = OCS.NWA_ID  
    --join #OC OC on n.NWA_ID = OC.NWA_ID --and OFFICER_COMPONENT_CODE  = '0B' 
    join MCRISS.dbo.OCS_CLASS OCC on OCC.CLASS_ID = OCS.OCS_CLASS_ID --and OCC.TRAINING_TYPE_CODE = 'PLCCOMB' 
 
SELECT * FROM #RESULTS  
drop table #RESULTS 
END]]></body>
<schema>A5B5C85F-7BA3-158E-D5A2-943767AC9AE2</schema>
<database>7220F1F8-DA6B-58D6-61AE-B77688E1C655</database>
</StoredProcedureSqlServerv2k5>