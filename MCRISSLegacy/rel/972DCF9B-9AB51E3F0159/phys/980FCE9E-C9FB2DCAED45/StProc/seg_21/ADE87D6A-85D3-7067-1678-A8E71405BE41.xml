<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureSqlServerv2k5 class="oracle.dbtools.crest.model.design.storage.sqlserver.v2k5.StoredProcedureSqlServerv2k5" name="[sp_GetShellInforma.on]" directorySegmentName="seg_21" id="ADE87D6A-85D3-7067-1678-A8E71405BE41">
<sourceDDLFile>Appian.sql</sourceDDLFile>
<createdBy>MichalBonino</createdBy>
<createdTime>2024-04-29 23:57:48 UTC</createdTime>
<ownerDesignName>MCRISSLegacy</ownerDesignName>
<body><![CDATA[@NWAID int 
AS 
 
DECLARE @CandidateStatusId  int 
DECLARE @MEPSScheduleId  int 
DECLARE @PendingWaivers  int 
DECLARE @MaxPFTID   int 
 
--- GET THE MAX CANDIDATE STATUS ID,  
--- THE MAX MEPS SCHEDULE ID AND 
--- THE # OF PENDING WAIVERS 
SELECT  
 @CandidateStatusId  = dbo.GetMaxStatusID(@NWAID), 
 @MEPSScheduleId  = dbo.GetMaxScheduleID(@NWAID), 
 @PendingWaivers  = dbo.GetPendingWaiversCount(@NWAID), 
 @MaxPFTID  = dbo.GetMaxPFTID(@NWAID) 
 
SELECT  
 P.LAST_NAME, P.FIRST_NAME, P.LEGAL_MIDDLE_NAME, UPPER(COALESCE(P.SUFFIX_CD, SPACE(0))) AS SUFFIX_CD, 
 P.SOCIAL_SECURITY_NUMBER, CONVERT(VARCHAR(11), MC.DATE_OF_BIRTH, 106) AS DATE_OF_BIRTH, 
 MC.GENDER_CODE,  
 RS.ORGANIZATION_ID AS RS_ORG_ID,  
 CASE CS.STATUS_TYPE 
  WHEN 'E' THEN RS.NAME  
  WHEN 'O' THEN RS.SHORT_NAME 
  ELSE RS.NAME 
 END AS RS_NAME,  
 NWA.ORGANIZATION_OF_RECORD_ID AS RSS_OSS_ORG_ID, RSS_OSS.NAME AS RSS_OSS_NAME, 
 RSS_OSS.ORGANIZATION_TYPE AS RSS_OSS_ORG_TYPE,  
 NWA.RECRUITER_OF_RECORD_ID,  
 COALESCE(RTRIM(RP.RANK_CODE), SPACE(0)) + SPACE(1)  +  
  COALESCE(RTRIM(RCRTR.LAST_NAME), SPACE(0))  + SPACE(1) +  
  COALESCE(RTRIM(RCRTR.FIRST_NAME), SPACE(0)) + SPACE(1) +  
  COALESCE(RTRIM(RCRTR.LEGAL_MIDDLE_NAME), SPACE(0)) AS RECRUITER_OF_RECORD_NAME, 
 CS.STATUS_CODE, CS.DISPOSITION_CODE,  SD.STATUS_DESCRIPTION,  SD.DISPOSITION_DESCRIPTION,  
 COALESCE(MS.MEPS_ORGANIZATION_ID, 0) AS MEPS_ORGANIZATION_ID, 
 CONVERT(VARCHAR(11), MS.PROCESSING_DATE, 106) AS PROCESSING_DATE,  
 CASE  
  WHEN (CS.STATUS_CODE = 'A' AND NWA.CATEGORY_CODE IN ('G', 'A')) OR 
   (CS.STATUS_CODE != 'A' AND C.COMPONENT_CODE IN ('K4', 'K8', 'K9', 'B5')) THEN 'RESERVE' 
  ELSE 'REGULAR' 
 END AS ENLISTMENT_CATEGORY, 
 @PendingWaivers AS PENDING_WAIVERS, 
 --- NEW COLUMNS 
 NWA.CATEGORY_CODE, 
 --- ADDITIONAL MARINE CANDIDATE DATA 
 COALESCE(MC.BIRTH_CITY, SPACE(0)) AS BIRTH_CITY, COALESCE(MC.BIRTH_COUNTY, SPACE(0)) AS BIRTH_COUNTY,  
 COALESCE(MC.BIRTH_STATE, SPACE(0)) AS BIRTH_STATE, COALESCE(MC.CITIZENSHIP, SPACE(0)) AS CITIZENSHIP,  
 COALESCE(MC.COUNTRY_OF_ORIGIN, SPACE(0)) AS COUNTRY_OF_ORIGIN,  
 COALESCE(CONVERT(VARCHAR(11), MC.DRIVER_LICENSE_EXP, 106), SPACE(0)) AS DRIVER_LICENSE_EXP, 
 COALESCE(MC.DRIVER_LICENSE_NUM, SPACE(0)) AS DRIVER_LICENSE_NUM,  
 COALESCE(MC.DRIVER_LICENSE_STATE, SPACE(0)) AS DRIVER_LICENSE_STATE,  
 COALESCE(MC.ETHNIC_CODE, SPACE(0)) AS ETHNIC_CODE,  
 COALESCE(MC.MARITAL_STATUS_CODE, SPACE(0)) AS MARITAL_STATUS_CODE, 
 COALESCE(MC.RELIGION_CODE, SPACE(0)) AS RELIGION_CODE,  
 COALESCE(MC.RACE_CODE, SPACE(0)) AS RACE_CODE,  
 --- MEPS SCHEDULE DATA 
 COALESCE(MS.SCHEDULE_ID, 0) AS SCHEDULE_ID, 
 COALESCE(MS.LODGING_REQUIRED, SPACE(0)) AS LODGING_REQUIRED, 
 COALESCE(MS.COMPLETE_PHYSICAL, SPACE(0)) AS COMPLETE_PHYSICAL, 
 COALESCE(MS.INSPECTION_PHYSICAL, SPACE(0)) AS INSPECTION_PHYSICAL, 
 COALESCE(MS.CONSULTATION_PHYSICAL, SPACE(0)) AS CONSULTATION_PHYSICAL, 
 COALESCE(MS.CONSULTATION_TYPE, SPACE(0)) AS CONSULTATION_TYPE, 
 COALESCE(MS.CONTRACT, SPACE(0)) AS CONTRACT, 
 COALESCE(MS.SHIP, SPACE(0)) AS SHIP,  
 COALESCE(MS.OTHER_PROCESSING, SPACE(0)) AS OTHER_PROCESSING, 
 COALESCE(MS.PROCESSING_NOTES, SPACE(0)) AS PROCESSING_NOTES, 
 COALESCE(MS.LAST_PROCESSED_FOR, SPACE(0)) AS LAST_PROCESSED_FOR, 
 COALESCE(CONVERT(CHAR(11), MS.ARRIVAL_DATE, 106), SPACE(0)) AS ARRIVAL_DATE,  
 COALESCE(MS.ASVAB, SPACE(0)) AS ASVAB_REQUIRED, 
 COALESCE(MS.SPECIAL_EXAM, SPACE(0)) AS SPECIAL_EXAM_REQUIRED, 
 COALESCE(MS.SPECIAL_EXAM_TYPE, SPACE(0)) AS SPECIAL_EXAM_TYPE, 
 COALESCE(MS.TRANSPORTATION_REQUIRED, SPACE(0)) AS TRANSPORTATION_REQUIRED, 
 COALESCE(MS.PROCESSING_STATUS, SPACE(0)) AS PROCESSING_STATUS, 
 --- LOOKUP DATA 
 COALESCE(CY.COUNTRY_DESCRITION, SPACE(0)) AS COUNTRY, 
 COALESCE(E.ETHNIC_ABBREVEATION, SPACE(0)) AS ETHNIC, 
 COALESCE(R.RACE_DESC, SPACE(0)) AS RACE,  
 COALESCE(REL.RELIGION_CODE_DESC, SPACE(0)) AS RELIGION, 
 --- RECRUITER SSN  
 RCRTR.SOCIAL_SECURITY_NUMBER AS RECRUITER_SSN, 
 --- RSS MCC CODE 
 RSS_OSS.MCC_CODE, 
 --- MEPCOM RACE AND ETHNIC CODES 
 COALESCE(MC.MEPCOM_RACE_CODE, SPACE(0)) AS MEPCOM_RACE_CATEGORY_CODE, 
 COALESCE(MRC.RACE_CATEGORY_DESC, SPACE(0)) AS MEPCOM_RACE_CATEGORY_DESC, 
 COALESCE(MC.MEPCOM_ETHNIC_CODE, SPACE(0)) AS MEPCOM_ETHNIC_CATEGORY_CODE, 
 COALESCE(MEC.ETHNIC_CATEGORY_DESC, SPACE(0)) AS MEPCOM_ETHNIC_CATEGORY_DESC, 
 --- PFT DATA 
 COALESCE(PFT.PFT_ID, 0) AS PFT_ID, 
 COALESCE(CONVERT(CHAR(11), PFT.PFT_DATE, 106), SPACE(0)) AS PFT_DATE, 
 COALESCE(PFT.PFT_HEIGHT, 0) AS PFT_HEIGHT, 
 COALESCE(PFT.PFT_WEIGHT, 0) AS PFT_WEIGHT, 
 COALESCE(PFT.PFT_BODY_FAT_PCT, 0) AS PFT_BODY_FAT_PCT, 
 COALESCE(PFT.PFT_CRUNCHES, 0) AS PFT_CRUNCHES, 
 COALESCE(PFT.PFT_RUN_MINUTES, 0) AS PFT_RUN_MINUTES, 
 COALESCE(PFT.PFT_RUN_SECONDS, 0) AS PFT_RUN_SECONDS, 
 COALESCE(PFT.PFT_PULLUPS, 0) AS PFT_PULLUPS, 
 COALESCE(PFT.PFT_HANG, 0) AS PFT_HANG, 
 COALESCE(PFT.PFT_SCORE, SPACE(0)) AS PFT_SCORE, 
 CASE CS.STATUS_TYPE 
  WHEN 'O' THEN COALESCE(NWA.OFFICER_COMPONENT_CODE, SPACE(0)) 
  ELSE SPACE(0) 
 END AS OFFICER_PROGRAM_CODE, 
 CASE CS.STATUS_TYPE 
  WHEN 'O' THEN COALESCE((SELECT CC.COMPONENT_DESCRIPTION FROM COMPONENT_CODE CC WHERE CC.COMPONENT_CODE = NWA.OFFICER_COMPONENT_CODE AND CC.TYPE = CS.STATUS_TYPE), SPACE(0)) 
  ELSE SPACE(0) 
 END AS OFFICER_PROGRAM, 
 COALESCE(NWA.NATIONAL_CALL_TO_SERVICE, SPACE(0)) AS NATIONAL_CALL_TO_SERVICE, 
 --- COALESCE(NWA.OCCR, SPACE(0)) AS OCCR, 
 COALESCE(CONVERT(VARCHAR(11), CS.STATUS_EFFECTIVE_DATE, 106), SPACE(0)) AS STATUS_EFFECTIVE_DATE 
FROM   
 NWA INNER JOIN PERSON P ON  
  (NWA.NWA_ID = @NWAID AND 
  NWA.MARINE_CANDIDATE_ID = P.PERSON_ID) 
 INNER JOIN MARINE_CANDIDATE MC ON P.PERSON_ID = MC.MARINE_CANDIDATE_ID  
 INNER JOIN ORGANIZATION_MAP OM ON NWA.ORGANIZATION_OF_RECORD_ID = OM.CHILD_ORGANIZATION_ID  
 INNER JOIN RECRUITING_ORGANIZATION RS ON OM.PARENT_ORGANIZATION_ID = RS.ORGANIZATION_ID 
 INNER JOIN RECRUITING_ORGANIZATION RSS_OSS ON NWA.ORGANIZATION_OF_RECORD_ID = RSS_OSS.ORGANIZATION_ID 
 INNER JOIN RECRUITING_PERSON RP ON RP.RECRUITING_PERSON_ID = NWA.RECRUITER_OF_RECORD_ID 
 INNER JOIN PERSON RCRTR ON RP.RECRUITING_PERSON_ID = RCRTR.PERSON_ID  
 INNER JOIN CANDIDATE_STATUS CS ON  
  (CS.CANDIDATE_STATUS_ID = @CandidateStatusId AND 
  NWA.NWA_ID = CS.NWA_ID) 
 INNER JOIN STATUS_DISPOSITION SD ON  
  (CS.STATUS_TYPE = SD.STATUS_TYPE AND  
  CS.STATUS_CODE = SD.STATUS_CODE AND  
  CS.DISPOSITION_CODE = SD.DISPOSITION_CODE) 
 LEFT OUTER JOIN COUNTRY CY ON MC.COUNTRY_OF_ORIGIN = CY.COUNTRY_CODE 
 LEFT OUTER JOIN ETHNIC E ON MC.ETHNIC_CODE = E.ETHNIC_CODE 
 LEFT OUTER JOIN RACE R ON MC.RACE_CODE = R.RACE_CODE 
 LEFT OUTER JOIN RELIGION REL ON MC.RELIGION_CODE = REL.RELIGION_CODE 
 LEFT OUTER JOIN MEPCOM_RACE_CATEGORY MRC ON MC.MEPCOM_RACE_CODE = MRC.RACE_CATEGORY_CODE 
 LEFT OUTER JOIN MEPCOM_ETHNIC_CATEGORY MEC ON MC.MEPCOM_ETHNIC_CODE = MEC.ETHNIC_CATEGORY_CODE 
 LEFT OUTER JOIN CONTRACT C ON C.NWA_ID = @NWAID 
 LEFT OUTER JOIN MEPS_SCHEDULE MS ON  
  (MS.SCHEDULE_ID = @MEPSScheduleId AND 
  NWA.NWA_ID = MS.NWA_ID) 
 LEFT OUTER JOIN PFT ON  
  (NWA.NWA_ID = PFT.NWA_ID AND 
  PFT.PFT_ID = @MaxPFTID)]]></body>
<schema>DD6CF638-A2EB-2E1B-FF13-422CA718DE2D</schema>
<database>EA42DEDC-DFC5-B775-3079-AD0E133F5E1D</database>
</StoredProcedureSqlServerv2k5>