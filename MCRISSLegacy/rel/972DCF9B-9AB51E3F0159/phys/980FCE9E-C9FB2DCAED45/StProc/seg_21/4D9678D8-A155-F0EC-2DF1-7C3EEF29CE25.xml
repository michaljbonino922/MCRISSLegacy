<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureSqlServerv2k5 class="oracle.dbtools.crest.model.design.storage.sqlserver.v2k5.StoredProcedureSqlServerv2k5" name="[sp_GetStandardofE.ectRSS]" directorySegmentName="seg_21" id="4D9678D8-A155-F0EC-2DF1-7C3EEF29CE25">
<sourceDDLFile>Appian.sql</sourceDDLFile>
<createdBy>MichalBonino</createdBy>
<createdTime>2024-04-29 23:57:48 UTC</createdTime>
<ownerDesignName>MCRISSLegacy</ownerDesignName>
<body><![CDATA[@Organiza.onID integer,  
 @MonthBeginDate date.me, 
 @NewRSS  bit 
AS 
 
--- use decimals for # interviews rather than integers 
DECLARE @TC_INTERVIEWS AS DECIMAL(10, 2) 
DECLARE @AC_INTERVIEWS AS DECIMAL(10, 2) 
DECLARE @OT_INTERVIEWS AS DECIMAL(10, 2) 
DECLARE @HV_INTERVIEWS AS DECIMAL(10, 2) 
 
--- if the RSS has been open at least 3 months (@NewRSS = 0) then get its business percentage data 
IF @NewRSS = 0 
 BEGIN 
 
 SET @TC_INTERVIEWS = (SELECT SUM(TC_INTERVIEWS) FROM RSS_ACTIVITY RA 
    WHERE RA.ORGANIZATION_ID = @Organiza.onID AND 
    RA.ACTIVITY_DATE BETWEEN DATEADD(m, -3, @MonthBeginDate) AND DATEADD(d, -1, @MonthBeginDate)) 
 
 SET @AC_INTERVIEWS = (SELECT SUM(AC_INTERVIEWS) FROM RSS_ACTIVITY RA 
    WHERE RA.ORGANIZATION_ID = @Organiza.onID AND 
    RA.ACTIVITY_DATE BETWEEN DATEADD(m, -3, @MonthBeginDate) AND DATEADD(d, -1, @MonthBeginDate)) 
 
 SET @OT_INTERVIEWS = (SELECT SUM(OT_INTERVIEWS) FROM RSS_ACTIVITY RA 
    WHERE RA.ORGANIZATION_ID = @Organiza.onID AND 
    RA.ACTIVITY_DATE BETWEEN DATEADD(m, -3, @MonthBeginDate) AND DATEADD(d, -1, @MonthBeginDate)) 
 
 SET @HV_INTERVIEWS = (SELECT SUM(HV_INTERVIEWS) FROM RSS_ACTIVITY RA 
    WHERE RA.ORGANIZATION_ID = @Organiza.onID AND 
    RA.ACTIVITY_DATE BETWEEN DATEADD(m, -3, @MonthBeginDate) AND DATEADD(d, -1, @MonthBeginDate)) 
 
 SELECT  
  SOE_TC =  CASE  
     WHEN @TC_INTERVIEWS > 0 THEN CEILING(CONVERT(DECIMAL, SUM(RA.TCS))/@TC_INTERVIEWS) 
     ELSE 0 
    END, 
  SOE_OT =  CASE 
     WHEN @OT_INTERVIEWS > 0 THEN CEILING(CONVERT(DECIMAL, SUM(RA.OTS))/@OT_INTERVIEWS)  
     ELSE 0 
    END, 
  SOE_AC =  CASE 
     WHEN @AC_INTERVIEWS > 0 THEN CEILING(CONVERT(DECIMAL, SUM(RA.ACS))/@AC_INTERVIEWS)  
     ELSE 0 
    END, 
  SOE_HV =  CASE 
     WHEN @HV_INTERVIEWS > 0 THEN CEILING(CONVERT(DECIMAL, SUM(RA.HVS))/ @HV_INTERVIEWS)  
     ELSE 0 
    END 
 FROM  
  RSS_ACTIVITY RA 
 WHERE  
  RA.ORGANIZATION_ID = @Organiza.onID AND 
  RA.ACTIVITY_DATE BETWEEN DATEADD(m, -3, @MonthBeginDate) AND DATEADD(d, -1, @MonthBeginDate) 
 
 END 
ELSE 
 /* 
 if the RSS has been open less than 3 months (@NewRSS = 1) then get the average standard of e.ect data 
 for all the RSSs under the RS 
 */ 
 BEGIN 
 
 SET @TC_INTERVIEWS = (SELECT SUM(RA.TC_INTERVIEWS) FROM RSS_ACTIVITY RA INNER JOIN ORGANIZATION_MAP OM  
    ON RA.ORGANIZATION_ID = OM.CHILD_ORGANIZATION_ID 
    WHERE OM.PARENT_ORGANIZATION_ID = (SELECT OM2.PARENT_ORGANIZATION_ID FROM ORGANIZATION_MAP OM2  
      WHERE OM2.CHILD_ORGANIZATION_ID = @Organiza.onID) AND 
    RA.ACTIVITY_DATE BETWEEN DATEADD(m, -3, @MonthBeginDate) AND DATEADD(d, -1, @MonthBeginDate)) 
 
 SET @AC_INTERVIEWS = (SELECT SUM(AC_INTERVIEWS) FROM RSS_ACTIVITY RA INNER JOIN ORGANIZATION_MAP OM  
    ON RA.ORGANIZATION_ID = OM.CHILD_ORGANIZATION_ID 
    WHERE OM.PARENT_ORGANIZATION_ID = (SELECT OM2.PARENT_ORGANIZATION_ID FROM ORGANIZATION_MAP OM2  
      WHERE OM2.CHILD_ORGANIZATION_ID = @Organiza.onID) AND 
    RA.ACTIVITY_DATE BETWEEN DATEADD(m, -3, @MonthBeginDate) AND DATEADD(d, -1, @MonthBeginDate)) 
 
 SET @OT_INTERVIEWS = (SELECT SUM(OT_INTERVIEWS) FROM RSS_ACTIVITY RA INNER JOIN ORGANIZATION_MAP OM  
    ON RA.ORGANIZATION_ID = OM.CHILD_ORGANIZATION_ID 
    WHERE OM.PARENT_ORGANIZATION_ID = (SELECT OM2.PARENT_ORGANIZATION_ID FROM ORGANIZATION_MAP OM2  
      WHERE OM2.CHILD_ORGANIZATION_ID = @Organiza.onID) AND 
    RA.ACTIVITY_DATE BETWEEN DATEADD(m, -3, @MonthBeginDate) AND DATEADD(d, -1, @MonthBeginDate)) 
 
 SET @HV_INTERVIEWS = (SELECT SUM(HV_INTERVIEWS) FROM RSS_ACTIVITY RA INNER JOIN ORGANIZATION_MAP OM  
    ON RA.ORGANIZATION_ID = OM.CHILD_ORGANIZATION_ID 
    WHERE OM.PARENT_ORGANIZATION_ID = (SELECT OM2.PARENT_ORGANIZATION_ID FROM ORGANIZATION_MAP OM2  
      WHERE OM2.CHILD_ORGANIZATION_ID = @Organiza.onID) AND 
    RA.ACTIVITY_DATE BETWEEN DATEADD(m, -3, @MonthBeginDate) AND DATEADD(d, -1, @MonthBeginDate)) 
 
 
 SELECT  
  SOE_TC =  CASE  
     WHEN @TC_INTERVIEWS > 0 THEN CEILING(CONVERT(DECIMAL, SUM(RA.TCS))/ @TC_INTERVIEWS) 
     ELSE 0 
    END, 
  SOE_OT =  CASE 
     WHEN @OT_INTERVIEWS > 0 THEN CEILING(CONVERT(DECIMAL, SUM(RA.OTS))/@OT_INTERVIEWS)  
     ELSE 0 
    END, 
  SOE_AC =  CASE 
     WHEN @AC_INTERVIEWS > 0 THEN CEILING(CONVERT(DECIMAL, SUM(RA.ACS))/@AC_INTERVIEWS)  
     ELSE 0 
    END, 
  SOE_HV =  CASE 
     WHEN @HV_INTERVIEWS > 0 THEN CEILING(CONVERT(DECIMAL, SUM(RA.HVS))/ @HV_INTERVIEWS)  
     ELSE 0 
    END 
 FROM  
  RSS_ACTIVITY RA INNER JOIN ORGANIZATION_MAP OM ON RA.ORGANIZATION_ID = OM.CHILD_ORGANIZATION_ID 
 
 WHERE  
  OM.PARENT_ORGANIZATION_ID = (SELECT OM2.PARENT_ORGANIZATION_ID FROM ORGANIZATION_MAP OM2  
      WHERE OM2.CHILD_ORGANIZATION_ID = @Organiza.onID) AND 
  RA.ACTIVITY_DATE BETWEEN DATEADD(m, -3, @MonthBeginDate) AND DATEADD(d, -1, @MonthBeginDate) 
 END 
 
 
/* OLD WAY 
 
ALTER PROCEDURE sp_GetStandardofE.ectRSS 
 @Organiza.onID integer,  
 @MonthBeginDate date.me 
AS 
 
--- use decimals for # interviews rather than integers 
DECLARE @TC_INTERVIEWS AS DECIMAL(10, 2) 
DECLARE @AC_INTERVIEWS AS DECIMAL(10, 2) 
DECLARE @OT_INTERVIEWS AS DECIMAL(10, 2) 
DECLARE @HV_INTERVIEWS AS DECIMAL(10, 2) 
 
SET @TC_INTERVIEWS = (SELECT SUM(TC_INTERVIEWS) FROM RSS_ACTIVITY 
   WHERE RSS_ACTIVITY.ORGANIZATION_ID = @Organiza.onID AND 
   RSS_ACTIVITY.ACTIVITY_DATE BETWEEN DATEADD(m, -3, @MonthBeginDate) AND DATEADD(d, -1, @MonthBeginDate)) 
 
SET @AC_INTERVIEWS = (SELECT SUM(AC_INTERVIEWS) FROM RSS_ACTIVITY 
   WHERE RSS_ACTIVITY.ORGANIZATION_ID = @Organiza.onID AND 
   RSS_ACTIVITY.ACTIVITY_DATE BETWEEN DATEADD(m, -3, @MonthBeginDate) AND DATEADD(d, -1, @MonthBeginDate)) 
 
SET @OT_INTERVIEWS = (SELECT SUM(OT_INTERVIEWS) FROM RSS_ACTIVITY 
   WHERE RSS_ACTIVITY.ORGANIZATION_ID = @Organiza.onID AND 
   RSS_ACTIVITY.ACTIVITY_DATE BETWEEN DATEADD(m, -3, @MonthBeginDate) AND DATEADD(d, -1, @MonthBeginDate)) 
 
SET @HV_INTERVIEWS = (SELECT SUM(HV_INTERVIEWS) FROM RSS_ACTIVITY 
   WHERE RSS_ACTIVITY.ORGANIZATION_ID = @Organiza.onID AND 
   RSS_ACTIVITY.ACTIVITY_DATE BETWEEN DATEADD(m, -3, @MonthBeginDate) AND DATEADD(d, -1, @MonthBeginDate)) 
 
SELECT  
 SOE_TC =  CASE  
    WHEN @TC_INTERVIEWS > 0 THEN CEILING(SUM(TCS)/ @TC_INTERVIEWS) 
    ELSE 0 
   END, 
 SOE_OT =  CASE 
    WHEN @OT_INTERVIEWS > 0 THEN CEILING((SUM(OTS) / @OT_INTERVIEWS))  
    ELSE 0 
   END, 
 SOE_AC =  CASE 
    WHEN @AC_INTERVIEWS > 0 THEN CEILING((SUM(ACS) / @AC_INTERVIEWS))  
    ELSE 0 
   END, 
 SOE_HV =  CASE 
    WHEN @HV_INTERVIEWS > 0 THEN CEILING((SUM(HVS) / @HV_INTERVIEWS))  
    ELSE 0 
   END 
FROM  
 RSS_ACTIVITY 
WHERE  
 RSS_ACTIVITY.ORGANIZATION_ID = @Organiza.onID AND 
 RSS_ACTIVITY.ACTIVITY_DATE BETWEEN DATEADD(m, -3, @MonthBeginDate) AND DATEADD(d, -1, @MonthBeginDate) 
*/]]></body>
<schema>DD6CF638-A2EB-2E1B-FF13-422CA718DE2D</schema>
<database>EA42DEDC-DFC5-B775-3079-AD0E133F5E1D</database>
</StoredProcedureSqlServerv2k5>