<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureSqlServerv2k5 class="oracle.dbtools.crest.model.design.storage.sqlserver.v2k5.StoredProcedureSqlServerv2k5" name="[GetO.cerNwaView]" directorySegmentName="seg_7" id="8C95C5AE-2C87-6314-88B3-6FAB0931BB89">
<sourceDDLFile>Appian.sql</sourceDDLFile>
<createdBy>MichalBonino</createdBy>
<createdTime>2024-04-29 23:57:48 UTC</createdTime>
<ownerDesignName>MCRISSLegacy</ownerDesignName>
<body><![CDATA[( 
 @Star.ngRow int, 
 @PageSize int, 
 @FromDate date.me, 
 @ToDate date.me, 
 @OrgID int, 
 @SortBy int, 
 @FinalAc.on varchar(40) 
)   
AS 
 
SET ARITHABORT ON 
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED 
 
DECLARE @LastRow int 
SET @LastRow = @star.ngRow + @PageSize 
 
SELECT  
rowguid 
INTO #NwaGuidList 
FROM  
 NWA N WITH (NOLOCK) 
 INNER JOIN [USMC].[vwRecrui.ngOrgIDs] vw ON n.ORGANIZATION_OF_RECORD_ID = vw.root 
WHERE 
 NWA_DECLARED_DATE BETWEEN @FromDate AND @ToDate AND  
 (vw.RS = @OrgID OR vw.RSS = @OrgID  OR vw.OSS = @OrgID OR vw.District = @OrgID OR vw.Region = @OrgID OR vw.HQ = @OrgID) 
 
CREATE TABLE #O.cerProspectPac 
( 
 DateStartedWorking DATETIME, 
 NwaId uniqueiden..er 
) 
 
INSERT INTO #O.cerProspectPac 
 SELECT  
  MIN(OFFICERPROSPECTPAC.DateStartedWorking) AS DateStartedWorking, 
  p.NwaId 
 FROM  
  PROSPECTING.USMC.OFFICERPROSPECTPAC 
  INNER JOIN PROSPECTING.USMC.PROSPECT p ON OFFICERPROSPECTPAC.PROSPECTID = p.PROSPECTID 
  INNER JOIN MCRISS.dbo.RECRUITING_ORGANIZATION org ON org.rowguid = p.Recrui.ngOrganiza.onId 
  INNER JOIN #NwaGuidList n ON n.rowguid = p.NwaId 
  INNER JOIN MCRISS.USMC.vwRecrui.ngOrgIDs vw ON org.ORGANIZATION_ID = vw.root 
 WHERE 
  NwaId IS NOT NULL AND 
  (vw.RS = @OrgID OR vw.RSS = @OrgID  OR vw.OSS = @OrgID OR vw.District = @OrgID OR vw.Region = @OrgID OR vw.HQ = @OrgID) 
 Group By  
  p.NwaId 
 
 
CREATE TABLE #NWA_VIEW  
 (RowNumber int not null,PERSON_ID INT, NWA_ID INT,rowguid uniqueiden..er not null,CONTRACT_ID INT, PERSON_NAME VARCHAR(62), SSN CHAR(9), DATE_STARTED_WORKING DATETIME, DATE_DECLARED DATETIME, 
 PROGRAM VARCHAR(50), RACE CHAR(1), GENDER CHAR(1), RAPP_ISSUE_DATE DATETIME, RAPP_SUBMIT_DATE DATETIME, ASVAB_DATE DATETIME, EL_SCORE INT,AFQT_SCORE INT, 
 MEPS_MEDICAL_EXAM_DATE DATETIME, MEPS_MEDICAL_RESULT VARCHAR(4), ANNUAL_PHYSICAL_DATE DATETIME, ANNUAL_PHYSICAL_RESULT VARCHAR(4), FLIGHT_PHYSICAL_DATE DATETIME, FLIGHT_PHYSICAL_RESULT VARCHAR(4), 
 MAX_MEDICAL_EXAM_TYPE CHAR(1), MAX_MEDICAL_EXAM_DATE DATETIME, MAX_MEDICAL_RESULT VARCHAR(4),  
 MEDICAL_DOCS_SUBMIT_DATE DATETIME, CONSULT_DATE DATETIME, ASTB_DATE DATETIME, ASTB_SCORE INT, ASTB_SCORE_2 INT, ASTB_SCORE_3 INT, PFT_DATE DATETIME, PFT_SCORE INT,  
 TRANSCRIPT CHAR(1), ACF CHAR(1), EPSQ CHAR(1), BIRTH_VERIFICATION CHAR(1), POLICE CHAR(1), DD_FORM_368 CHAR(1), SRB CHAR(1), DD214 CHAR(1), DEAN CHAR(1),  
 PRF1 CHAR(1), PRF2 CHAR(1), EMPLOYER CHAR(1), I_AND_I CHAR(1), OTHER1 CHAR(1), OTHER2 CHAR(1), PRINTS CHAR(1), PHOTO CHAR(1), WAIVER_NOTES VARCHAR(50),  
 CONTRACT_BEGIN_DATE DATETIME,EMAIL_ADDRESS VARCHAR(50),FINAL_ACTION VARCHAR(40), ComponentCode varchar(2), 
 PROFESSED_EXAM_TYPE varchar(10), PROFESSED_EXAM_SCORE int) 
 
INSERT INTO #NWA_VIEW  
 ( 
 RowNumber, 
 PERSON_ID,  
 NWA_ID, 
    rowguid, 
 CONTRACT_ID,  
 PERSON_NAME,  
 SSN,  
 DATE_STARTED_WORKING,  
 DATE_DECLARED,   
 ComponentCode, 
 PROGRAM,  
 RACE,  
 GENDER,  
 RAPP_ISSUE_DATE,  
 RAPP_SUBMIT_DATE,  
 WAIVER_NOTES,  
 CONTRACT_BEGIN_DATE, 
    EMAIL_ADDRESS,  
 FINAL_ACTION 
 ) 
SELECT 
 ROW_NUMBER() OVER(Order By P.LAST_NAME, P.FIRST_NAME, P.LEGAL_MIDDLE_NAME), 
 P.PERSON_ID,  
 N.NWA_ID,  
    N.rowguid, 
 C.CONTRACT_ID, 
 P.LAST_NAME + ', ' + P.FIRST_NAME + COALESCE(SPACE(1) + P.LEGAL_MIDDLE_NAME, SPACE(0)) AS PERSON_NAME, 
 P.SOCIAL_SECURITY_NUMBER,  
 CASE 
  WHEN OPP.DATESTARTEDWORKING IS NULL THEN N.NWA_DATE_STARTED_WORKING 
  ELSE OPP.DATESTARTEDWORKING 
 END AS DATE_STARTED_WORKING,  
 N.NWA_DECLARED_DATE,  
 CC.COMPONENT_CODE,  
 CC.COMPONENT_DESCRIPTION,  
 MC.RACE_CODE,  
 MC.GENDER_CODE,   
 N.RAPP_ISSUE_DATE,  
 N.RAPP_SUBMIT_DATE,  
 N.NWA_LOG_NOTES,  
 C.CONTRACT_BEGIN_DATE,  
    N.EMAIL_ADDRESS, 
 CASE CS.STATUS_CODE 
  WHEN 'A' THEN SD.DISPOSITION_DESCRIPTION    
  ELSE SD.STATUS_DESCRIPTION 
 END AS FINAL_ACTION 
FROM NWA N WITH (NOLOCK) 
 INNER JOIN MARINE_CANDIDATE MC ON (N.MARINE_CANDIDATE_ID = MC.MARINE_CANDIDATE_ID) 
 INNER JOIN [USMC].[vwRecrui.ngOrgIDs] vw ON n.ORGANIZATION_OF_RECORD_ID = vw.root 
 INNER JOIN PERSON P ON MC.MARINE_CANDIDATE_ID = P.PERSON_ID 
 INNER JOIN CANDIDATE_STATUS CS ON 
  (N.NWA_ID = CS.NWA_ID AND 
  CS.STATUS_TYPE = 'O' AND 
  CS.CANDIDATE_STATUS_ID = (SELECT MAX(CANDIDATE_STATUS_ID) FROM CANDIDATE_STATUS WHERE NWA_ID = N.NWA_ID)) 
 INNER JOIN STATUS_DISPOSITION SD ON  
  (CS.STATUS_TYPE = SD.STATUS_TYPE AND 
  CS.STATUS_CODE = SD.STATUS_CODE AND 
  CS.DISPOSITION_CODE = SD.DISPOSITION_CODE) 
 LEFT OUTER JOIN COMPONENT_CODE CC ON N.OFFICER_COMPONENT_CODE = CC.COMPONENT_CODE 
 LEFT OUTER JOIN OFFICER_CONTRACT C ON N.NWA_ID = C.NWA_ID 
 LEFT OUTER JOIN #O.cerProspectPac OPP ON OPP.NWAID = N.ROWGUID 
WHERE 
 N.NWA_DECLARED_DATE BETWEEN @FromDate AND @ToDate AND 
 ((@FinalAc.on = 'ALL') OR 
 (@FinalAc.on = CASE @FinalAc.on  
  WHEN 'B' THEN cs.STATUS_CODE 
  ELSE cs.DISPOSITION_CODE 
 END)) AND  
 (vw.RS = @OrgID OR vw.RSS = @OrgID  OR vw.OSS = @OrgID OR vw.District = @OrgID OR vw.Region = @OrgID OR vw.HQ = @OrgID) 
 
--- APPLICATION CHECKLIST DATA 
UPDATE  
 #NWA_VIEW 
SET 
 TRANSCRIPT   = AC.OFFICIAL_COLLEGE_TRANSCRIPTS, 
 ACF    = AC.ACFNAVMC10469, 
 EPSQ    = AC.COPY_OF_EPSQ, 
 BIRTH_VERIFICATION  = AC.BIRTH_VERIFICATION,  
 POLICE    = AC.MINOR_TRAFFIC_ARREST_FORM, 
 DD_FORM_368   = AC.DD_FORM_368, 
 SRB    = AC.SRB, 
 DD214    = AC.DD214, 
 DEAN    = AC.DEAN, 
 PRF1    = AC.PRF1, 
 PRF2    = AC.PRF2, 
 EMPLOYER   = AC.EMPLOYER, 
 I_AND_I   = AC.I_AND_I, 
 OTHER1    = AC.OTHER1, 
 OTHER2    = AC.OTHER2,  
 PRINTS    = AC.PRINTS, 
 PHOTO    = AC.PHOTO_PAGE 
FROM 
 #NWA_VIEW V INNER JOIN APPLICATION_CHECKLIST AC ON V.NWA_ID = AC.NWA_ID 
 
--- ASVAB DATA 
UPDATE  
 #NWA_VIEW 
SET 
 ASVAB_DATE = CA.ASVAB_DATE, 
 EL_SCORE = CA.EL_SCORE, 
 AFQT_SCORE = CA.AFQT_SCORE 
FROM 
 #NWA_VIEW V INNER JOIN CANDIDATE_ASVAB CA ON  
  (V.PERSON_ID = CA.MARINE_CANDIDATE_ID AND 
  CA.ASVAB_DATE = dbo.GetMaxASVABDate(CA.MARINE_CANDIDATE_ID));  
   
   
--- GET PROFESSED EXAM DATA   
WITH C AS 
( 
 SELECT ROW_NUMBER() OVER ( 
   PARTITION BY MARINE_CANDIDATE_ID 
   ORDER BY MARINE_CANDIDATE_ID, EXAM_DATE DESC, UPDATE_DATE DESC ) AS rowNum, 
    MARINE_CANDIDATE_ID 
  ,PROFESSED_EXAM_TYPE 
  ,EXAM_DATE 
  ,EXAM_SCORE 
  FROM ( 
  SELECT  
  MARINE_CANDIDATE_ID 
  ,PROFESSED_EXAM_TYPE 
  ,EXAM_DATE 
  ,EXAM_SCORE 
  ,UPDATE_DATE 
 FROM  
  MCRISS.dbo.CANDIDATE_PROFESSED_EXAM 
 WHERE  
 MARINE_CANDIDATE_ID IN (SELECT PERSON_ID FROM #NWA_VIEW ) 
 AND 
  PROFESSED_EXAM_TYPE <>'V'  
 UNION ALL 
   
 SELECT  
    ASVAB.MARINE_CANDIDATE_ID 
   ,PROFESSED_EXAM_TYPE = 'A' 
      ,ASVAB.ASVAB_DATE AS EXAM_DATE      
      ,ASVAB.AFQT_SCORE as EXAM_SCORE 
   ,ASVAB.UPDATE_DATE 
      
  FROM MCRISS.dbo.CANDIDATE_ASVAB AS ASVAB 
   WHERE  
 MARINE_CANDIDATE_ID IN (SELECT PERSON_ID FROM #NWA_VIEW ) 
   ) MENTAL   
  
) 
 
SELECT * INTO #NonASTBExams FROM C WHERE rowNum = 1; 
   
UPDATE  
 #NWA_VIEW 
SET 
 PROFESSED_EXAM_TYPE  = PE.PROFESSED_EXAM_SHORT_DESC, 
 PROFESSED_EXAM_SCORE  = CPE.EXAM_SCORE 
FROM 
 #NWA_VIEW N 
 INNER JOIN #NonASTBExams CPE ON N.PERSON_ID = CPE.MARINE_CANDIDATE_ID  
 INNER JOIN PROFESSED_EXAM PE ON PE.PROFESSED_EXAM_TYPE = CPE.PROFESSED_EXAM_TYPE; 
 
--- PFT DATA 
UPDATE  
 #NWA_VIEW 
SET 
 PFT_DATE = PFT.PFT_DATE, 
 PFT_SCORE = PFT.PFT_SCORE 
FROM 
 #NWA_VIEW V INNER JOIN PFT ON  
  (V.NWA_ID = PFT.NWA_ID AND 
  PFT.PFT_ID = dbo.GetMaxPFTID(V.NWA_ID)) 
 
--- CONSULTATION DATA 
UPDATE  
 #NWA_VIEW 
SET 
 CONSULT_DATE = CONS.MEDICAL_EXAM_DATE 
FROM 
 #NWA_VIEW V INNER JOIN CANDIDATE_MEDICAL_EXAM CONS ON 
  (V.PERSON_ID = CONS.MARINE_CANDIDATE_ID AND 
  CONS.MEDICAL_EXAM_TYPE = 'CONS' AND  
  CONS.MEDICAL_EXAM_DATE = dbo.GetMaxMedicalExamDate(CONS.MARINE_CANDIDATE_ID, CONS.MEDICAL_EXAM_TYPE)) 
 
--- MEPS MEDICAL DATA 
UPDATE  
 #NWA_VIEW 
SET 
 MEPS_MEDICAL_EXAM_DATE  = CME.MEDICAL_EXAM_DATE,  
 MEPS_MEDICAL_RESULT  = CASE CME.MEDICAL_DISPOSITION 
     WHEN 'Q' THEN 'QUAL' 
     WHEN 'D' THEN 'DQ' 
     ELSE SPACE(0) 
     END 
FROM 
 #NWA_VIEW V INNER JOIN CANDIDATE_MEDICAL_EXAM CME ON 
  (V.PERSON_ID = CME.MARINE_CANDIDATE_ID AND 
  CME.MEDICAL_EXAM_TYPE = 'FULL' AND  
  CME.MEDICAL_EXAM_DATE = dbo.GetMaxMedicalExamDate(CME.MARINE_CANDIDATE_ID, CME.MEDICAL_EXAM_TYPE)) 
 
--- ANNUAL PHYSICAL DATA 
UPDATE  
 #NWA_VIEW 
SET 
 ANNUAL_PHYSICAL_DATE  = AP.EXAM_DATE,  
 ANNUAL_PHYSICAL_RESULT  = CASE D.MEDICAL_DISPOSITION_CODE 
     WHEN 'Q' THEN 'QUAL' 
     WHEN 'DQ' THEN 'DQ' 
     ELSE SPACE(0) 
     END 
FROM 
 #NWA_VIEW V INNER JOIN ANNUAL_PHYSICAL AP ON 
  (V.PERSON_ID = AP.MARINE_CANDIDATE_ID AND 
  AP.EXAM_DATE = (SELECT MAX(AP1.EXAM_DATE) FROM ANNUAL_PHYSICAL AP1  
    WHERE AP1.MARINE_CANDIDATE_ID = AP.MARINE_CANDIDATE_ID)) 
 LEFT OUTER JOIN MEDICAL_DISPOSITION D ON AP.MEDICAL_DISPOSITION_ID = D.MEDICAL_DISPOSITION_ID 
 
--- FLIGHT PHYSICAL DATA 
UPDATE  
 #NWA_VIEW 
SET 
 FLIGHT_PHYSICAL_DATE   = FP.EXAM_DATE,  
 FLIGHT_PHYSICAL_RESULT = CASE D.MEDICAL_DISPOSITION_CODE 
     WHEN 'Q' THEN 'QUAL' 
     WHEN 'DQ' THEN 'DQ' 
     ELSE SPACE(0) 
     END 
FROM 
 #NWA_VIEW V INNER JOIN FLIGHT_PHYSICAL FP ON 
  (V.PERSON_ID = FP.MARINE_CANDIDATE_ID AND 
  FP.EXAM_DATE = (SELECT MAX(FP1.EXAM_DATE) FROM FLIGHT_PHYSICAL FP1  
    WHERE FP1.MARINE_CANDIDATE_ID = FP.MARINE_CANDIDATE_ID)) 
 LEFT OUTER JOIN MEDICAL_DISPOSITION D ON FP.MEDICAL_DISPOSITION_ID = D.MEDICAL_DISPOSITION_ID 
 
--- DEFINE THE MAX MEDICAL TYPE 
UPDATE  
 #NWA_VIEW 
SET 
 MAX_MEDICAL_EXAM_TYPE = CASE (SELECT MAX(EXAM_DATE) FROM  
     ((SELECT MEPS_MEDICAL_EXAM_DATE AS EXAM_DATE FROM #NWA_VIEW V1 WHERE V1.PERSON_ID = V.PERSON_ID) UNION 
     (SELECT ANNUAL_PHYSICAL_DATE FROM #NWA_VIEW V1 WHERE V1.PERSON_ID = V.PERSON_ID) UNION 
     (SELECT FLIGHT_PHYSICAL_DATE FROM #NWA_VIEW V1 WHERE V1.PERSON_ID = V.PERSON_ID)) AS MEDICAL_DATES) 
     WHEN MEPS_MEDICAL_EXAM_DATE THEN 'M' 
     WHEN ANNUAL_PHYSICAL_DATE THEN 'A' 
     WHEN FLIGHT_PHYSICAL_DATE  THEN 'F' 
     ELSE NULL 
     END 
FROM 
 #NWA_VIEW V  
 
--- SET THE MAX MEDICAL DATE AND RESULT 
UPDATE  
 #NWA_VIEW 
SET 
 MAX_MEDICAL_EXAM_DATE  = CASE MAX_MEDICAL_EXAM_TYPE  
     WHEN 'M' THEN MEPS_MEDICAL_EXAM_DATE 
     WHEN 'A' THEN ANNUAL_PHYSICAL_DATE 
     WHEN 'F' THEN FLIGHT_PHYSICAL_DATE 
     ELSE NULL 
     END,  
 MAX_MEDICAL_RESULT  = CASE MAX_MEDICAL_EXAM_TYPE  
     WHEN 'M' THEN MEPS_MEDICAL_RESULT 
     WHEN 'A' THEN ANNUAL_PHYSICAL_RESULT 
     WHEN 'F' THEN FLIGHT_PHYSICAL_RESULT 
     ELSE NULL 
     END  
FROM 
 #NWA_VIEW V  
 
 
--- ASTB DATA 
;WITH T AS 
( 
 SELECT ROW_NUMBER() OVER ( 
   PARTITION BY MARINE_CANDIDATE_ID 
   ORDER BY MARINE_CANDIDATE_ID, EXAM_DATE DESC, UPDATE_DATE DESC ) AS rowNum 
  ,MARINE_CANDIDATE_ID 
  ,PROFESSED_EXAM_TYPE 
  ,EXAM_DATE 
  ,EXAM_SCORE 
  ,EXAM_SCORE2 
  ,EXAM_SCORE3 
 FROM  
  MCRISS.dbo.CANDIDATE_PROFESSED_EXAM 
 WHERE  
  MARINE_CANDIDATE_ID IN (SELECT PERSON_ID FROM #NWA_VIEW ) 
  AND PROFESSED_EXAM_TYPE = 'V'  
) 
SELECT * INTO #AstbExams FROM T WHERE rowNum = 1; 
 
UPDATE  
 #NWA_VIEW 
SET 
 ASTB_DATE  = ASTB.EXAM_DATE, 
 ASTB_SCORE  = ASTB.EXAM_SCORE, 
 ASTB_SCORE_2 = ASTB.EXAM_SCORE2, 
 ASTB_SCORE_3 = ASTB.EXAM_SCORE3 
FROM 
 #NWA_VIEW V  
 INNER JOIN #ASTBExams ASTB ON V.PERSON_ID = ASTB.MARINE_CANDIDATE_ID 
 
--- RETRIEVE DATA 
SELECT 
    RowNumber,  
 PERSON_ID, NWA_ID,rowguid, CONTRACT_ID, PERSON_NAME, SSN, 
 COALESCE(CONVERT(CHAR(6), DATE_STARTED_WORKING, 12), SPACE(0)) AS DATE_STARTED_WORKING, 
 COALESCE(CONVERT(CHAR(6), DATE_DECLARED, 12), SPACE(0)) AS DATE_DECLARED, 
 COALESCE(PROGRAM, SPACE(0)) AS PROGRAM, 
 COALESCE(RACE, SPACE(0)) AS RACE, 
 COALESCE(GENDER, SPACE(0)) AS GENDER, 
 COALESCE(CONVERT(CHAR(6), RAPP_ISSUE_DATE, 12), SPACE(0)) AS RAPP_ISSUE_DATE, 
 COALESCE(CONVERT(CHAR(6), RAPP_SUBMIT_DATE, 12), SPACE(0)) AS RAPP_SUBMIT_DATE, 
 COALESCE(CONVERT(CHAR(6), ASVAB_DATE, 12), SPACE(0)) AS ASVAB_DATE, 
 COALESCE(CONVERT(VARCHAR(4), EL_SCORE), SPACE(0)) AS EL_SCORE, 
 COALESCE(CONVERT(VARCHAR(4), AFQT_SCORE), SPACE(0)) AS AFQT_SCORE, 
 COALESCE(CONVERT(CHAR(6), MAX_MEDICAL_EXAM_DATE, 12), SPACE(0)) AS MEDICAL_EXAM_DATE, 
 COALESCE(MAX_MEDICAL_RESULT, SPACE(0)) AS MEDICAL_RESULT, 
 SPACE(0) AS MEDICAL_DOCS_SUBMIT_DATE, 
 COALESCE(CONVERT(CHAR(6), MEPS_MEDICAL_EXAM_DATE, 12), SPACE(0)) AS C, 
 COALESCE(CONVERT(CHAR(6), ASTB_DATE, 12), SPACE(0)) AS ASTB_DATE, 
 COALESCE(CONVERT(VARCHAR(4), ASTB_SCORE), SPACE(0)) AS ASTB_SCORE, 
 COALESCE(CONVERT(VARCHAR(4), ASTB_SCORE_2), SPACE(0)) AS ASTB_SCORE_2, 
 COALESCE(CONVERT(VARCHAR(4), ASTB_SCORE_3), SPACE(0)) AS ASTB_SCORE_3, 
 COALESCE(CONVERT(CHAR(6), PFT_DATE, 12), SPACE(0)) AS PFT_DATE, 
 COALESCE(CONVERT(VARCHAR(4), PFT_SCORE), SPACE(0)) AS PFT_SCORE, 
 COALESCE(NULLIF(TRANSCRIPT, 'N'), SPACE(0)) AS TRANSCRIPT, 
 COALESCE(NULLIF(ACF, 'N'), SPACE(0)) AS ACF, 
 COALESCE(NULLIF(EPSQ, 'N'), SPACE(0)) AS EPSQ, 
 COALESCE(NULLIF(BIRTH_VERIFICATION, 'N'), SPACE(0)) AS BIRTH_VERIFICATION,  
 COALESCE(NULLIF(POLICE, 'N'), SPACE(0)) AS POLICE, 
 COALESCE(NULLIF(DD_FORM_368, 'N'), SPACE(0)) AS DD_FORM_368, 
 COALESCE(NULLIF(SRB, 'N'), SPACE(0)) AS SRB, 
 COALESCE(NULLIF(DD214, 'N'), SPACE(0)) AS DD214, 
 COALESCE(NULLIF(DEAN, 'N'), SPACE(0)) AS DEAN, 
 COALESCE(NULLIF(PRF1, 'N'), SPACE(0)) AS PRF1, 
 COALESCE(NULLIF(PRF2, 'N'), SPACE(0)) AS PRF2, 
 COALESCE(NULLIF(EMPLOYER, 'N'), SPACE(0)) AS EMPLOYER, 
 COALESCE(NULLIF(I_AND_I, 'N'), SPACE(0)) AS I_AND_I, 
 COALESCE(NULLIF(OTHER1, 'N'), SPACE(0)) AS OTHER1, 
 COALESCE(NULLIF(OTHER2, 'N'), SPACE(0)) AS OTHER2,  
 COALESCE(NULLIF(PRINTS, 'N'), SPACE(0)) AS PRINTS, 
 COALESCE(NULLIF(PHOTO, 'N'), SPACE(0)) AS PHOTO, 
 COALESCE(WAIVER_NOTES, SPACE(0)) AS WAIVER_NOTES, 
 COALESCE(CONVERT(CHAR(6), CONTRACT_BEGIN_DATE, 12), SPACE(0)) AS CONTRACT_BEGIN_DATE, 
    EMAIL_ADDRESS, 
 FINAL_ACTION, 
 PROFESSED_EXAM_TYPE, 
 PROFESSED_EXAM_SCORE 
FROM 
 #NWA_VIEW  
 
SELECT 
 (SELECT COUNT(*) FROM #NWA_VIEW) AS Total, 
 (SELECT COUNT(*) FROM #NWA_VIEW WHERE ComponentCode IN ('0A', '0B', '0C', '0E', 'AD') AND Gender = 'M') AS PlcMales, 
 (SELECT COUNT(*) FROM #NWA_VIEW WHERE ComponentCode IN ('0A', '0B', '0C', '0E', 'AD') AND Gender = 'F') AS PlcFemales, 
 (SELECT COUNT(*) FROM #NWA_VIEW WHERE ComponentCode IN ('1A', '1B', '1C', '1E', '1H') AND Gender = 'M') AS OccMales, 
 (SELECT COUNT(*) FROM #NWA_VIEW WHERE ComponentCode IN ('1A', '1B', '1C', '1E', '1H') AND Gender = 'F') AS OccFemales 
 
 
--- CLEAN UP 
DROP TABLE #NWA_VIEW  
DROP TABLE #O.cerProspectPac 
DROP TABLE #NwaGuidList 
DROP TABLE #NonASTBExams 
DROP TABLE #ASTBExams]]></body>
<schema>E9C4E37D-78A2-31F9-D580-7C2848ACFCB7</schema>
<database>EA42DEDC-DFC5-B775-3079-AD0E133F5E1D</database>
</StoredProcedureSqlServerv2k5>