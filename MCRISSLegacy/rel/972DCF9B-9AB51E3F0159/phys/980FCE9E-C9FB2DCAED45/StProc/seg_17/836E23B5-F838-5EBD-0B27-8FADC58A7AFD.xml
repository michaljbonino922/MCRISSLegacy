<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureSqlServerv2k5 class="oracle.dbtools.crest.model.design.storage.sqlserver.v2k5.StoredProcedureSqlServerv2k5" name="[sp_GetEnlistedMEPSQuickView]" directorySegmentName="seg_17" id="836E23B5-F838-5EBD-0B27-8FADC58A7AFD">
<sourceDDLFile>create MCRISS script - MCRISS OTA.txt</sourceDDLFile>
<createdBy>MichalBonino</createdBy>
<createdTime>2024-04-29 19:28:41 UTC</createdTime>
<ownerDesignName>MCRISSLegacy</ownerDesignName>
<body><![CDATA[@ScheduleDate  date.me, 
 @MEPS  int = NULL, 
 @SortBy  int = NULL  
AS 
 
SET NOCOUNT ON 
 
SELECT DISTINCT 
 P.PERSON_ID, NWA.NWA_ID, C.CONTRACT_ID, 
 PERSON_NAME = RTRIM(P.LAST_NAME) + SPACE(1) + RTRIM(P.FIRST_NAME) + SPACE(1) + ISNULL(P.LEGAL_MIDDLE_NAME,''), 
 MC.GENDER_CODE,  
 RSS = RSS.NAME, 
 [QT/GT] = CONVERT(VARCHAR(4), CA.AFQT_SCORE) + '/' + CONVERT(VARCHAR(4), CA.GT_SCORE), 
 MS.PROCESSING_NOTES,  
 PROCESSING_STATUS = CASE MS.PROCESSING_STATUS 
    WHEN 'P' THEN 'PENDING' 
    WHEN 'S' THEN 'SHOW' 
    WHEN 'N' THEN 'NO SHOW' 
    WHEN 'M' THEN 'PROJECT TO MIRS'     
    ELSE MS.PROCESSING_STATUS 
    END, 
 P.SOCIAL_SECURITY_NUMBER, 
 CATEGORY_CODE = CASE NWA.CATEGORY_CODE   
    WHEN 'R' THEN 'Regular' 
    WHEN 'G' THEN 'Reserve-Ground' 
    WHEN 'A' THEN 'Reseve-Air' 
    WHEN 'P' THEN 'Prior-Service' 
    ELSE NULL 
     END, 
 [(QT/GT)DATE] = CONVERT(VARCHAR(11), CA.ASVAB_DATE, 106), 
 [(DEP)RESULT] =  CASE MS.CONTRACT  
    WHEN 'Y' THEN 'YES' 
    ELSE 'NO' 
    END, 
 [(SHIP)RESULT] =  CASE MS.SHIP  
    WHEN 'Y' THEN 'YES' 
    ELSE 'NO' 
    END, 
 SD.STATUS_DESCRIPTION, 
 SD.DISPOSITION_DESCRIPTION, 
 MS.SCHEDULE_ID, MS.MEPS_ORGANIZATION_ID,  
 RSS_ID = RSS.ORGANIZATION_ID, 
 RS = RS.NAME, 
 SORT_ORDER =  CASE @SortBy 
    WHEN 1 THEN RTRIM(P.LAST_NAME) + SPACE(1) + RTRIM(P.FIRST_NAME) + SPACE(1) + ISNULL(P.LEGAL_MIDDLE_NAME, '') 
    WHEN 2 THEN MS.PROCESSING_STATUS 
    WHEN 3 THEN MC.GENDER_CODE 
    WHEN 4 THEN RSS.NAME 
    WHEN 5 THEN SD.STATUS_DESCRIPTION + '/' + SD.DISPOSITION_DESCRIPTION 
    WHEN 6 THEN RS.NAME 
    ELSE RTRIM(P.LAST_NAME) + SPACE(1) + RTRIM(P.FIRST_NAME) + SPACE(1) + ISNULL(P.LEGAL_MIDDLE_NAME, '') 
          END  
FROM 
 MEPS_SCHEDULE MS INNER JOIN NWA ON MS.NWA_ID = NWA.NWA_ID 
 INNER JOIN MARINE_CANDIDATE MC ON NWA.MARINE_CANDIDATE_ID = MC.MARINE_CANDIDATE_ID 
 INNER JOIN PERSON P ON MC.MARINE_CANDIDATE_ID = P.PERSON_ID 
 INNER JOIN MEPS_ORGANIZATION_LOOKUP MOL ON MS.MEPS_ORGANIZATION_ID = MOL.MEPS_ORGANIZATION_ID 
 INNER JOIN CANDIDATE_STATUS CS ON (NWA.NWA_ID = CS.NWA_ID AND 
      CS.CANDIDATE_STATUS_ID = (SELECT MAX(CS2.CANDIDATE_STATUS_ID) FROM CANDIDATE_STATUS CS2 
          WHERE CS2.NWA_ID = CS.NWA_ID AND  
          DATEDIFF(DAY, @ScheduleDate, CS2.STATUS_EFFECTIVE_DATE) <= 0)) 
 INNER JOIN STATUS_DISPOSITION SD ON (CS.STATUS_TYPE = SD.STATUS_TYPE AND CS.STATUS_CODE = SD.STATUS_CODE 
      AND CS.DISPOSITION_CODE = SD.DISPOSITION_CODE) 
 INNER JOIN RECRUITING_ORGANIZATION RSS ON NWA.ORGANIZATION_OF_RECORD_ID = RSS.ORGANIZATION_ID 
 INNER JOIN ORGANIZATION_MAP OM ON RSS.ORGANIZATION_ID = OM.CHILD_ORGANIZATION_ID 
 INNER JOIN RECRUITING_ORGANIZATION RS ON OM.PARENT_ORGANIZATION_ID = RS.ORGANIZATION_ID 
 LEFT OUTER JOIN CANDIDATE_ASVAB CA ON (P.PERSON_ID = CA.MARINE_CANDIDATE_ID AND  
      CA.ASVAB_DATE = (SELECT MAX(CA2.ASVAB_DATE) FROM CANDIDATE_ASVAB CA2  
         WHERE CA2.MARINE_CANDIDATE_ID = CA.MARINE_CANDIDATE_ID)) 
 LEFT OUTER JOIN CONTRACT C ON NWA.NWA_ID = C.NWA_ID 
WHERE  
 MS.MEPS_ORGANIZATION_ID = @MEPS AND  
 MS.PROCESSING_DATE = @ScheduleDate AND  
 MS.DELETED != 'Y' 
ORDER BY 
 SORT_ORDER]]></body>
<schema>3925E19F-DC76-90A4-B892-D7A526C79632</schema>
<database>B007042D-D2E3-F83F-481F-CEB23B21CB30</database>
</StoredProcedureSqlServerv2k5>