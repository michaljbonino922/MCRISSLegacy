<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureSqlServerv2k5 class="oracle.dbtools.crest.model.design.storage.sqlserver.v2k5.StoredProcedureSqlServerv2k5" name="[sp_GetLatestJPASExportData]" directorySegmentName="seg_17" id="24EB9272-1D6B-061A-59F0-EC34A11BC9EF">
<sourceDDLFile>Appian.sql</sourceDDLFile>
<createdBy>MichalBonino</createdBy>
<createdTime>2024-04-29 23:57:48 UTC</createdTime>
<ownerDesignName>MCRISSLegacy</ownerDesignName>
<body><![CDATA[@PersonID   int, 
 @LATEST_AEP_UPLOAD_FILE  varchar(50) OUTPUT, 
 @JPAS_PDF_FILE   varchar(64) OUTPUT, 
 @JPAS_PDF_EXPORT_FILE  varchar(64) OUTPUT, 
 @JPAS_PDF_AEP_FILE  varchar(50) OUTPUT,  
 @AEP_MAX_UPLOAD_LOG_ID  int OUTPUT 
  
AS 
 
--- DECLARE @AEP_MAX_UPLOAD_LOG_ID AS INTEGER 
SET @AEP_MAX_UPLOAD_LOG_ID = (SELECT MAX(AEP_FILE_UPLOAD_LOG_ID) FROM AEP_FILE_UPLOAD_LOG WHERE PERSON_ID = @PersonID) 
 
SELECT @LATEST_AEP_UPLOAD_FILE = [FILE_NAME] 
FROM AEP_FILE_UPLOAD_LOG 
WHERE PERSON_ID = @PersonID AND 
 AEP_FILE_UPLOAD_LOG_ID = @AEP_MAX_UPLOAD_LOG_ID 
 
DECLARE @JPAS_MAX_EXPORT_ID AS INTEGER 
SET @JPAS_MAX_EXPORT_ID =  ( 
    SELECT MAX(JPAS_LOG_ID) 
    FROM AEP_FILE_UPLOAD_LOG A2 INNER JOIN JPAS_EXPORT_LOG EX2 
     ON ( A2.AEP_FILE_UPLOAD_LOG_ID = EX2.AEP_FILE_UPLOAD_LOG_ID AND EX2.PDF_FILE is not NULL) 
    WHERE  A2.PERSON_ID = @PersonID 
    ) 
 
 
SELECT  @JPAS_PDF_FILE = EX.PDF_FILE, @JPAS_PDF_EXPORT_FILE = EX.DATA_FILE, @JPAS_PDF_AEP_FILE = A.[FILE_NAME] 
FROM JPAS_EXPORT_LOG EX INNER JOIN AEP_FILE_UPLOAD_LOG A 
  ON EX.AEP_FILE_UPLOAD_LOG_ID = A.AEP_FILE_UPLOAD_LOG_ID 
WHERE A.PERSON_ID = @PersonID AND 
 EX.JPAS_LOG_ID = @JPAS_MAX_EXPORT_ID]]></body>
<schema>DD6CF638-A2EB-2E1B-FF13-422CA718DE2D</schema>
<database>EA42DEDC-DFC5-B775-3079-AD0E133F5E1D</database>
</StoredProcedureSqlServerv2k5>