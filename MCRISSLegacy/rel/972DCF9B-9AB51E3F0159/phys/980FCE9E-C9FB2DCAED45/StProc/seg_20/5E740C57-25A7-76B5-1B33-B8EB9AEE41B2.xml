<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureSqlServerv2k5 class="oracle.dbtools.crest.model.design.storage.sqlserver.v2k5.StoredProcedureSqlServerv2k5" name="[sp_GetProspec.ngActDailyReportMCRC]" directorySegmentName="seg_20" id="5E740C57-25A7-76B5-1B33-B8EB9AEE41B2">
<sourceDDLFile>create MCRISS script - MCRISS OTA.txt</sourceDDLFile>
<createdBy>MichalBonino</createdBy>
<createdTime>2024-04-29 19:28:41 UTC</createdTime>
<ownerDesignName>MCRISSLegacy</ownerDesignName>
<body><![CDATA[@Organiza.onID as integer,  
 @MonthBeginDate as date.me  
AS 
 
SET NOCOUNT ON 
 
DECLARE @MonthEndDate varchar(11) 
SET @MonthEndDate = CONVERT(VARCHAR(11), DATEADD(DAY, -1, DATEADD(MONTH, 1, @MonthBeginDate)), 106) 
 
--- CONTRACT ACTIVITY DATA  
SELECT  
 REGION.ORGANIZATION_ID, REGION.NAME,  
 CONVERT(VARCHAR(11), C.CONTRACT_BEGIN_DATE, 106) AS ACTIVITY_DATE,  
 ACTIVITY_TYPE = 1,  
 COUNT(C.CONTRACT_ID) AS ACTIVITY_COUNT 
FROM  
 ORGANIZATION_MAP MCRC_MAP INNER JOIN ORGANIZATION_MAP REGION_MAP ON 
  (MCRC_MAP.PARENT_ORGANIZATION_ID = @Organiza.onID AND 
  MCRC_MAP.CHILD_ORGANIZATION_ID = REGION_MAP.PARENT_ORGANIZATION_ID) 
 INNER JOIN ORGANIZATION_MAP DISTRICT_MAP ON REGION_MAP.CHILD_ORGANIZATION_ID = DISTRICT_MAP.PARENT_ORGANIZATION_ID 
 INNER JOIN ORGANIZATION_MAP RS_MAP ON DISTRICT_MAP.CHILD_ORGANIZATION_ID = RS_MAP.PARENT_ORGANIZATION_ID 
 INNER JOIN RECRUITING_ORGANIZATION RSS ON 
  (RS_MAP.CHILD_ORGANIZATION_ID = RSS.ORGANIZATION_ID AND  
  RSS.ORGANIZATION_TYPE = 'RSS' AND  
  RSS.ISOPEN = 'Y' AND  
  DATEDIFF(MONTH, RSS.EFFECTIVE_DATE, @MonthBeginDate) >= 0) 
 INNER JOIN NWA N ON  
  (N.ORGANIZATION_OF_RECORD_ID = RSS.ORGANIZATION_ID AND  
  COALESCE(N.COMP_CHANGE_FLAG, 'N') != 'Y') 
 INNER JOIN CONTRACT C ON  
  (C.NWA_ID = N.NWA_ID AND 
  DATEDIFF(MONTH, C.CONTRACT_BEGIN_DATE, @MonthBeginDate) = 0)  
 INNER JOIN RECRUITING_ORGANIZATION REGION ON MCRC_MAP.CHILD_ORGANIZATION_ID = REGION.ORGANIZATION_ID 
GROUP BY  
 REGION.ORGANIZATION_ID, REGION.NAME,  
 CONVERT(VARCHAR(11), C.CONTRACT_BEGIN_DATE, 106) 
 
UNION 
 
--- NWA ACTIVITY DATA 
SELECT 
 REGION.ORGANIZATION_ID, REGION.NAME,  
 CONVERT(VARCHAR(11), N.NWA_DECLARED_DATE, 106) AS ACTIVITY_DATE, 
 ACTIVITY_TYPE = 2,  
 COUNT(N.NWA_ID) AS ACTIVITY_COUNT 
FROM  
 ORGANIZATION_MAP MCRC_MAP INNER JOIN ORGANIZATION_MAP REGION_MAP ON 
  (MCRC_MAP.PARENT_ORGANIZATION_ID = @Organiza.onID AND  
  MCRC_MAP.CHILD_ORGANIZATION_ID = REGION_MAP.PARENT_ORGANIZATION_ID) 
 INNER JOIN ORGANIZATION_MAP DISTRICT_MAP ON REGION_MAP.CHILD_ORGANIZATION_ID = DISTRICT_MAP.PARENT_ORGANIZATION_ID 
 INNER JOIN ORGANIZATION_MAP RS_MAP ON DISTRICT_MAP.CHILD_ORGANIZATION_ID = RS_MAP.PARENT_ORGANIZATION_ID 
 INNER JOIN RECRUITING_ORGANIZATION RSS ON 
  (RS_MAP.CHILD_ORGANIZATION_ID = RSS.ORGANIZATION_ID AND  
  RSS.ORGANIZATION_TYPE = 'RSS' AND  
  RSS.ISOPEN = 'Y' AND  
  DATEDIFF(MONTH, RSS.EFFECTIVE_DATE, @MonthBeginDate) >= 0) 
 INNER JOIN NWA N ON  
  (N.ORGANIZATION_OF_RECORD_ID = RSS.ORGANIZATION_ID AND  
  COALESCE(N.COMP_CHANGE_FLAG, 'N') != 'Y' AND  
  DATEDIFF(MONTH, N.NWA_DECLARED_DATE, @MonthBeginDate) = 0 AND  
  COALESCE(N.COMP_CHANGE_FLAG, 'N') != 'Y') 
 INNER JOIN RECRUITING_ORGANIZATION REGION ON MCRC_MAP.CHILD_ORGANIZATION_ID = REGION.ORGANIZATION_ID 
GROUP BY 
 REGION.ORGANIZATION_ID, REGION.NAME, 
 CONVERT(VARCHAR(11), N.NWA_DECLARED_DATE, 106) 
 
UNION  
 
--- INTERVIEW ACTIVITY DATA 
SELECT   
 REGION.ORGANIZATION_ID, REGION.NAME,  
 COALESCE(CONVERT(VARCHAR(11), RA.ACTIVITY_DATE, 106), @MonthEndDate) AS ACTIVITY_DATE, 
 ACTIVITY_TYPE = 3, 
 SUM(COALESCE((RA.TC_INTERVIEWS + RA.OT_INTERVIEWS + RA.AC_INTERVIEWS + RA.HV_INTERVIEWS), 0)) AS ACTIVITY_COUNT 
FROM  
 RECRUITING_ORGANIZATION MCRC INNER JOIN ORGANIZATION_MAP REGION_MAP ON 
  (MCRC.ORGANIZATION_ID = @Organiza.onID AND 
  MCRC.ORGANIZATION_ID = REGION_MAP.PARENT_ORGANIZATION_ID) 
 INNER JOIN RECRUITING_ORGANIZATION REGION ON 
  (REGION.ORGANIZATION_ID = REGION_MAP.CHILD_ORGANIZATION_ID 
  AND REGION.ORGANIZATION_TYPE = 'R') 
 INNER JOIN ORGANIZATION_MAP DISTRICT_MAP ON  
  (REGION.ORGANIZATION_ID = DISTRICT_MAP.PARENT_ORGANIZATION_ID) 
 INNER JOIN RECRUITING_ORGANIZATION DISTRICT  ON 
  (DISTRICT.ORGANIZATION_ID = DISTRICT_MAP.CHILD_ORGANIZATION_ID 
  AND DISTRICT.ORGANIZATION_TYPE = 'D') 
 INNER JOIN ORGANIZATION_MAP RS_MAP ON  
  (DISTRICT.ORGANIZATION_ID = RS_MAP.PARENT_ORGANIZATION_ID) 
 INNER JOIN RECRUITING_ORGANIZATION RS ON  
  (RS_MAP.CHILD_ORGANIZATION_ID = RS.ORGANIZATION_ID AND 
  RS.ORGANIZATION_TYPE = 'RS') 
 INNER JOIN ORGANIZATION_MAP RSS_MAP ON  
  (RS_MAP.CHILD_ORGANIZATION_ID = RSS_MAP.PARENT_ORGANIZATION_ID) 
 INNER JOIN RECRUITING_ORGANIZATION RSS ON  
  (RSS_MAP.CHILD_ORGANIZATION_ID = RSS.ORGANIZATION_ID AND 
  RSS.ORGANIZATION_TYPE = 'RSS' AND 
  RSS.ISOPEN = 'Y' AND  
  DATEDIFF(MONTH, RSS.EFFECTIVE_DATE, @MonthBeginDate) >= 0) 
 LEFT OUTER JOIN RSS_ACTIVITY RA ON  
  (RSS.ORGANIZATION_ID = RA.ORGANIZATION_ID AND 
  DATEDIFF(MONTH, RA.ACTIVITY_DATE, @MonthBeginDate) = 0) 
GROUP BY 
 REGION.ORGANIZATION_ID, REGION.NAME, ACTIVITY_DATE  
ORDER BY  
 REGION.NAME, ACTIVITY_DATE, ACTIVITY_TYPE]]></body>
<schema>3925E19F-DC76-90A4-B892-D7A526C79632</schema>
<database>B007042D-D2E3-F83F-481F-CEB23B21CB30</database>
</StoredProcedureSqlServerv2k5>