<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureSqlServerv2k5 class="oracle.dbtools.crest.model.design.storage.sqlserver.v2k5.StoredProcedureSqlServerv2k5" name="[sp_GetProspec.ngActDailyReportRegion]" directorySegmentName="seg_20" id="C844AB4D-EA6B-042D-54D4-71F0EC69961B">
<sourceDDLFile>Appian.sql</sourceDDLFile>
<createdBy>MichalBonino</createdBy>
<createdTime>2024-04-29 23:57:48 UTC</createdTime>
<ownerDesignName>MCRISSLegacy</ownerDesignName>
<body><![CDATA[@Organiza.onID as integer,  
 @MonthBeginDate as date.me  
AS 
 
SET NOCOUNT ON 
 
DECLARE @MonthEndDate varchar(11) 
SET @MonthEndDate = CONVERT(VARCHAR(11), DATEADD(DAY, -1, DATEADD(MONTH, 1, @MonthBeginDate)), 106) 
 
--- CONTRACT ACTIVITY DATA  
SELECT  
 DIST.ORGANIZATION_ID, DIST.NAME,  
 CONVERT(VARCHAR(11), C.CONTRACT_BEGIN_DATE, 106) AS ACTIVITY_DATE,  
 ACTIVITY_TYPE = 1,  
 COUNT(C.CONTRACT_ID) AS ACTIVITY_COUNT 
FROM  
 
 ORGANIZATION_MAP REGION_MAP INNER JOIN ORGANIZATION_MAP DIST_MAP ON 
  (REGION_MAP.PARENT_ORGANIZATION_ID = @Organiza.onID AND 
  REGION_MAP.CHILD_ORGANIZATION_ID = DIST_MAP.PARENT_ORGANIZATION_ID) 
 INNER JOIN ORGANIZATION_MAP RS_MAP ON DIST_MAP.CHILD_ORGANIZATION_ID = RS_MAP.PARENT_ORGANIZATION_ID 
 INNER JOIN RECRUITING_ORGANIZATION RSS ON  
  (RS_MAP.CHILD_ORGANIZATION_ID = RSS.ORGANIZATION_ID AND 
  RSS.ORGANIZATION_TYPE = 'RSS' AND 
  RSS.ISOPEN = 'Y' AND  
  DATEDIFF(MONTH, RSS.EFFECTIVE_DATE, @MonthBeginDate) >= 0) 
 INNER JOIN NWA N ON  
  (N.ORGANIZATION_OF_RECORD_ID = RSS.ORGANIZATION_ID AND  
  COALESCE(N.COMP_CHANGE_FLAG, 'N') != 'Y') 
 INNER JOIN CONTRACT C ON   
  (C.NWA_ID = N.NWA_ID AND 
  DATEDIFF(MONTH, C.CONTRACT_BEGIN_DATE, @MonthBeginDate) = 0)  
 INNER JOIN RECRUITING_ORGANIZATION DIST ON  
  (DIST_MAP.PARENT_ORGANIZATION_ID = DIST.ORGANIZATION_ID AND 
  DIST.ORGANIZATION_TYPE = 'D')  
GROUP BY  
 DIST.ORGANIZATION_ID, DIST.NAME, CONVERT(VARCHAR(11), C.CONTRACT_BEGIN_DATE, 106) 
 
UNION 
 
--- NWA ACTIVITY DATA 
SELECT 
 DIST.ORGANIZATION_ID, DIST.NAME,  
 CONVERT(VARCHAR(11), N.NWA_DECLARED_DATE, 106) AS ACTIVITY_DATE, 
 ACTIVITY_TYPE = 2, COUNT(N.NWA_ID) AS ACTIVITY_COUNT 
FROM  
 ORGANIZATION_MAP REGION_MAP INNER JOIN ORGANIZATION_MAP DIST_MAP ON 
  (REGION_MAP.PARENT_ORGANIZATION_ID = @Organiza.onID AND 
  REGION_MAP.CHILD_ORGANIZATION_ID = DIST_MAP.PARENT_ORGANIZATION_ID) 
 INNER JOIN ORGANIZATION_MAP RS_MAP ON DIST_MAP.CHILD_ORGANIZATION_ID = RS_MAP.PARENT_ORGANIZATION_ID 
 INNER JOIN RECRUITING_ORGANIZATION RSS ON  
  (RS_MAP.CHILD_ORGANIZATION_ID = RSS.ORGANIZATION_ID AND 
  RSS.ORGANIZATION_TYPE = 'RSS' AND 
  RSS.ISOPEN = 'Y' AND  
  DATEDIFF(MONTH, RSS.EFFECTIVE_DATE, @MonthBeginDate) >= 0) 
 INNER JOIN NWA N ON  
  (N.ORGANIZATION_OF_RECORD_ID = RSS.ORGANIZATION_ID AND  
  DATEDIFF(MONTH, N.NWA_DECLARED_DATE, @MonthBeginDate) = 0 AND  
  COALESCE(N.COMP_CHANGE_FLAG, 'N') != 'Y') 
 INNER JOIN RECRUITING_ORGANIZATION DIST ON  
  (DIST_MAP.PARENT_ORGANIZATION_ID = DIST.ORGANIZATION_ID AND 
  DIST.ISOPEN = 'Y' AND 
  DIST.ORGANIZATION_TYPE = 'D')  
GROUP BY 
 DIST.ORGANIZATION_ID, DIST.NAME, CONVERT(VARCHAR(11), N.NWA_DECLARED_DATE, 106) 
 
UNION  
 
--- INTERVIEW ACTIVITY DATA 
SELECT   
 DIST.ORGANIZATION_ID, DIST.NAME,  
 COALESCE(CONVERT(VARCHAR(11), RA.ACTIVITY_DATE, 106), @MonthEndDate) AS ACTIVITY_DATE, 
 ACTIVITY_TYPE = 3,   
 SUM(COALESCE((RA.TC_INTERVIEWS + RA.OT_INTERVIEWS + RA.AC_INTERVIEWS + RA.HV_INTERVIEWS), 0)) AS ACTIVITY_COUNT 
FROM  
 RECRUITING_ORGANIZATION REGION INNER JOIN ORGANIZATION_MAP DISTRICT_MAP ON  
  (REGION.ORGANIZATION_ID = @Organiza.onID AND 
  REGION.ORGANIZATION_ID = DISTRICT_MAP.PARENT_ORGANIZATION_ID) 
 INNER JOIN RECRUITING_ORGANIZATION DIST  ON 
  (DIST.ORGANIZATION_ID = DISTRICT_MAP.CHILD_ORGANIZATION_ID 
  AND DIST.ORGANIZATION_TYPE = 'D') 
 INNER JOIN ORGANIZATION_MAP RS_MAP ON  
  (DIST.ORGANIZATION_ID = RS_MAP.PARENT_ORGANIZATION_ID) 
 INNER JOIN RECRUITING_ORGANIZATION RS ON  
  (RS_MAP.CHILD_ORGANIZATION_ID = RS.ORGANIZATION_ID AND 
  RS.ORGANIZATION_TYPE = 'RS') 
 INNER JOIN ORGANIZATION_MAP RSS_MAP ON RS_MAP.CHILD_ORGANIZATION_ID = RSS_MAP.PARENT_ORGANIZATION_ID 
 INNER JOIN RECRUITING_ORGANIZATION RSS ON  
  (RSS_MAP.CHILD_ORGANIZATION_ID = RSS.ORGANIZATION_ID AND 
  RSS.ORGANIZATION_TYPE = 'RSS' AND 
  RSS.ISOPEN = 'Y' AND  
  DATEDIFF(MONTH, RSS.EFFECTIVE_DATE, @MonthBeginDate) >= 0) 
 LEFT OUTER JOIN RSS_ACTIVITY RA ON  
  (RSS.ORGANIZATION_ID = RA.ORGANIZATION_ID AND 
  DATEDIFF(MONTH, RA.ACTIVITY_DATE, @MonthBeginDate) = 0) 
GROUP BY 
 DIST.ORGANIZATION_ID, DIST.NAME, ACTIVITY_DATE  
ORDER BY  
 DIST.NAME, ACTIVITY_DATE, ACTIVITY_TYPE]]></body>
<schema>DD6CF638-A2EB-2E1B-FF13-422CA718DE2D</schema>
<database>EA42DEDC-DFC5-B775-3079-AD0E133F5E1D</database>
</StoredProcedureSqlServerv2k5>