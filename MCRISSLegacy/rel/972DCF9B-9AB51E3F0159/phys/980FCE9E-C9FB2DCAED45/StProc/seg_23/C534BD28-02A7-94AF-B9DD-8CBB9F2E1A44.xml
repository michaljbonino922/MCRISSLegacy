<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureSqlServerv2k5 class="oracle.dbtools.crest.model.design.storage.sqlserver.v2k5.StoredProcedureSqlServerv2k5" name="[sp_SSRS_DEPandHoldReport]" directorySegmentName="seg_23" id="C534BD28-02A7-94AF-B9DD-8CBB9F2E1A44">
<sourceDDLFile>create MCRISS script - MCRISS OTA.txt</sourceDDLFile>
<createdBy>MichalBonino</createdBy>
<createdTime>2024-04-29 19:28:42 UTC</createdTime>
<ownerDesignName>MCRISSLegacy</ownerDesignName>
<body><![CDATA[@Org INT  
 ,@DaysSince INT  
 
AS 
 
SET NOCOUNT ON  
-- 
--DECLARE @Org INT 
--DECLARE @DaysSince DATETIME 
-- 
--SET @Org = 901 
--SET @DaysSince = NULL 
 
SELECT 
 MV.* 
INTO #ORGS 
FROM 
 MCORG_VIEW MV 
WHERE 
 ( MV.RS_ORG_ID = @ORG -- RS 
  OR MV.DIST_ORG_ID = @ORG -- DISTRICT 
  OR MV.REG_ORG_ID = @ORG -- REGION 
  OR MV.HQ_ORG_ID = @ORG) -- MCRC 
 
SELECT  
P.LAST_NAME 
,P.FIRST_NAME 
,P.SOCIAL_SECURITY_NUMBER 
,'XXXXX' + right(P.SOCIAL_SECURITY_NUMBER, 4) as MASKED_SSN 
,MIRS.CONTRACT_BEGIN_DATE as 'MIRS_CONTRACT_DATE' 
,MIRS.PROJECTED_SHIP_DATE as 'MIRS_PROJ_SHIP_DATE' 
,SD.STATUS_DESCRIPTION + ' - ' + SD.DISPOSITION_DESCRIPTION AS 'STATUS_DISPOSITION' 
,REG.NAME AS 'REGION' 
,DIST.NAME AS 'DISTRICT' 
,RS.ORGANIZATION_TYPE + ' ' + RS.NAME AS 'RS' 
,RSS.ORGANIZATION_TYPE + ' ' + RSS.NAME AS 'RSS' 
,REG.ORGANIZATION_ID AS REG_ID 
,DIST.ORGANIZATION_ID AS DIST_ID 
,RS.ORGANIZATION_ID AS RS_ID 
,RSS.ORGANIZATION_ID AS RSS_ID 
,DATEDIFF(DAY,MIRS.UPDATE_DATE,GETDATE()) AS 'DAYS_SINCE_MIRS' 
 
FROM NWA N 
INNER JOIN CANDIDATE_STATUS CS ON N.NWA_ID = CS.NWA_ID 
  AND CS.CANDIDATE_STATUS_ID =  
  (SELECT MAX(CS2.CANDIDATE_STATUS_ID) 
    FROM CANDIDATE_STATUS CS2 
    WHERE CS.NWA_ID = CS2.NWA_ID) 
  AND CS.STATUS_TYPE = 'E' 
  AND CS.STATUS_CODE = 'A' 
  AND CS.DISPOSITION_CODE = 'DH'  
INNER JOIN STATUS_DISPOSITION SD ON SD.STATUS_TYPE = CS.STATUS_TYPE 
  AND SD.STATUS_CODE = CS.STATUS_CODE 
  AND SD.DISPOSITION_CODE = CS.DISPOSITION_CODE 
INNER JOIN PERSON P ON N.MARINE_CANDIDATE_ID = P.PERSON_ID 
INNER JOIN #ORGS O ON N.ORGANIZATION_OF_RECORD_ID = O.RSS_ORG_ID 
INNER JOIN RECRUITING_ORGANIZATION RSS ON O.RSS_ORG_ID = RSS.ORGANIZATION_ID 
INNER JOIN RECRUITING_ORGANIZATION RS ON O.RS_ORG_ID = RS.ORGANIZATION_ID 
INNER JOIN RECRUITING_ORGANIZATION DIST ON O.DIST_ORG_ID = DIST.ORGANIZATION_ID 
INNER JOIN RECRUITING_ORGANIZATION REG ON O.REG_ORG_ID = REG.ORGANIZATION_ID 
INNER JOIN RECRUITING_ORGANIZATION HQ ON O.HQ_ORG_ID = HQ.ORGANIZATION_ID 
INNER JOIN MIContract MIRS ON MIRS.NWA_ID = N.NWA_ID 
 
WHERE  
((@DaysSince IS NOT NULL AND DATEDIFF(DAY,MIRS.UPDATE_DATE,GETDATE()) >= @DaysSince) OR @DaysSince IS NULL) 
AND MIRS.CONTRACTED_IN_MCRISS = 0 
AND MIRS.CONTRACT_BEGIN_DATE  is not null  
--AND MIRS.DEP_HOLD = 0   --Removed 6/18/2019 
--AND DATEDIFF(DAY, N.NWA_DECLARED_DATE, GETDATE()) <= 90  --Removed 6/18/2019 
 
DROP TABLE #ORGS]]></body>
<schema>3925E19F-DC76-90A4-B892-D7A526C79632</schema>
<database>B007042D-D2E3-F83F-481F-CEB23B21CB30</database>
</StoredProcedureSqlServerv2k5>