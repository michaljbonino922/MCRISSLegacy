<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureSqlServerv2k5 class="oracle.dbtools.crest.model.design.storage.sqlserver.v2k5.StoredProcedureSqlServerv2k5" name="[sp_MILogMIRSImportError]" directorySegmentName="seg_0" id="E4975527-CC00-B6E7-6A01-890CFEDAB9A7">
<sourceDDLFile>Appian.sql</sourceDDLFile>
<createdBy>MichalBonino</createdBy>
<createdTime>2024-04-29 23:57:09 UTC</createdTime>
<ownerDesignName>MCRISSLegacy</ownerDesignName>
<body><![CDATA[@MIRS_IMPORT_ID int, 
 @ERROR_CD  int, 
 @SEVERITY_CD  int, 
 @EXCEPTION_MSG  varchar(510), 
 @TECH_NOTES  varchar(510), 
 @REPROCESS  char(1), 
 @STATUS  varchar(20), 
 @ERROR_SOURCE  int  
AS 
 
DECLARE @ERROR_LOG_ID int 
 
IF EXISTS (SELECT 1 FROM MIRS_IMPORT_ERROR E INNER JOIN ERROR_LOG L ON   
  (E.MIRS_IMPORT_ID = @MIRS_IMPORT_ID AND  
  E.ERROR_LOG_ID = L.ERROR_LOG_ID AND  
  L.ERROR_CD = @ERROR_CD)) 
BEGIN 
 --- UPDATE THE ERROR LOG ENTRY 
 SELECT  
  @ERROR_LOG_ID = L.ERROR_LOG_ID 
 FROM 
  MIRS_IMPORT_ERROR E INNER JOIN ERROR_LOG L ON   
   (E.MIRS_IMPORT_ID = @MIRS_IMPORT_ID AND  
   E.ERROR_LOG_ID  = L.ERROR_LOG_ID AND  
   L.ERROR_CD = @ERROR_CD)  
 
 UPDATE 
  ERROR_LOG 
 SET 
  SEVERITY_CD  = @SEVERITY_CD, 
  EXCEPTION_MSG = @EXCEPTION_MSG, 
  TECH_NOTES = @TECH_NOTES, 
  REPROCESS = @REPROCESS, 
  UPDATE_DATE = GETDATE(), 
  STATUS  = @STATUS, 
  ERROR_SOURCE = @ERROR_SOURCE 
 WHERE 
  ERROR_LOG_ID  = @ERROR_LOG_ID 
END  
ELSE 
BEGIN    
 --- ADD A NEW ERROR LOG ENTRY 
 INSERT INTO ERROR_LOG  
  (ERROR_CD, SEVERITY_CD, EXCEPTION_MSG, TECH_NOTES, REPROCESS, UPDATE_DATE, STATUS, ERROR_SOURCE) 
 VALUES 
  (@ERROR_CD, @SEVERITY_CD, @EXCEPTION_MSG, @TECH_NOTES, @REPROCESS, GETDATE(), @STATUS, @ERROR_SOURCE) 
 
 --- RETRIEVE THE ERROR LOG ID FOR THE NEW RECORD 
 SET @ERROR_LOG_ID = @@IDENTITY 
 
 --- ADD A NEW ENTRY TO THE MIRS_IMPORT_ERROR TABLE TO ASSOCIATE THE NEW ERROR LOG ENTRY WITH THE MIRS IMPORT ID 
 INSERT INTO dbo.MIRS_IMPORT_ERROR (MIRS_IMPORT_ID, ERROR_LOG_ID) 
 VALUES (@MIRS_IMPORT_ID, @ERROR_LOG_ID) 
END]]></body>
<schema>DD6CF638-A2EB-2E1B-FF13-422CA718DE2D</schema>
<database>24B9F7BA-5DD4-EAB5-4EB1-35B911743E85</database>
</StoredProcedureSqlServerv2k5>